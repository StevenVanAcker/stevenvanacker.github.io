<!DOCTYPE html>
<html lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      Singularity.be &middot; Flawed logic inspecting flawed logic
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/hyde.css">
  <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface">

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-144-precomposed.png">
                                 <link rel="shortcut icon" href="/public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>


  <body>

    <div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <h1>
        <a href="/">
          Singularity.be
        </a>
      </h1>
      <p class="lead">Steven Van Acker's blog</p>
    </div>

    <nav class="sidebar-nav">
      <a class="sidebar-nav-item" href="/">Home</a>

      

      
      
        
          
        
      
        
          
            <a class="sidebar-nav-item" href="/about/">About</a>
          
        
      
        
          
        
      
        
      
        
          
        
      
        
          
            <a class="sidebar-nav-item" href="/projects/">Projects</a>
          
        
      
        
          
            <a class="sidebar-nav-item" href="/publications/">Publications</a>
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
    </nav>

    <!-- <p>&copy; 2016. All rights reserved.</p> -->
  </div>
</div>


    <div class="content container">
      <div class="posts">
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2006/02/26/it-alive/">
        it's alive !
      </a>
    </h1>

    <span class="post-date">26 Feb 2006</span>

    I went to the city yesterday, wandering around a bit.<br />When I came by a store that sold them, I bought a pair of jumpstart/booster cables.<br />Hooked them up to mine and noot's car and it worked :)<br />It seems the only problem was the battery. It's charged a bit now, but I'll have to keep in mind to let the engine run for a while every time I start the car.<br /><br />Last weekend I visited my gransparents and my grandfather gave me some interesting stuff to play with. The entire collection is : a car-radio with cd-player, a parkingsensor, a digital bloodpressure meter, an ADSL modem, a tube volt meter, a magnifying glass (25x40cm or so) and a USB nullmodem cable.<br /><br />The took out the carradio from my car and tried to install the cd-player. The connections were different. In fact, they don't even look alike :) Luckily, my grandfather wrote down what each wire does and even proved sockets to screw new wires in.<br /><br />I also bought a new table yesterday, which is wider than the one we have, but of equal length so we can put them together and have a huge table. This morning I also installed the new wireless access point I got for free at work. It's actually a Belkin wireless ADSL router, but if you shut everything off, you can use it as a bridge :)
  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2006/02/23/and-now-for-something-completely/">
        And now for something completely different
      </a>
    </h1>

    <span class="post-date">23 Feb 2006</span>

    I got remarks that I have too many "automated installations" posts, so I will shut up about it for some time ;)<br /><br />I need to buy a decent computer to use as a fileserver at home.<br />I've decided I want at least 1TB of storage in RAID 5. Since 300GB drives are pretty common these days, I will buy 5 of those and use them in RAID 5, which gives 1.2TB of useable storage space.<br /><br />The most likely store I will buy from is <a href="http://www.snogard.de">Snogard</a>, which is a German store. I don't understand any German (well, mostly not).<br />Harddisks are called Festplatten in German, and they can be found under the Laufwerke category on the Snogard site.<br /><br /><pre><br />(Maxtor 6V300F0) 300GB, 7200U/min, 16MB Cache, 9ms, S-ATA II, NCQ for 124,90 €<br /></pre><br /><br />Because linux can't boot from a RAID 5 set, I will need a 6th disk to put the OS on. Overall, I'll require 6 SATA2 connections. I've looked into this before and found that almost no motherboards have that many SATA connectors. Luckily, there are PCI-E SATA controllers :)<br /><br />But lets first find a decent motherboard...<br /><br />This fileserver will be some sort of a multimedia machine. Besides being able to hold lots of files, it must be able to show and record TV at the same time (requires 2 TV tuners), playback the recorded TV stuff (requires decent graphics card and sound card, preferably with dolby surround), it will serve as the gateway to the internet with 2 internet providers (requires 3 networkcards: 1 gigabit download for the internal network, and 2 other networkcards). I also want to have a bunch of USB connectors to attach things like webcams and the like. A DVD drive would probably also be good and maybe a DVI port for digital video (for when we get a projector)<br /><br />So, to summarize:<br /><ul><br /><li>6 SATA2 harddisks</li><br /><li>2 TV cards (PCI or PCI-E)</li><br /><li>Decent graphics card with DVI and maybe TV-out</li><br /><li>Decent sound card with surround sound</li><br /><li>3 network cards: 1 Gbit and 2 100Mbit</li><br /><li>USB</li><br /><li>DVD drive</li><br /></ul><br /><br />Whew! That's quite something. I will need at least 4 PCI slots (2 TV cards and 2 network cards) if I assume that the GBit network card is on board. Then I will probablt need an extra one for a SATA2 controller.<br /><br />Before I can go on selecting motherboards, I need to know what CPU I want on the motherboard. There is Intel and AMD. Intel has always been more expensive and since this thing will cost a fortune already, it's best to save money whereever possible.<br /><br />These are the cheapest processors for each type of socket on AMD:<br /><br /><pre><br />Athlon 64 3000+       Sockel 939, 1800MHz, Venice 144,90 €<br />Sempron 64Bit 3000+ Sockel 754, 1800MHz, Palermo 74,90 €<br />Sempron 2600+       Sockel A, FSB 333, T-Bred B 69,90 €<br /></pre><br /><br />Since all fingers point at Athlon being the best (<a href="http://www.short-media.com/review.php?r=272">http://www.short-media.com/review.php?r=272</a>), I'll go with socket 939.
  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2006/02/22/automated-installations-9/">
        automated installations (9)
      </a>
    </h1>

    <span class="post-date">22 Feb 2006</span>

    Old and busted: exim4<br />new hotness: postfix<br /><br />After specifying that the kulnet-common-packages (a package that depends on all the common packages we want on all servers) CONFLICTS with exim4 and all other exim-* packages, postfix was installed automatically.<br /><br />The only problem was the configuration. Apparently, configuring postfix through preseed is a bad idea (if it works at all). But that's ok!<br />We have several differently configured postfix instances on our servers. Some need to be just a satellite system, while others should be fullfledged mailservers.<br /><br />I made a package kulnet-postfix that writes the standard config for a satellite system, from the postinst script. And it works nicely :)<br /><br />The kulnet-postfix package will be installed separate from kulnet-common-packages because not all servers need that kind of mail configuration.<br /><br />[TODO: I need a question in the debian installer to select what kind of system should be installed. All other questions so far are asked from within the netcfg package. I'm considering asking that new question there aswell. It doesn't exactly have anything to do with network configuration, but I'm too lazy to find out where the right place would be. In fact, it's probably better to add it there to make the patch to go from a standard debian CD to our install CD, smaller]<br /><br />I've also made a kulnet-ntpdate and a kulnet-openntpd package, both depending on ntpdate and openntpd respectively. The kulnet- packages just (over)write the default configuration. In our case, we use ntp.kuleuven.be instead of the standard pool.ntp.org. For some reason, restarting openntpd from the kulnet-openntpd postinst script, makes the debian installer hang after the postinst script exits. I have no idea why. For now, I just commented out the restart of openntpd.<br />
  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2006/02/21/automated-installations-8/">
        automated installations (8)
      </a>
    </h1>

    <span class="post-date">21 Feb 2006</span>

    Part 8 !<br /><br />Yesterday I played around in the postinst script to get a decent network configurator. If you think that it's hard using only bash and netcat to test a network, you are correct. But inside the Debian installer initrd, its far worse. Netcat doesn't have all the options I'm used to and there is no decent debugging infrastructure.<br /><br />I got the network configurator working in the sense that it can scan all network interfaces and find out which one can be used to connect to the outside world. I made a complicated scripted system with all kinds of ropes and pullies that would make Daffy Duck proud.<br /><br />Basically, I go over all network interfaces and for each network interface, I bring up the interface, test if I can connect to some IP on some port and then bring down the interface. At the end of this loop, I have a collection of usable interfaces.<br /><br />The hard part is how to test the network. The netcat inside D-I (Debian Installer) doesn't have a timeout option or anything else I can use. I've considered using ulimit -t, which limits processor time, but netcat doesn't use much of that. The connect call is mostly waiting in kernelspace.<br /><br />The only workable alternative is to have a script running in the background that waits for 3 seconds or so, and then kills any netcats that are running. That way, if netcat can't connect, it will get killed. If it can connect, that's a nice thing. In any case, I have the result after 3 seconds.<br /><br />I've attached the current set of scripts.<br />There are 4 scripts:<br /><dl><br /><dt>postinst</dt><br /><dd>This is the script that is run after netcfg is installed. This will actually ask the questions to the user and call all other scripts. This is also the script that used to call the netcfg binary program, but I got rid of that call since I want my own code to be executed instead.</dd><br /><dt>nctst</dt><br /><dd>The obfuscated name of this script stands for NetCat TeST. This is the main script to test a network configuration. It accepts a few arguments on the commandline, and then brings up an interface, does a netcat and brings down the interface</dd><br /><dt>nck</dt><br /><dd>This is the NetCat Killer. It doesn't kill netcat though. I kills nctst. In fact, it just sends a SIGNAL to nctst, not killing it. What's the reason behind this ? Well, right before the postinst script calls nctst, nck is started in the background. Nck waits for 3 seconds and then kills all nctst scripts with the signal SIGHUP. Inside nctst, there is a signal handler that will report that the currently tested interface is no good for connecting to the outside, and then exits the nctst script cleanly.</dd><br /><dt>nckk</dt><br /><dd>This is the nck killer or NetCat Killer Killer. So, we started a nck in the background which will wait 3 seconds and then kill off nctst. Then we start nctst in parallel. Now if nctst returns fast (in case of a good network connection on the current interface), we don't want nck to keep running in the background. So when nctst returns (either with OK or NOK), we kill of any nck's running in the background to make sure they are gone and won't interfere in the future.</dd><br /></dl><br /><br />In addition, I also added some debconf templates (also attached).<br /><br />Everything works nicely. So the whole netcfg story is probably behind me.<br /><br />I've changed the post-installation script to remove some packages and install some other.<br />I've also added code in the script to generate /etc/environment and set the timezone.<br />The ugliest patch in the script is the one to get rid of lpd: When removing lpd, it asks if it should remove /var/spool/lpd. This question is not preseedable. So I just deleted the postrm script of lpd (actually, emptied it) and performed its tasks myself.<br /><br />The next thing to do, is install postfix instead of exim4.<br />The correct way to install postfix on our servers would be in "satellite system" mode. This means the server receive no mail themselves, but send all mail out to a central mailhub.<br />Also very important is to have only "localhost" in the mydestinations setting, because otherwise it will accept mail locally that you are trying to send out through the mailhub.<br /><br />Since postfix doesn't seem to like being installed automatically and with preseeded values (I can't even install postfix as a dependency of another package, because exim is installed and debian bitches about it)<br />I will probably create a kulnet-postfix package that does the configuration of postfix in a postinst script. I might also make a kulnet-postfix-cav package or similar that will have the configuration for our mail cluster.
  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2006/02/20/automated-installations-7/">
        automated installations (7)
      </a>
    </h1>

    <span class="post-date">20 Feb 2006</span>

    Welcome to a brand new week.<br /><br />The plan this week (at least till wednesday when I will be handling shit of week) is to program my own netcfg package. Before I can do that, I have to know what exactly this package is being used for.<br /><br />This is a list of files (probably) generated by netcfg (I found them in netcfg.h):<br /><pre><br />#define INTERFACES_FILE "/etc/network/interfaces"<br />#define HOSTS_FILE      "/etc/hosts"<br />#define HOSTNAME_FILE   "/etc/hostname"<br />#define NETWORKS_FILE   "/etc/networks"<br />#define RESOLV_FILE     "/etc/resolv.conf"<br />#define DHCLIENT_CONF   "/etc/dhclient.conf"<br />#define DHCLIENT3_CONF  "/etc/dhcp3/dhclient.conf"<br />#define DOMAIN_FILE     "/tmp/domain_name"<br /><br />#define DEVNAMES        "/etc/network/devnames"<br />#define DEVHOTPLUG      "/etc/network/devhotplug"<br />#define STAB            "/var/run/stab"<br /></pre><br /><br />Next to that, this is what is in the netcfg package (besides the control section)<br /><pre><br />/<br />/usr/<br />/usr/lib/<br />/usr/lib/base-installer.d/<br />/usr/lib/base-installer.d/40netcfg<br />/etc/<br />/etc/network/<br />/etc/dhcp/<br />/etc/dhcp3/<br />/etc/dhcp3/dhclient-script<br />/etc/dhclient-script<br />/bin/<br />/bin/netcfg<br />/bin/killall.sh<br />/bin/ptom<br />/var/<br />/var/dhcp/<br /></pre><br /><br />The files here have the following purpose:<br /><dl><br /><dt>/usr/lib/base-installer.d/40netcfg</dt><br /><dd>Copy the generated files to /target</dd><br /><dt>/etc/dhcp3/dhclient-script</dt><br /><dt>/etc/dhclient-script</dt><br /><dd>These scripts are the same. It's a miniature dhclient that uses netcfg (the binary)</dd><br /><dt>/bin/netcfg</dt><br /><dd>The binary</dd><br /><dt>/bin/killall.sh</dt><br /><dd>A script to kill all running DHCP clients</dd><br /><dt>/bin/ptom</dt><br /><dd>A symlink to the netcfg binary</dd><br /></dl><br /><br />Instead of replacing the code in the netcfg package, I decided I would make a new kulnet-netcfg package with all the new code. I would then remove the "installer-menu-item: 18" from netcfg and glue it behind the kulnet-netcfg package.<br />After doing all that, to my surprise, debian installer still loaded the first netcfg and skipped the kulnet-netcfg.<br /><br />So, I've cleaned out netcfg and started making my own script.<br />The current problem is that there is nothing decent inside the initrd to test a connection.<br />I'm using netcat with a program that kills all netcats after 3 seconds in the background.<br /><br />
  </div>
  
</div>

<div class="pagination">
  
    <a class="pagination-item older" href="/page87">Older</a>
  
  
    
      <a class="pagination-item newer" href="/page85">Newer</a>
    
  
</div>

    </div>

  </body>
</html>
