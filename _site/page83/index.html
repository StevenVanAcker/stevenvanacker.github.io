<!DOCTYPE html>
<html lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      Singularity.be &middot; Flawed logic inspecting flawed logic
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/hyde.css">
  <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface">

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-144-precomposed.png">
                                 <link rel="shortcut icon" href="/public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>


  <body>

    <div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <h1>
        <a href="/">
          Singularity.be
        </a>
      </h1>
      <p class="lead">Steven Van Acker's blog</p>
    </div>

    <nav class="sidebar-nav">
      <a class="sidebar-nav-item" href="/">Home</a>

      

      
      
        
          
        
      
        
          
            <a class="sidebar-nav-item" href="/about/">About</a>
          
        
      
        
          
        
      
        
      
        
          
        
      
        
          
            <a class="sidebar-nav-item" href="/projects/">Projects</a>
          
        
      
        
          
            <a class="sidebar-nav-item" href="/publications/">Publications</a>
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
    </nav>

    <!-- <p>&copy; 2016. All rights reserved.</p> -->
  </div>
</div>


    <div class="content container">
      <div class="posts">
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2006/03/15/automated-installations-12/">
        automated installations (12)
      </a>
    </h1>

    <span class="post-date">15 Mar 2006</span>

    I solved the problem.<br /><br />Next to tracking where the bug appears, I set up a new virtual machine and duplicated everything the debian installer did when partitioning and mounting. That is: I created the same partitions, formatted ext3 and copied the /etc/fstab file.<br /><br />I believe now that I know what the cause is. In my partitioning scheme, the first partition started at sector 1, while the debian installer makes it start at sector 63.<br />I've seen this behaviour before when I was looking at partman-auto.<br />I'm not sure what is inside those 63 sectors (the first track), but I'd love to find out.<br /><br /><a href='http://www.ranish.com/part/primer.htm'>This link</a> explains that in the old days, the 62 sectors after the boot sector, were left unused so that each partition starts at cylinder boundary. I can't really believe that Linux has problems with this, but it might.<br /><br /><a href='http://www.win.tue.nl/~aeb/linux/Large-Disk-6.html'>Here</a> it is suggested that Linux has no alignment requirement at all.<br /><br />So now I've tried creating a partition from sector 1: works, creating an ext2 partition instead of ext3: works, toggling bootable flag: works.<br /><br />Next thing you'll tell me that I've been imagining this bug.<br /><br />Goddamnit. Now I've repeated every step I took in the first attempt and it still works.<br />[Oh the irony, being pissed because something works]<br /><br />The only thing I can think of now that could still be wrong is accidently trying to mount a ext2 filesystem as ext3: nothing !<br /><br />Bah<br /><br />this is what I do now:<br /><br /><pre><br />echo -e ",,83" | sfdisk /dev/discs/disc0/disc<br />mke2fs /dev/discs/disc0/part1<br />mkdir /target<br />mount /dev/discs/disc0/part1 /target<br />mkdir /target/etc<br />nano /target/etc/fstab<br /><br />    proc /proc proc defaults 0 0<br />    /dev/sda1 / ext2 defaults,errors=remount-ro 0 1<br /><br /></pre><br /><br />Well, so be it :)<br />Let's see if I can kick in some RAID.<br /><br /><pre><br />echo -e ",1000,fd\n,1000,fd" | sfdisk -uM /dev/discs/disc0/disc<br />modprobe md<br />modprobe raid1<br />mdadm --create /dev/md/0 -l raid1 -n 2 /dev/discs/disc0/part1 /dev/discs/disc0/part2<br />mke2fs /dev/md/0<br />mkdir /target<br />mount /dev/md/0 /target<br />nano /target/etc/fstab<br /><br />    proc /proc proc defaults 0 0<br />    /dev/md/0 / ext2 defaults,errors=remount-ro 0 1<br /><br /></pre><br /><br />Everything seems to work ok, except grub decided to be a bitch and not install itself.<br />That can be remedied :)<br /><br />After grub complains a number of times (I think 2 of 3), it drops you into the main menu where you can select "continue without a bootloader"<br />Before doing that, grub needs to be setup though.<br /><br /><pre><br />chroot /target /sbin/grub<br />    device (hd0) /dev/sda<br />    root (hd0,0)<br />    setup (hd0)<br />chroot /target /sbin/grub-install /dev/sda<br />chroot /target /sbin/update-grub<br /></pre><br /><br />update-grub would not generate /boot/grub/menu.lst because I entered /dev/md/0 instead of /dev/md0 in /etc/fstab<br /><br />Rebooting works.<br /><br />So, not only do I have to circumvent partman, but also the grub installer in debian installer.<br />I wonder how the debian installer would install grub on a RAID system though, since it has the option when doing it manually (I presume)<br /><br />
  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2006/03/14/automated-installations-11/">
        automated installations (11)
      </a>
    </h1>

    <span class="post-date">14 Mar 2006</span>

    This is getting to be one long article.<br />I'm thinking of making it a static page once I've researched everything and finished the project.<br />(I've actually created a special category for the articles concerning the automated installations project)<br /><br />Yesterday I stumbled across the ask_user function. It contains the first reference to plugins I've found so far. For each plugin, the ask_user function executes the "choices" script and uses the output to construct a list of choices for the debconf_select function:<br /><br /><pre><br />debconf_select () {<br />        local IFS priority template choices default_choice default x u newchoices code<br />        priority="$1"<br />        template="$2"<br />        choices="$3"<br />        default_choice="$4"<br />        default=''<br />        # Debconf ignores spaces so we have to remove them from $choices<br />        newchoices=''<br />        IFS="$NL"<br />        for x in $choices; do<br />                local key option<br />                restore_ifs<br />                key=$(echo ${x%$TAB*})<br />                # work around bug #243373<br />                if [ "$TERM" = xterm -o "$TERM" = bterm ]; then<br />                        debconf_select_lead="$NBSP"<br />                else<br />                        debconf_select_lead="> "<br />                fi<br />                option=$(echo "${x#*$TAB}" | sed 's/ *$//g' | sed "s/^ /$debconf_select_lead/g")<br />                newchoices="${newchoices}${NL}${key}${TAB}${option}"<br />                if [ "$key" = "$default_choice" ]; then<br />                    default="$option"<br />                fi<br />        done<br />        choices="$newchoices"<br />        u=''<br />        IFS="$NL"<br />        # escape the commas and leading whitespace but keep them unescaped<br />        # in $choices<br />        for x in $choices; do<br />                u="$u, `echo ${x#*$TAB} | sed 's/,/\\\\,/g' | sed 's/^ /\\\\ /'`"<br />        done<br />        u=${u#, }<br />        if [ -n "$default" ]; then<br />                db_set $template "$default"<br />        fi<br />        db_subst $template CHOICES "$u"<br />        code=0<br />        db_input $priority $template || code=1<br />        db_go || return 255<br />        db_get $template<br />        IFS="$NL"<br />        for x in $choices; do<br />                if [ "$RET" = "${x#*$TAB}" ]; then<br />                        RET="${x%$TAB*}"<br />                        break<br />                fi<br />        done<br />        return $code<br />}<br /></pre><br /><br />The debconf_select function presents a menu to the user using the given template. In this specific case, it's the template "partman/choose_partition":<br /><br /><pre><br />Template: partman/choose_partition<br />Type: select<br />Choices: ${CHOICES}<br />Description: This is an overview of your currently configured partitions and mount points. <br /> Select a partition to modify its settings (file system, mount point, etc.), a free space <br /> to create partitions, or a device to initialise its partition table.<br />...<br /></pre><br /><br />This looks like the following screen:<br />[img_assist|fid=1017722|thumb=1|alt=6182_large.png]<br /><br /><br />The first line there "Configure software RAID" is inserted into choose_partition.d by the partman-md udeb.<br /><br />After the user makes a selection, debconf_select() returns to ask_user. This last one stores the selection in $dir/default_choice so it can remember it later.<br />Then, the script "do_option" is called.<br /><br />do_option starts by calling confirm_changes() which seems to do nothing but ask the user to confirm  that changed partitions will be committed. It then commits those changes and restarts parted_server. [Actually, thats what the comment says. In fact, the script sends a QUIT to the parted_server and then deletes the pidfile. I don't see it restarted here...]<br /><br />Next, mdcfg is started. This tool resides in the mdcfg-utils udeb.<br />When mdcfg is finished, all the scripts in /lib/partman/init.d are called again.<br /><br />Let's have a look at this mdcfg (which is luckily a bash script)<br />Seems like I'm finally getting to the good stuff.<br /><br />The mdcfg script loads the MD and RAID modules, detects and starts MD devices with mdrun, installs the mdadm tool in /target and then calls the md_mainmenu() function.<br /><br /><pre><br />### Main of script ###<br /><br /># Try to load the necesarry modules.<br /># Supported schemes: RAID 0, RAID 1, RAID 5<br />depmod -a 1>/dev/null 2>&1<br />modprobe md 1>/dev/null 2>&1<br />modprobe raid0 >/dev/null 2>&1<br />modprobe raid1 1>/dev/null 2>&1<br />modprobe raid5 >/dev/null 2>&1<br /><br /># Try to detect MD devices, and start them<br />/sbin/mdrun<br /><br /># Make sure that we have md-support<br />if [ ! -e /proc/mdstat ]; then<br />        db_set mdcfg/nomd "false"<br />        db_input high mdcfg/nomd<br />        db_go<br />        db_stop<br />        exit 0<br />fi<br /><br /># Force mdadm to be installed on the target system<br />apt-install mdadm<br /><br /># We want the "go back" button<br />#db_capb backup<br /><br />md_mainmenu<br /><br />#db_stop<br />exit 0<br /></pre><br /><br />md_mainmenu() calls md_createmain() which calls md_create_raid1(). That last one asks the user a bunch of questions about hwo to configure the RAID1 and then calls mdadm to create the RAID1.<br />It's important to keep in mind that the partitions already need to exist before a RAID1 can be laid out over them.<br /><br />The more I read all this code, the more I feel like trimming it down to the bear essentials.<br />I don't need all this user-input to do an automated install. Basically, I can have 2 partitioning schemes: either a simple swap + /boot + / on 1 disk, or 3 RAID 1 devices on 2 disks.<br />The sizes are pretty much fixed: 64MB for /boot, 2*RAM for swap and the rest for the root disk.<br /><br />To do all of this "My Way" (TM), I need to pre-empt the whole partman business. Which means my script will have to expect the same input (or less specific input), and produce the same output (or more specific output). Reminds me of Liskov :)<br /><br />I'm gonna finish this journey first though. Understanding partman is essential to rewriting it.<br />We're pretty deep inside the rabbithole at the moment. The mdcfg tool was called by the do_option script of the partman-md plugin. That last one was invoked by ask_user in partman.<br /><br />The next step is calling all scripts in commit.d, followed by those in finish.d.<br /><br />At first glance, the scripts in commit.d don't do that much:<br /><dl><br /><dt>10filesystems_changed</dt><br /><dd>Removes /var/lib/partman/filesystems_detected</dd><br /><dt>20remove_backup</dt><br /><dd>Removes /var/lib/partman/backup</dd><br /><dt>30parted</dt><br /><dd>Disables swap and sends a "COMMIT" to parted_server</dd><br /><dt>32update-dev</dt><br /><dd>This calls the program "update-dev" if it exists. The program seems to be part of udevfs (I can't find the package at all, and it doesn't look like it was installed in the debian-installer I'm using)</dd><br /></dl><br /><br />There is only 1 script in finish.d, which kills the parted_server.<br /><br />All other scripts are inserted by other udeb packages.<br /><br />These scripts are added by several udeb packages in /lib/partman/init.d:<br /><dl><br /><dt>01unsupported</dt><br /><dt><em>03kernelmodules_basicfilesystems</em></dt><br /><dt><em>03kernelmodules_ext3</em></dt><br /><dt><em>03kernelmodules_jfs</em></dt><br /><dt><em>03kernelmodules_reiserfs</em></dt><br /><dt><em>03kernelmodules_xfs</em></dt><br /><dd>All the 03kernelmodules_* scripts seem to check if modules are loaded and load them if required. They also touch a status file in /var/lib/partman, no doubt to indicate the presence of the module.</dd><br /><dt>10umount_target</dt><br /><dt>30parted</dt><br /><dt><em>31md-devices</em></dt><br /><dd>I'm guessing this script looks at existing MD devices and dumps them into /var/lib/partman (the status directory)</dd><br /><dt>35dump</dt><br /><dt><em>50lvm</em></dt><br /><dd>The comment at the start of this file says: "This script sets method lvm for all partitions that have the lvm flag set. It also discovers the logical volumes and creates in them a loop partition table and partition.</dd><br /><dt><em>51md</em></dt><br /><dd>This scripts goes over all MD devices and marks them as being RAID</dd><br /><dt>69no_media</dt><br /><dt>70update_partitions</dt><br /><dt>71filesystems_detected</dt><br /><dt><em>80autouse_swap</em></dt><br /><dd>Detects and prepares swap partitions</dd><br /><dt>95backup</dt><br /><dt><em>99initial_auto</em></dt><br /><dd>Initialisation for partman-auto</dd><br /></dl><br /><br />It doesn't look like partman-auto can autopartition multiple devices :(<br />So I think I'll have to provide my own way of partitioning the disks.<br />Looking at the control file for partman, I find:<br /><pre><br />Provides: made-filesystems, mounted-partitions, partitioned-harddrives, created-fstab<br /></pre><br /><br />My guess is that, if I replace partman, I need to partition the harddrives, make the filesystems, mount them and create an /etc/fstab.<br /><br />After a welldeserved break, I decided a practical test was in order. I modified partman so it would do nothing at all (That is: it would check for a file /done every second untill it found one, and then exit 0)<br />Then, I logged into the second terminal, created a partition table with sfdisk, created a filesystem and mounted it under /target. Then I touched /done and the installation continued.<br />To my surprise, the base system was installed and the machine rebooted. However, it couldn't find init... I screwed something up :)<br /><br />/target/etc/fstab contains:<br /><pre><br /># UNCONFIGURED FSTAB FOR BASE SYSTEM<br /></pre><br /><br />Looking at the logs, the installer complained that /etc/fstab and /etc/mtab could not be found, /proc was not mounted and it couldn't find mdadm.<br />All valid errors I suppose.<br /><br />Let's see how the real install CD creates these files...<br /><br />/etc/fstab contains:<br /><pre><br /># /etc/fstab: static file system information<br />#<br /># <file system> <mount point> <type> <options> <dump> <pass><br />proc          /proc            proc    defaults                   0 0<br />/dev/sda1     /                ext3    defaults,errors=remount-ro 0 1<br />/dev/sda5     none             swap    sw                         0 0<br />/dev/hdc      /media/cdrom0    iso9660 ro,user,noauto             0 0<br />/dev/fd0      /media/floppy0   auto    rw,user,noauto             0 0<br /># UNCONFIGURED FSTAB FOR BASE SYSTEM<br /></pre><br /><br />/etc/mtab contains:<br /><pre><br />/dev/sda1 /     ext3 rw,errors=remount-ro 0 0<br />proc      /proc proc rw                   0 0<br /></pre><br /><br />The Debian install CD also complains about not finding mdadm.<br /><br />I manually created an /etc/fstab right before touching /done (VMWare snapshots are great) and gets a little bit further this time. The problem now is that the disk is mounted readonly.<br /><br />Removing the "errors=remount-ro" from /etc/fstab fixed the problem, but its no solution.<br />I need to figure out why my manually created partition causes an error.<br /><br />To find out what is so different, I tracked down the reboot command so I can delay it while I look for the answers. The script /usr/lib/prebaseconfig.d/99reboot is responsible for that. Adding a sleep or so in it, should delay it a bit.<br /><br />In /etc/rcS.d, these scripts are executed (among others):<br />mountall.sh,discover,mountvirtfs<br /><br />Mountvirtfs is done first, then mountall.sh, discover and mountvirtfs again.<br />Right before discover, the first error appears meaning the problem is somewhere in mountall.sh<br />Apparently, the errors happen when the filesystem is being cleaned up (/tmp and /var/tmp and such)
  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2006/03/13/automated-installations-10/">
        automated installations (10)
      </a>
    </h1>

    <span class="post-date">13 Mar 2006</span>

    It's been a while since I wrote about the automated installations project and I feel it's time for an update :)<br /><br />*female startrek voice* Last time on StarTrek Enterprise^H^H^H^H^H^H^H^H^H^H^H^H^H^H^H^H^H^H^H Automated installations <br /><br />I had made a kulnet-postfix, kulnet-ntpdate and kulnet-openntpd package. I was wondering why the postinstallation script hung when trying to restart the daemon. I dunno about that yet, but I found that not loading the debconf functions in the postinst script, fixes the problem.<br /><br />Since then, I have also made a kulnet-root-account, kulnet-snmp, kulnet-ssh, kulnet-syslog-ng, kulnet-tsm and a brand new kulnet-watchdog package. Most of these packages just either configure the underlying software correctly or add it into the kulnet-watchdog, or both. The kulnet-watchdog package contains a new software watchdog written from scratch in perl. The kulnet-tsm package is used to take daily backups to the TSM (Tivoli Storage Manager) from IBM. I also had to create Debian packages from the RPM's that are provided by IBM.<br /><br />I've currently run short on packages I can add to the default installation and I'm faced with the core of the automated installation again. Specifically, I want to be able to install Debian on a RAID 1 set. While the Sarge installer supports installing on RAID1, it does not allow you to do it with a preseeded configfile (using partman-auto). The next generation debian-installer is supposed to be able to do this (in fact, I read a <a href='http://lists.debian.org/debian-boot/2006/03/msg00450.html'>mail on the mailinglist</a> about that just today)<br /><br />Too bad I don't have the luxury to wait for Etch to become stable...<br /><br />The most logical place to start is in the debian installer itself. Since it has the capability to create and assemble RAID 1 sets manually, the code is already there. Now I just need to figure out how to automate it.<br /><br />The udeb package is called partman-md_20_all.udeb. Unpacking it shows that there is NO binary in it. Yay \o/ !<br />This means I can probably do this entire thing with whacko bash scripting.<br /><br />Sigh, again my enthousiasm was premature :(<br /><br />There is an mdadm-udeb package that contains the binary to do RAID 1.<br />However, I think I need to look at the very start of the partman suite. That's why I'm checking out the partman udeb itself.<br />I've learned that it starts by executing all files in /lib/partman/init.d/. After that it loops untill a user exits from choose_partition and then executes all files in /lib/partman/commit.d<br />Finally, all files in /lib/partman/finish.d are executed. That's where partman ends.<br /><br />Onto the init.d of partman!<br /><br />/lib/partman/init.d contains the following files which seem to do the following things:<br /><dl><br /><dt>01unsupported</dt><br /><dd>This script seems to check whether the underlying system is known and supported. If not, an error is shown.</dd><br /><dt>10umount_target</dt><br /><dd>This script checks whether /target is mounted or not. If it's mounted, it is unmounted.</dd><br /><dt>30parted</dt><br /><dd>This script starts the parted server. [Note: in definitions.sh, DEVICES=/var/lib/partman/devices] Besides that, it also moves around a couple directories but I don't know where they came from or what they are supposed to represent. I guess each directory represents an existing partition.<br /></dd><br /><dt>35dump</dt><br /><dd>This script dumps information of each partition into a logfile. Probably for debugging purposes.</dd><br /><dt>69no_media</dt><br /><dd>This one checks whether partitionable media exist and errors if there aren't</dd><br /><dt>70update_partitions</dt><br /><dd>This script reads all known partitions and invokes the scripts in /lib/partman/update.d/ for each one of them.</dd><br /><dt>71filesystems_detected</dt><br /><dd>This script does nothing but create an empty file called /var/lib/partman/filesystems_detected. Probably just a way to tell later scripts to be careful about existing partitions.</dd><br /><dt>95backup</dt><br /><dd>This script makes a backup of /var/lib/partman/devices. Probably to have a copy before changing things that can get screwed up</dd><br /></dl><br /><br />All of this seems to be just preparation. <br />The directory /var/lib/partman/devices seems to be a parallel status directory to keep track of the partitions. I wouldn't be surprised if changes are made to this directory first untill the user is satisfied and then all the changes can be processed at the end.<br /><br />The scripts called by 70update_partitions in /lib/partman/update.d are the following:<br /><br /><dl><br /><dt>20bootable</dt><br /><dd>This script checks whether a partitions bootable flag is set. It also updates the status dir</dd><br /><dt>20detected_filesystem</dt><br /><dd>This one checks for existing partitions and marks the status dir</dd><br /><dt>59default_visuals</dt><br /><dd>This script fetches a human readable description of the filesystem on the given partition and stores it in the status dir</dd><br /><dt>80visual</dt><br /><dd>This script calls all scripts in /lib/partman/valid_visuals.d and parses the output of all those scripts. The output is one of grep "number","type","size","name","filesystem","bootable","method" or "mountpoint". For each of these output "words", a script exists: /lib/partman/visual.d/[name], which is called if that name appears in the output of the previous script. The output of THESE scripts is then stored in a file called "view"</dd><br /></dl><br /><br />We just keep getting deeper and deeper in nested script calls...<br />I'll take the red pill and see how deep the rabbithole goes &lt;/matrix&gt;<br /><br />/lib/partman/valid_visuals.d seems to contain these scripts:<br /><dl><br /><dt>05number</dt><br /><dd>prints "number\tPartition number\n"</dd><br /><dt>10type</dt><br /><dd>prints "type\tType - primary or logical\n" if parted returns yes for USES_EXTENDED</dd><br /><dt>15size</dt><br /><dd>prints "size\tSize\n"</dd><br /><dt>20bootable</dt><br /><dd>prints "bootable\tThe bootable flag\n"</dd><br /><dt>25method</dt><br /><dd>prints "method\tUsage method: F - format K - keep and use existing data\n"</dd><br /><dt>30parted_fs</dt><br /><dd>prints "parted_fs\tThe file system as known by parted\n"</dd><br /><dt>35filesystem</dt><br /><dd>prints "filesystem\tFile system\n"</dd><br /><dt>40name</dt><br /><dd>prints "name\tName\n" if the partition uses named partitions</dd><br /><dt>45mountpoint</dt><br /><dd>prints "mountpoint\tMount point\n"</dd><br /></dl><br /><br />Most of these lines are printed, except for "type" and "name" which depend on a test.<br /><br />The scripts in /lib/partman/visual.d are:<br /><dl><br /><dt>bootable</dt><br /><dd/><br /><dt>filesystem</dt><br /><dd/><br /><dt>method</dt><br /><dd/><br /><dt>mountpoint</dt><br /><dd/><br /><dt>name</dt><br /><dd/><br /><dt>number</dt><br /><dd/><br /><dt>parted_fs</dt><br /><dd/><br /><dt>size</dt><br /><dd/><br /><dt>type</dt><br /><dd/><br /></dl><br /><br />I'm not gonna sum up what these scripts print. Suffice it to say that they look at the terminal type and print something visually pleasing. This output is probably used when showing the contents of a partition in partman.<br /><br />In case you forgot, we're still at the end of /lib/partman/init.d...<br /><br />At this point, the partman script loops over "ask_user /lib/partman/choose_partition" and asks to confirm changes when the user is done.<br /><br />The ask_user function located in definitions.sh looks like this:<br /><br /><pre><br />ask_user () {<br />    local IFS dir template priority default choices plugin name option<br />    dir="$1"; shift<br />    template=$(cat $dir/question)<br />    priority=$(cat $dir/priority)<br />    if [ -f $dir/default_choice ]; then<br />        default=$(cat $dir/default_choice)<br />    else<br />        default=""<br />    fi<br />    choices=$(<br />        for plugin in $dir/*; do<br />            [ -d $plugin ] || continue<br />            name=$(basename $plugin)<br />            IFS="$NL"<br />            for option in $($plugin/choices "$@"); do<br />                printf "%s__________%s\n" $name "$option"<br />            done<br />            restore_ifs<br />        done<br />    )<br />    code=0<br />    debconf_select $priority $template "$choices" "$default" || code=$?<br />    if [ $code -ge 100 ]; then return 255; fi<br />    echo "$RET" &gt;$dir/default_choice<br />    $dir/${RET%__________*}/do_option ${RET#*__________} "$@" || return $?<br />    return 0<br />}<br /></pre><br /><br />This is the first reference to plugins I've found so far.<br />
  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2006/03/09/latest-media-hype/">
        the latest media hype
      </a>
    </h1>

    <span class="post-date">09 Mar 2006</span>

    I haven't been paying attention to the news lately, but now that I'm watching Actua TV I'm overwhelmed.<br /><br />It appears a (claimed) turkish terrorist was sentenced to 4 years for whatever. She was under guard by the state security and the police (32 people in total) and she escaped the day after she was sentenced. Now there's a lot to do about how this could have happened.<br /><br />From what I can find on the internet (online newspapers keep news online 1 day and then archive it and you need to pay for the archives, beh), the state security and the police were in conflict with eachother about how to guard the terrorist (Fehriye Erdal, a female "terrorist"). I think she escaped in the confusion.<br /><br />The minister of internal affairs (Dewael) was in holidays at that time, and he came back (as he should) to oversee the shame. After arriving in Belgium I heard he left to wherever he was taking his holdays to, according to himself, be with his children.<br /><br />The opposition parties are having a fieldday with all of this. First of all, they claim our national security sucks so much that they can't even guard 1 female terrorist. Next, they accuse the minister of not doing his job by returning to some foreign country (on holidays) instead of staying and facing the music.<br /><br />While doing some research to see what the hell this is all about, I stumbled on <a href="http://64.233.179.104/search?q=cache:Fe9tPug2h3sJ:www.cemab.be/news/2006/02/744.php+erdal+terrorist+site:be&hl=en&ct=clnk&cd=5&client=opera">this article</a>:<br /><br />(Interview with Bahar Kimyong�r, someone with ties to the forementioned female terrorist)<br /><br /><cite><br />Waarvoor bent u precies aangeklaagd? <br /><br />Ik ben in beschuldiging gesteld voor het vertalen van een perscommuniqu� van de DHKC. Het communiqu� ging over een dramatisch ongeluk met een militante die springstoffen vervoerde. Die zijn per ongeluk afgegaan in een bus, waarbij de militante en drie burgers zijn omgekomen. De DHKC heeft daarom destijds een communiqu� gepubliceerd om zich te excuseren tegenover de bevolking. In dit communiqu� nam de organisatie de volledige verantwoordelijkheid voor het ongeluk op zich.<br /></cite><br /><br />I'll attempt to translate this freely:<br /><cite><br />What exactly are you being charged with ?<br /><br />I've been charged with translating a press-release of the DHKC. The pressrelease was about the dramatic accident with a (female) militant who was transporting explosives. Those went off on accident in a bus, which killed the militant and 3 civilians. The DHKC published a press-release in which they apologised for this to the public. In that press-release, the organisation took the complete responsability for the accident. <br /></cite><br /><br />How convenient. So someone happened to transport a bag of explosives, by bus, when it exploded. And then a terrorist organisation claimed they did it and apologised.<br />I never thought of it like that.<br /><br />Probably, the "hijackers" of the planes that crashed in the WTC building on 11 september 2001, were trying to teach the pilots how to fly more efficiently and they accidently crashed into the building. Luckily, Al Qaeda apologised to the public for this. Otherwise we might have been offended.<br /><br />What a load of crap
  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2006/03/09/generate-random-password-with-perl/">
        generate random password with a perl oneliner
      </a>
    </h1>

    <span class="post-date">09 Mar 2006</span>

    I have a script that generates passwords by piping /dev/urandom through head and base64 encoding it, but this perl oneliner is way more obscure :)<br /><br /><pre><br />perl -e '@l=("a".."z","A".."Z",0..9) and print join "",map $l[rand @l],0..100'<br /></pre><br />
  </div>
  
</div>

<div class="pagination">
  
    <a class="pagination-item older" href="/page84">Older</a>
  
  
    
      <a class="pagination-item newer" href="/page82">Newer</a>
    
  
</div>

    </div>

  </body>
</html>
