<!DOCTYPE html>
<html lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      Singularity.be &middot; Flawed logic inspecting flawed logic
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/hyde.css">
  <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface">

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-144-precomposed.png">
                                 <link rel="shortcut icon" href="/public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>


  <body>

    <div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <h1>
        <a href="/">
          Singularity.be
        </a>
      </h1>
      <p class="lead">Steven Van Acker's blog</p>
    </div>

    <nav class="sidebar-nav">
      <a class="sidebar-nav-item" href="/">Home</a>

      

      
      
        
          
        
      
        
          
            <a class="sidebar-nav-item" href="/about/">About</a>
          
        
      
        
          
        
      
        
      
        
          
        
      
        
          
            <a class="sidebar-nav-item" href="/projects/">Projects</a>
          
        
      
        
          
            <a class="sidebar-nav-item" href="/publications/">Publications</a>
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
    </nav>

    <!-- <p>&copy; 2016. All rights reserved.</p> -->
  </div>
</div>


    <div class="content container">
      <div class="posts">
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2006/10/04/raid-1-to-raid-5/">
        RAID 1 to RAID 5
      </a>
    </h1>

    <span class="post-date">04 Oct 2006</span>

    Since the schoolyear started, I have been fighting against a tidal wave of incoming logmessages. People obviously started using the network again.<br /><br />I decided to replace the current 72GB RAID1 set with a 144GB RAID5 set (using 3 72GB harddisks).<br /><br /><a href='http://www.tldp.org/HOWTO/Software-RAID-HOWTO-6.html'>http://www.tldp.org/HOWTO/Software-RAID-HOWTO-6.html</a><br /><br />The first thing I noticed was that the kernel was not compiled with RAID5 support, just RAID1. This server is one of those who is still running some hybrid version of an old Debian release overwritten with countless compilations from source, and no documentation about it at all.<br />In addition, the kernel it was running was 2.4.26 with a bunch of unspecified patches.<br /><br />I installed a brand new 2.6.17.13 kernel on it, with all RAID-levels supported (standard kernel for all new machines), but the server wouldn't load the networkmodules. I'm guessing this is because modprobe is too old...<br /><br />So, resorting to a desperate option, I recompiled the kernel from local source, just adding RAID5.<br /><br />After a few disturbing incidents (the machine crashed when I wiped one of the RAID1 disks, after carefully removing it from the RAID set), I'm back again and about to continue...<br /><br />The situation is as follows: /dev/sda and /dev/sdc contains the partitions of /, /boot and swap. All in RAID1. /dev/sdb and /dev/sdd both contain 1 partition (sdb1 and sdd1) and form a RAID1 set together. /dev/sde is the new disk.<br /><br />I started by removing /dev/sdd1 from the RAID set by marking it as faulty and the removing it:<br /><pre><br />mdadm --manage --set-faulty /dev/md3 /dev/sdd1<br />mdadm /dev/md3 -r /dev/sdd1<br /></pre><br /><br />I then started wiping /dev/sdd, but for some reason this crashed the machine. So, moving along...<br />the idea is to have /dev/sdb, /dev/sdd and /dev/sde in the RAID5 set. But I want to have /dev/sdb running as long as possible. So I will create a degraded RAID5 with /dev/sdd and /dev/sde first, copy the data and then add /dev/sdb later.<br /><br />I partitioned both /dev/sdd and /dev/sde the same as /dev/sdb.<br /><pre><br />sfdisk -d /dev/sdb &gt; /tmp/x<br />cat /tmp/x | sfdisk -f /dev/sdd<br />cat /tmp/x | sfdisk -f /dev/sde<br /></pre><br /><br />mdadm --create --verbose /dev/md4 --level=5 --raid-devices=3 missing /dev/sdd1 /dev/sde1<br />
  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2006/09/24/gentoo-experience/">
        the gentoo experience
      </a>
    </h1>

    <span class="post-date">24 Sep 2006</span>

    Since people are always nagging that gentoo is so great, I thought I'd give it a try.<br /><br />First things first. I went to <a href='http://www.gentoo.org/doc/en/index.xml?catid=install#doc_chap2'>the installation instructions</a> and went for <a href='http://www.gentoo.org/doc/en/gentoo-x86-quickinstall.xml'>the quick install guide</a><br /><br />Here they tell me I have 2 options: the minimal install CD or the live CD. The minimal CD fetches everything over network but is the recommended approach. The Live CD is my favorite however, since I won't have to waste much bandwidth then.<br /><br />So I install the <a href='ftp://ftp.belnet.be/mirror/rsync.gentoo.org/gentoo/releases/x86/current/livecd/'>Live CD</a>. After doing some laundry and taking 3 boxes of glass to the glass-container, the download is in.<br /><br />I boot it in vmware (of course I won't allow gentoo to trash any real system). I'm given a simple bootmenu, in which I select "gentoo-nofb". I don't like framebuffer. It's slow and useless in my opinion. All I want is text while I install things. It boots up nicely. To my surprise, it starts configuring OpenGL and gives me a Gnome desktop. So far for the text-only install. There is an icon "Install" which I doubleclick. A nice graphical installation application pops up and starts asking questions (17!). One of the questions being "Stage 3 tarball URI". I consult the documentation icon on the desktop, which takes me to <a href='http://www.gentoo.org/proj/en/releng/installer/faq.xml'>the gentoo installer FAQ</a>.<br /><br />Not to my surprise, I can't find any useful information on that page. I do find things like this:<br /><br /><pre><br />Q: Where can I find more information about the installer? <br />A: On the project pages. Currently, there is no documentation. <br />You can either read the source or ask in #gentoo-installer. If <br />you ask any questions covered by this FAQ, you will most likely be ignored.<br /></pre><br /><br />and my favorite:<br /><br /><pre><br />Q: Gentoo is too hard to install and I feel like whining. <br />A: Please see /dev/null.<br /></pre><br /><br />I can see it now: gentoo is probably written by the kind of linux-users I've come to hate.<br /><br />After looking for "stage3" on the entire CD (and not finding anything), I resort to the minimal install CD.<br /><br />This time (again booting with gentoo-nofb), it drops me into a shell. It appears I can skip most of the instructions in the guide since my private network uses DHCP.<br /><br />The next installation step I need my attention for is... partitioning the disk.<br />What is this, did the 80's invade my vmware ?<br /><br />Luckily, it appears the botched installer from the LiveCD already created some partitions for me (even when it couldn't continue the installation because I didn't have a stage3 tarball). Next! "create the filesystems and activate swap". I start hearing YMCA in the background.<br /><br />The next step would be setting time and date, but I couldn't care less about that since it's vmware. <br /><br />The stage3 tarball is 112 MB in size. Something tells me this shouldn't be a problem to put on the Live CD...<br />While I wait for the download to finish, I put some gas in my car and recharge the battery...<br /><br />Now the portage tarball needs to be downloaded, which is 31MB in size.<br /><br />Setting the timezone, hostname, etc...<br /><br />Now for the first gentoo command ! "emerge gentoo-sources"<br /><br />Which seems to download a kernel (another 40MB)...<br /><br />[update: 4th october 2006]<br />I stopped the virtual machine gentoo was on. Basically I got tired of it. Maybe when I have more time, I'll continue
  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2006/09/18/rtsp-connectiontracking/">
        RTSP connectiontracking
      </a>
    </h1>

    <span class="post-date">18 Sep 2006</span>

    I spent most of last week trying to figure out how connection tracking and NAT works in the 2.6 kernel. There is a patch for connectiontracking of RTSP in patch-o-matig-ng, but it didn't compile without Full NAT enabled. So I had to fix it, and I did.<br /><br />Here are the notes I made while figuring out how everything fits together:<br /><br /><pre><br />net/ipv4/netfilter/nf_conntrack_l3proto_ipv4.c:<br />        ipv4_conntrack_in() and ipv4_conntrack_local() get registered into PREROUTING<br /><br />        ipv4_conntrack_in() and ipv4_conntrack_local() call nf_conntrack_in()<br /><br />net/netfilter/nf_conntrack_core.c:<br />        nf_conntrack_in()<br /><br />        # if ((*pskb)->nfct) {<br />        #         NF_CT_STAT_INC(ignore);<br />        #         return NF_ACCEPT;<br />        # }<br /><br />        previously seen or untracked packets are ignored<br />        "The association between a packet and a conntrack is established by means of a pointer"<br />        nfct is that pointer (struct nf_conntrack *nfct; in struct sk_buff, include/linux/skbuff.h)<br /><br />        # l3proto = __nf_ct_l3proto_find((u_int16_t)pf);<br />        # if ((ret = l3proto->prepare(pskb, hooknum, &dataoff, &protonum)) <= 0) {<br />        #         DEBUGP("not prepared to track yet or error occured\n");<br />        #         return -ret;<br />        # } <br /><br />        __nf_ct_l3proto_find() looks up a protocol number and returns a struct nf_conntrack_l3proto *. <br />        This contains pointers to functions like invert_tuple and others.<br />        layer3 is IP -> ipv4, ipv6, ...<br />        e.g. net/ipv4/netfilter/nf_conntrack_l3proto_ipv4.c calls  nf_conntrack_l3proto_register() <br />        to register these functions for ipv4<br /><br />        prepare() fills in some variables for some packet.<br />                dataoff = the offset into the skbuf where data can be found (after the IP header)<br />                protonum = layer 4 protocol number of the packet<br /><br />        # proto = __nf_ct_proto_find((u_int16_t)pf, protonum);<br /><br />        __nf_ct_proto_find() looks up the layer4 protocol number and returns a struct nf_conntrack_protocol *. <br />        This structure also contains pointers to functions<br />        layer4 -> tcp, udp, icmp <br />        e.g. net/ipv4/netfilter/nf_conntrack_l3proto_ipv4.c calls nf_conntrack_protocol_register()<br /><br />        # if (proto->error != NULL &&<br />        #     (ret = proto->error(*pskb, dataoff, &ctinfo, pf, hooknum)) <= 0) {<br />        #         NF_CT_STAT_INC(error);<br />        #         NF_CT_STAT_INC(invalid);<br />        #         return -ret;<br />        # }<br /><br />        the error() hook, e.g. tcp_error() in net/netfilter/nf_conntrack_proto_tcp.c does some checking:<br />        "Protect conntrack agaist broken packets. Code taken from ipt_unclean.c."<br /><br />        # ct = resolve_normal_ct(*pskb, dataoff, pf, protonum, l3proto, proto,<br />        #                        &set_reply, &ctinfo);<br /><br />        "The subsystem tries to look up a conntrack that matches with the packet received. <br />        If no conntrack is found, it will be created. This mechanism is implemented in the <br />        function resolve_normal_ct."<br /><br />                resolve_normal_ct()     - creates a tuple from the connection<br />                                        - the tuple is looked up (to find the conntrack)<br />                                        - if it doesn't exist, one is created and returned with <br />                                          init_conntrack(), which calls expectfn() <br />                                          "< Gandalf__> it's a functionpointer that helpers can set <br />                                           if they want to be notified that the expectation was used"<br />                                        - if the packet is a reply, set the ctinfo to established and <br />                                          mark as a reply. set_reply is 1<br />                                        - otherwise (meaning packets have gone both ways), categorize <br />                                          the packet and set ctinfo to either established, related or <br />                                          new, set_reply = 0<br />                                        - nfct in the packet is no longer NULL<br />                                        - nfctinfo in the packet is set to ctinfo<br />        # if (!ct) {<br />        #         /* Not valid part of a connection */<br />        #         NF_CT_STAT_INC(invalid);<br />        #         return NF_ACCEPT;<br />        # } <br />        #<br />        # if (IS_ERR(ct)) {<br />        #         /* Too stressed to deal. */<br />        #         NF_CT_STAT_INC(drop);<br />        #         return NF_DROP;<br />        # }<br />        #<br />        # NF_CT_ASSERT((*pskb)->nfct);<br /><br />        the returned conntrack is checked.<br /><br />        # ret = proto->packet(ct, *pskb, dataoff, ctinfo, pf, hooknum);<br /><br />        "/* Returns verdict for packet, or -1 for invalid. */"<br />        checks whether packet is a valid packet in this connection (packet in window etc)<br /><br />        # if (ret < 0) {<br />        #         /* Invalid: inverse of the return code tells<br />        #          * the netfilter core what to do */<br />        #         DEBUGP("nf_conntrack_in: Can't track with proto module\n");<br />        #         nf_conntrack_put((*pskb)->nfct);<br />        #         (*pskb)->nfct = NULL;<br />        #         NF_CT_STAT_INC(invalid);<br />        #         return -ret;<br />        # }<br /><br />        nf_conntrack_put() calls destroy on the conntrack<br />        "/* Called when a conntrack entry has already been removed from the hashes<br />          * and is about to be deleted from memory */"<br /><br />        # if (set_reply && !test_and_set_bit(IPS_SEEN_REPLY_BIT, &ct->status))<br />        #         nf_conntrack_event_cache(IPCT_STATUS, *pskb);<br /><br />        if this is the first reply (?), call nf_conntrack_event_cache() # FIXME: what does event cache do ???<br /><br />net/ipv4/netfilter/nf_conntrack_l3proto_ipv4.c:<br />        ipv4_conntrack_help() gets registered into LOCAL INPUT and POSTROUTING<br /><br />        ipv4_conntrack_help()<br />                matches the packet against a conntrack<br />                calls nfct_help() on the conntrack to get a helper function<br />                calls the helper function<br /><br />net/ipv4/netfilter/ip_conntrack_core.c:<br />        ip_conntrack_helper_register() is used to register helper functions<br /><br /><br /><br />ip_nat_*.c mostly just set a hook at init()<br /><br /><br />info on expectfn:<br />        ip_nat_irc.c:<br />        /* When you see the packet, we need to NAT it the same as the<br />         * this one. */<br />        exp->expectfn = ip_nat_follow_master;<br /><br /><br /><br /><br />probable flow:<br />        - new connection comes into prerouting. no conntrack exists so one is created with <br />          init_conntrack() and expectfn() is called if this is a connection we were expecting <br />          and the helper wants to be notified.<br />        - on other packets going out on postrouting or local input, the helper is called, <br />          which checks if an expectation should be launched.<br />        - in this function, also the nat hook is called, which can mangle the packet (like FTP port stuff) <br />          and launches the expectation<br /><br /></pre><br /><br />The <a href="http://people.netfilter.org/pablo/docs/login.pdf">article about netfilter's connectiontracking</a> by Pablo Neira Ayuso was very helpful, as was the <a href="http://www.kernelnewbies.org/">kernel newbies</a> website.
  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2006/09/13/here-it-is/">
        here it is
      </a>
    </h1>

    <span class="post-date">13 Sep 2006</span>

    It's been a month since I posted something (not counting the previous post of course). I keep putting it off because I want to write about all the things I don't want to forget first. But then that is so much that I delay it some more, etc.<br /><br />So now I decided to work away my backlog. Let's see...<br /><br /><dl><br /><dt>Pukkelpop 2006 - 17-20 August 2006</dt><br /><dd>Around newyear, I set forth a couple things I wanted to do this year. One of them was to go to a Keane concert, the other to go to a festival. With Pukkelpop, I could scratch those 2 off my list because Keane was going to be there after a long period of no concerts.<br /><br />I left by train (which cost me nothing because my ticket for Pukkelpop was also valid as a trainticket) the 17th. While on there, I did something I've never done before: I talked to a total stranger. His name was Jan and he's an engineering student. Apparently he was also into electronics, so we talked about that a lot. When I arrived in Kiewit, we lost contact. <br /><br />None of the people that I knew were also going, responded when I called them. So I was pretty much on my own. It took me a while to find a campingspot because the place was crowded. Right after that, I decided to go explore the festival field.<br /><br />It didn't take me long to realise a couple things: 1. this was not my kind of music, 2. meeting with people onsite would be worse than finding gravitons and 3. food and drinks were gonna cost me a fortune.<br /><br />Nonetheless, I heard some interesting music: Michael Franti & Spearhead, Foxylane, Daft Punk, Placebo, Beck and of course Keane.<br /><br />Not surprisingly, most of the big names sounded pretty bad through my ears, but then again, I have bad taste.<br /><br />Those people who I knew usually slept untill noon or worse, so in the mornings things were even more boring than usual.<br />On the last day of the festival (saturday 19th aug), I decided to take a walk to Hasselt and see what was going on there. I had bought my previous digital camera in Mediamarkt in Hasselt and thought I'd go there again to see if they had something nice. They didn't... (I still need a camera!). I walk around the city 2 times trying to find Mediamarkt in the first place. Then I sat down at the restaurant and ate some decent food. On my way back to Kiewit, I dropped by Gamma to locate some acetone. They sell it, although I didn't buy it back then. I doubt I could have taken it on the camping site with all the security. I wouldn't even have wanted to, because acetone is highly flammable.<br /><br />Anyway, on sunday I left for the trainstation and there was free coffee ! A concept that seemed strange after having to pay so much money for drinks.<br /><br />If I decide to go again, I should take these things into consideration: Get a decent tent (army-tent for 10/20 people would be nice), create some kind of homing beacon to locate other people, DON<br />T go on my own, bring something to read and maybe a chair.<br /></dd><br /><br /><dt>First day at work - 21 August</dt><br /><dd>After 7 weeks of vacation, going back to work was very strange. It's like going back to school. No more freedom :) Oh well...</dd><br /><br /><dt>My uncle and aunt's 25 year wedding anniversary - 2 September</dt><br /><dd>Because of some unknown dispute, my parents (and thus my close family) haven't seen the rest of my family for about 10 years or so. It was again an opportunity to test social skills and I did. I had some nice discussions with people I didn't know. They party was really nice (Thermae Palace Oostende). Right up to the point where the DJ turned up the volume, and talking became impossible. So while everyone was dancing away, I was getting more and more bored and finally left.<br /><br />The next day we visited my grandparents (also in Oostende). My grandfather heard I was getting more interesting in electronics and gave me tons of electronic components and books. I'll have plenty to read for the next year or so.</dd><br /><br /><dt>New projects</dt><br /><dd>I was pointed to <a href="http://www.lumenlab.org">http://www.lumenlab.org</a> and was plotting to build my own projector (I gave my old one to my dad), when my eye fell on the "Build your own CNC machine" section in the lumenlab forums. It would be very nice to have a CNC machine for further DIYing... And since noot was already experimenting with stepper motors for his telescope, I decided to go the same path.<br /><br />The first thing I needed to do was make a working stepper motor controller. I bought a Tandon KP4M2 stepper motor with 1.8 degrees per step, 12V. I whipped out my Velleman K8000 kit that I had actually never used before and tried to interface with the stepper motor. The K8000 has 16 opto-couplers that can be used for output. Opto-couplers are like transistors (something i didn't know at first), so you have to connect V+ and V- to the correct sides or you'll get strange results...<br /><br />The KP4M2 is 2-phase, which means 4 wires (2 coils). Each of these coils needs to be able to be powered in each direction. So I needed 4 wires that can go V+ aswell as V-. I solved that by making 2 switches per wire: 1 connected to V+, the other to V-. Each switch is actually an optocoupler. So I needed 16 wires in total going to my K8000. I hooked those up using UTP cable from the K8000 to a breadboard. In my first experiment I used a 9V battery to power the motor.<br /><br />To my surprise, it worked :) Maybe I should post the code, although it's trivial.<br /><br />I implemented fullstep, halfstep and wavedrive. I also attached a leadscrew to the motor with lots of tape (tape coupled rotor ;) and watched it push around some stuff. Now, the battery is dead :/<br />But that's. We have plenty of 12V poweradapters for FOT's that are not used. I can recycle some of those. 12V on the stepper motor should provide a lot more torque.<br /><br />I also bought an L297 and L298 IC. I don't want to control the stepper motor through the K8000 all the time... <br /><br />My brother also asked me to build something with a microcontroller. I have never done that before but I'm willing to give it a try. A lot of info about the 8051, a commonly used microcontroller, can be found at <a href="http://www.8052.com">http://www.8052.com</a><br /></dd><br /><dt>My new computer</dt><br /><dd>My new computer arrived ! Although I paid 50 euro for assembling the PC, the first thing I noticed when I got home was how a memtest86 failed. The shop probably didn't do much thorough testing on it, which is a shame. After some fiddling, it appears that the problem is Dual Channel memory. It just won't work... The shop advised me to apply the latest BIOS upgrades while they contact the manufacturer. I haven't heard from them for 2 weeks or so now, and I doubt they are still doing anything. That doesn't mean I don't want Dual Channel though :) I'll contact them about this soon.<br /><br />Even worse than not having Dual Channel (There are no problems when using single channel, it's just slower), is that the computer won't install Linux ! The problem appears to be the P965 chipset used on Core 2 Duo motherboards. More information on fixes can be found on the <a href="https://wiki.ubuntu.com/Core_2_Duo_Support">Ubuntu Wiki</a><br /></dd><br /></dl><br /><br />rtsp connectiontracking, ... and anything that's not on my mind right now.
  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2006/09/13/it-coming/">
        it's coming
      </a>
    </h1>

    <span class="post-date">13 Sep 2006</span>

    It's been a month since I last posted something on my blog, and a lot of things have happened since.<br />I'll post an update soon.<br /><br />Here are some topics:<br />pukkelpop 2006, my uncle and aunt's second wedding, stepper motor controllers, cnc machine project, projector project, core 2 duo new computer, rtsp connectiontracking, ... and anything that's not on my mind right now.
  </div>
  
</div>

<div class="pagination">
  
    <a class="pagination-item older" href="/page71">Older</a>
  
  
    
      <a class="pagination-item newer" href="/page69">Newer</a>
    
  
</div>

    </div>

  </body>
</html>
