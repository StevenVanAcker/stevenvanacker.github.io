<!DOCTYPE html>
<html lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      Singularity.be &middot; Flawed logic inspecting flawed logic
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/hyde.css">
  <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface">

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-144-precomposed.png">
                                 <link rel="shortcut icon" href="/public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>


  <body>

    <div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <h1>
        <a href="/">
          Singularity.be
        </a>
      </h1>
      <p class="lead">Steven Van Acker's blog</p>
    </div>

    <nav class="sidebar-nav">
      <a class="sidebar-nav-item" href="/">Home</a>

      

      
      
        
          
        
      
        
          
            <a class="sidebar-nav-item" href="/about/">About</a>
          
        
      
        
          
        
      
        
      
        
          
        
      
        
          
            <a class="sidebar-nav-item" href="/projects/">Projects</a>
          
        
      
        
          
            <a class="sidebar-nav-item" href="/publications/">Publications</a>
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
    </nav>

    <!-- <p>&copy; 2016. All rights reserved.</p> -->
  </div>
</div>


    <div class="content container">
      <div class="posts">
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2008/07/18/kickstart-cobbler-server-on-fedora-9/">
        Kickstart a cobbler server on Fedora 9 (and create offspring)
      </a>
    </h1>

    <span class="post-date">18 Jul 2008</span>

    <!-- StevensBlogSpotFilterThing<br /><h3>How many systems do you administer ?</h3><br /><p><br />If you've ever had to install more than a trivial amount of operating systems, you know how to appreciate good automated installation systems. Most (if not all) Linux distributions noticed this and started building automated installation systems. Debian has FAI and preseeding, Solaris has Jumpstart and Redhat has Kickstart. I must admit I took a stab at this problem myself by preseeding a Debian installation CD, but I've noticed that it takes too much of my time to rebuild the installation CD every time a new Debian release happens.<br /></p><br /><p><br />Lucky for me, Kickstart can supposedly be used to automate other linux installations. That's why I've been looking at Kickstart lately. And what can I say ? It works.<br /></p><br /><p><br />So here we go ! Imagine this: I need to install 500 servers, all with different configurations.<br />I create 500 kickstart files, each defining the setup of a single system. Then I... walk up to every of my 500 systems, put in a CD, boot it, tell it where the kickstart file is and let the thing install.<br /></p><br /><p>Allright, I can see some problems right there.</p><br /><ul><br /><li>First of all, I need to create 500 kickstart files, but that's nothing an army of welltrained monkeys with typewriters can't achieve.</li><br /><li>Second, I need to walk up to every machine and put a CD in, wait till it gets to the isolinux screen and then type in the extra "ks=http://example.com/uniquestringoeshere.ks" at the end of the command line.</li><br /><li>Third, this will approximately take forever. I either need to burn 500 CD's to boot from, or I need to wait for each installation to finish and then move the installation CD from one system to the next.</li><br /></ul><br /><br /><p><br />Man, administering systems is hard. In this light, it's a good thing I don't actually have to administer 500 systems. But the guys at Redhat probably do and they came up with their next great idea.<br /></p><br /><br /><br /><h3>Cobbler: Provisioning made easy</h3><br /><p><br />Almost 9 years ago, Intel invented the Preboot eXecution Environment (PXE), which allows eg diskless computers to boot over network without any user interaction. As part of the boot process, the BIOS might try several disks, CD-drives and floppydisk stations to try and boot, after which it can ask a networkcard to do the same. The networkcard will then try to locate a suitable server from which it can get data to boot up with.<br /></p><br /><p><br />Setting up a TFTP server to do this is not that difficult, but some other steps are involved that combine many small easy tasks into a very big time-consuming list of tasks. This is where cobbler comes in.<br /></p><br /><p><br />Cobbler is a provisioning infrastructure that takes care of all the underlying details and components for you. After installing and configuring cobbler, you basically tell it which CD you want to "publish" through PXE and it just happens. Clients booting through PXE will then get a nice menu where they can select what the want to boot. Even better, you can tell cobbler about a specific system in advance (by registering its MAC address for example) and then that system won't see a menu at all, it will just boot into whatever you specify.<br /></p><br /><small>giggity</small><br /><p>Right, let's look at how cobbler works</p><br /><br /><h3>Cobbler concepts</h3><br /><p><br />There are 3 concepts that pop up all the time and that I needed to understand. I will describe them here as I understand them, AT NO EXTRA COST. You can thank me later.<br /></p><br /><br /><dl><br /><dt>Distributions</dt><br /><dd>This is pretty much self explanatory. A distribution is a ... If I want to install a Centos 5 on a i386 somewhere, I need to make a "distribution" containing the Centos 5 DVD which I can name "Centos 5 i386"</dd><br /><dt>Profiles</dt><br /><dd>This is what you get when you pack a distribution together with a kickstart file. If I want to install a Centos 5 with an apache and SSH server on it, I make a kickstart file for it and glue it together with a "Centos 5" distribution and call that a "Centos 5 Webserver+SSH" profile.</dd><br /><dt>Systems</dt><br /><dd>Associating a certain physical system with a profile happens through a "System" specification. If I want to install my cute yellow 486 here under the table using the "Centos 5 Webserver+SSH" profile, I need to make a system specification by specifying the MAC-address, IP and hostname (tweety) I want for this server. Then I call this system "tweety"</dd><br /><dd><br /></dl><br /><br />[FULLIMG:http://data.singularity.be/images/full/undated/cobbler/cobbler.png]<br /><br />Here's a little scheme to show how these things fit together. You can have several distributions (in pinkish red), each of which can have several profiles associated with it (green), each of which can have several systems to it (yellow).<br /><br /><h3>Lab setup</h3><br /><br /><p><br />On to the practical side of cobbler. I'm going to setup a cobbler server on Fedora 9 and use that to install another system using Fedora 9 aswell. All of this will be done in Virtualbox.<br /></p><br /><br />[FULLIMG:http://data.singularity.be/images/full/undated/cobbler/cobbler_lab_setup.png]<br /><br /><p><br />The cobbler server will be named "vishnu" and it will have 2 networkcards: eth0 will be connected to an internet-connected network with DHCP on it. eth1 will be connected to a private network without any traffic on it (static IP). The private network has IP-range 172.16.1.0/24<br /></p><br /><br /><p><br />The machine to be installed using cobbler, has no name really. It has 1 networkcard connected to the private network and boots PXE.<br /></p><br /><br /><h3>Kickstarting the cobbler server: vishnu</h3><br /><p><br />Installing cobbler is fairly simple. Install the base operating system, then use yum to install cobbler, edit some configfiles and you're done. This doesn't include adding distributions or profiles though.<br /></p><br /><br /><p><br />But wait a minute. Do I really want to install vishnu manually ? Booting the CD and going through the installation process after which I have to login, install packages and edit configfiles ?<br />Of course not. This is exactly what kickstart was created for, so let's use it.<br /></p><br /><br /><p>This is the kickstart file I use for vishnu:</p><br />[PRE]<br />#version=F9<br />install<br />text<br />cdrom<br />lang en_US.UTF-8<br />keyboard us<br />timezone --utc Europe/Brussels<br /><br /><br /># network settings<br />network --device eth0 --bootproto dhcp --hostname vishnu<br />network --device eth1 --bootproto static --ip 172.16.1.1 --netmask 255.255.255.0<br /><br /># root account<br />authconfig --enableshadow --passalgo=sha512<br />rootpw  --iscrypted $1$6cEAJbnh$TdRTNKsAnwE/PYw3dk/o20<br /><br /># security<br />#firewall --enabled --ssh --dhcp --trust eth1<br />firewall --disabled<br />selinux --enforcing<br /><br /># partitioning and bootloader<br />clearpart --all<br />autopart <br />bootloader --location=mbr<br /><br /># reboot when done<br />reboot<br /><br />%packages --nobase<br />acl<br />acpid<br />anacron<br />attr<br />authconfig<br />bind-utils<br />cronie<br />cyrus-sasl-plain<br />dhclient<br />ed<br />efibootmgr<br />eject<br />file<br />gpm<br />grub<br />hdparm<br />kbd<br />kernel<br />man<br />nc<br />nss_db<br />openssh-clients<br />openssh-server<br />prelink<br />rng-utils<br />selinux-policy-targeted<br />sendmail<br />setserial<br />setuptool<br />symlinks<br />system-config-firewall-tui<br />tcpdump<br />time<br />traceroute<br />vim-minimal<br />wget<br />which<br />yum-utils<br />%end<br /><br />%post<br /><br /># disable selinux<br />fpath=/etc/selinux/config<br />cp $fpath $fpath.orig<br />cat $fpath.orig | sed 's/^SELINUX=.*/SELINUX=disabled/' > $fpath<br /><br /># enable networking, since we removed networkmanager<br />chkconfig network on<br /><br /># provide good ls colors for a dark background<br />ln -s /etc/DIR_COLORS /root/.dir_colors<br /><br /># now install some muchneeded packages<br />yum install -y bash-completion cobbler dhcp syslinux vim-enhanced<br /><br /># setting server and next_server in /etc/cobbler/settings<br />fpath=/etc/cobbler/settings<br />cp $fpath $fpath.orig<br />cat $fpath.orig | sed 's/127.0.0.1/172.16.1.1/g' | sed 's/manage_dhcp:.*/manage_dhcp: 1/' > $fpath<br /><br /># Must enable selinux boolean to enable Apache and web services components<br />setsebool -P httpd_can_network_connect true<br /><br /># enable tftp<br />fpath=/etc/xinetd.d/tftp<br />cp $fpath $fpath.orig<br />cat $fpath.orig | sed 's/disable.*=.*/disable                 = no/' > $fpath<br /><br /># start httpd at boot<br />chkconfig httpd on<br /><br /># change default password "cobbler" to "trial"<br />for f in /etc/cobbler/*.ks;<br />do<br />    cp $f $f.orig<br />    cat $f.orig | sed 's/rootpw --iscrypted.*/rootpw --iscrypted \\\$1\\\$MZmukub3\\\$SMFCloWQ\/d2jhTC3nZOEK0/' > $f<br />done<br /><br /># only do DHCP on eth1<br />fpath=/etc/sysconfig/dhcpd<br />cp $fpath $fpath.orig<br />cat $fpath.orig | sed 's/DHCPARGS=.*/DHCPARGS=eth1/' > $fpath<br /><br /># eth1 network is 172.16.1.0/24<br />fpath=/etc/cobbler/dhcp.template<br />cp $fpath $fpath.orig<br />cat $fpath.orig | sed 's/192.168.1/172.16.1/g' | grep -v "option routers" > $fpath<br /><br /># start dhcpd at boot<br />chkconfig dhcpd on<br /><br /># sync config<br />cobbler sync<br /><br />%end<br />[/PRE]<br />[DOWNLOAD:http://data.singularity.be/rh/vishnu-20080718]<br /><br /><p>No need to fire up john to crack this crypted password, its "trial"</p><br /><br /><p>Note that I specified a list of packages to install (%packages section) and told kickstart not to install anything else, not even the base system. There is no real-life use for this. The only purpose I had for stripping down a bare Fedora 9 install to the bare minimum, was minimizing installation time.<br /></p><br /><br /><p>The other noteworthy part in this kickstart file is the %post section, which contains a script to be executed on the installed machine after installation completes. Here is what it does:<br /></p><br /><br /><dl><br /><dt>Disable selinux</dt><br /><dd>By default, Fedora 9 switches on SELinux which is a good thing. However, apache was having problems with SELinux when I mounted a DVD under its documentroot. Because I don't have extensive SELinux knowledge to fix this, I took the cheesy way out and just disabled it. Note that you can also just put "selinux --disabled" in the kickstart file, but this way I have an excuse to try and fix my setup later...</dd><br /><dt>Enable networking</dt><br /><dd>This one is pretty silly and I suspect it is a Fedora bug. Because I have stripped down Fedora to the bare minimum, NetworkManager was not installed. I would have expected that Fedora took a moment to think about that and then enable networking without NetworkManager. But it didn't so I have to enable it manually.</dd><br /><dt>Installing needed packages</dt><br /><dd>Install cobbler and friends. Also install bash-completion (I'm a huge fan of bash-completion and am thrilled to have learned that bash-completion scripts will be included in future versions of cobbler!) and vim-enhanced</dd><br /><dt>Fix some settings</dt><br /><dd>After installing cobbler, one would normally run "cobbler check" and fix everything cobbler complains about. Well, I did that in the script.</dd><br /><dt>only do DHCP on eth1</dt><br /><dd>I'm a network administrator and my kind has a serious disgust of rogue DHCP servers on our networks. (So much in fact that I have wirecutters in my desk to cut through UTP cable from offending users). Since this cobbler setup deploys a DHCP server, make sure it only runs on the private network where it belongs: eth1</dd><br /><dt>Modify the dhcp.template file</dt><br /><dd>The private network will use a DHCP range of 172.16.1.0/24</dd><br /><dt>switch on the dhcpd server</dt><br /><dd>.. so it will start at boot</dd><br /><dt>cobbler sync</dt><br /><dd>This command will generate configfiles for all cobbler components from templates and such.</dd><br /></dl><br /><br /><p>To use this kickstart file, boot a Fedora 9 DVD in a virtual machine with 2 networkcards of which eth0 is connected to a DHCP-enabled and internetconnected network. Then at the isolinux menu, press tab and add the following:</p><br /><br />[PRE]<br /> ks=http://data.singularity.be/rh/vishnu-20080718 ksdevice=eth0<br />[/PRE]<br /><br />[FULLIMG:http://data.singularity.be/images/full/undated/cobbler/fedora-isolinux.png]<br /><br /><p><br />In my lab, it takes only 9 minutes and 10 seconds after I press enter on the commandline above untill I get to vishnu's login prompt.<br /></p><br /><br />[FULLIMG:http://data.singularity.be/images/full/undated/cobbler/vishnu-login.png]<br /><br /><h3>Vishnu's first offspring: localhost</h3><br /><br /><p><br />Before we can create cobbler offspring, we need to setup a distribution and such. Normally when importing a distribution, cobbler copies all necessary files to the local disk. But I think that's a bit overkill for a simple labsetup like this. So instead, I will mount the DVD and make it available over HTTP.<br /></p><br /><br /><p>Log in to vishnu and execute these commands:</p><br />[PRE]<br />mkdir /var/www/cobbler/mounted<br />mount /dev/cdrom /var/www/cobbler/mounted<br />cobbler import --name=F9 --mirror=/var/www/cobbler/mounted/ --available-as=http://172.16.1.1/cobbler/mounted/<br />cobbler distro edit --name=F9-i386 --ksmeta="tree=http://@@server@@/cobbler/mounted"<br />cobbler profile edit --name=F9-i386 --kickstart=/etc/cobbler/sample.ks<br />cobbler sync<br />[/PRE]<br /><br /><p>Breaking it down with explanations</p><br />[PRE]mkdir /var/www/cobbler/mounted[/PRE]<br /><p>... creates a mountpoint for the Fedora 9 DVD</p><br /><br />[PRE]mount /dev/cdrom /var/www/cobbler/mounted[/PRE]<br /><p>... mount the DVD there</p><br /><br />[PRE]cobbler import --name=F9 --mirror=/var/www/cobbler/mounted/ --available-as=http://172.16.1.1/cobbler/mounted/[/PRE]<br /><p>... import the distribution, but tell cobbler to not mirror it and instead send the client to the given URL. This URL is the reason why the DVD is mounted under the apache documentroot.</p><br /><br />[PRE]cobbler distro edit --name=F9-i386 --ksmeta="tree=http://@@server@@/cobbler/mounted"[/PRE]<br /><p>... tell cobbler how to fill in the "$tree" variable for this distribution. Normally this is handled by "cobbler import", but this is not a normal setup so we need to fix it manually (for now)</p><br />[PRE]cobbler profile edit --name=F9-i386 --kickstart=/etc/cobbler/sample.ks[/PRE]<br /><p>... for some reason, cobbler gives an error with the above import command and does not link a kickstart file to the F9-i386 profile. Fixing this manually as well, probably a bug, this is what the error looked like:</p><br /><br />[PRE]<br />[root@vishnu ~]# cobbler import --name=F9 --mirror=/var/www/cobbler/mounted/ --available-as=http://172.16.1.1/cobbler/mounted/<br />---------------- (adding distros)<br />- scanning /var/www/cobbler/mounted for architecture info<br />- kernel header found: kernel-headers-2.6.25-14.fc9.i386.rpm<br />- creating new distro: F9-i386<br />- creating new profile: F9-i386<br />- scanning /var/www/cobbler/mounted for architecture info<br />- kernel header found: kernel-headers-2.6.25-14.fc9.i386.rpm<br />- creating new distro: F9-xen-i386<br />- creating new profile: F9-xen-i386<br />---------------- (associating kickstarts)<br />- finding default kickstart template for fedora 9.0<br />/var/www/cobbler/mounted/, /var/www/cobbler/mounted, -1<br />Error: possible symlink traversal?: /var/www/cobbler/mounted<br />[root@vishnu ~]# <br />[/PRE]<br /><br />[PRE]cobbler sync[/PRE]<br /><p>... and sync cobbler configs</p><br /><br /><p>Now you're done !<br />Boot a fresh machine using PXE and you should get a nice menu like this:</p><br /><br />[FULLIMG:http://data.singularity.be/images/full/undated/cobbler/client-pxe-menu.png]<br /><br /><p>Select F9-i386 and press enter. The installation process should take over and do everything automatically from there on.</p><br /><br /><p><br />PS: And what about hiring an army of monkeys with typewriters to generate the kickstart files ? There's a solution for that too. It's called puppet, but that's a story for a later time.<br /></p><br /><br /><br /><br /><br />StevensBlogSpotFilterThing --><br /><h3>How many systems do you administer ?</h3><br /><p><br />If you've ever had to install more than a trivial amount of operating systems, you know how to appreciate good automated installation systems. Most (if not all) Linux distributions noticed this and started building automated installation systems. Debian has FAI and preseeding, Solaris has Jumpstart and Redhat has Kickstart. I must admit I took a stab at this problem myself by preseeding a Debian installation CD, but I've noticed that it takes too much of my time to rebuild the installation CD every time a new Debian release happens.<br /></p><br /><p><br />Lucky for me, Kickstart can supposedly be used to automate other linux installations. That's why I've been looking at Kickstart lately. And what can I say ? It works.<br /></p><br /><p><br />So here we go ! Imagine this: I need to install 500 servers, all with different configurations.<br />I create 500 kickstart files, each defining the setup of a single system. Then I... walk up to every of my 500 systems, put in a CD, boot it, tell it where the kickstart file is and let the thing install.<br /></p><br /><p>Allright, I can see some problems right there.</p><br /><ul><br /><li>First of all, I need to create 500 kickstart files, but that's nothing an army of welltrained monkeys with typewriters can't achieve.</li><br /><li>Second, I need to walk up to every machine and put a CD in, wait till it gets to the isolinux screen and then type in the extra "ks=http://example.com/uniquestringoeshere.ks" at the end of the command line.</li><br /><li>Third, this will approximately take forever. I either need to burn 500 CD's to boot from, or I need to wait for each installation to finish and then move the installation CD from one system to the next.</li><br /></ul><br /><br /><p><br />Man, administering systems is hard. In this light, it's a good thing I don't actually have to administer 500 systems. But the guys at Redhat probably do and they came up with their next great idea.<br /></p><br /><br /><br /><h3>Cobbler: Provisioning made easy</h3><br /><p><br />Almost 9 years ago, Intel invented the Preboot eXecution Environment (PXE), which allows eg diskless computers to boot over network without any user interaction. As part of the boot process, the BIOS might try several disks, CD-drives and floppydisk stations to try and boot, after which it can ask a networkcard to do the same. The networkcard will then try to locate a suitable server from which it can get data to boot up with.<br /></p><br /><p><br />Setting up a TFTP server to do this is not that difficult, but some other steps are involved that combine many small easy tasks into a very big time-consuming list of tasks. This is where cobbler comes in.<br /></p><br /><p><br />Cobbler is a provisioning infrastructure that takes care of all the underlying details and components for you. After installing and configuring cobbler, you basically tell it which CD you want to "publish" through PXE and it just happens. Clients booting through PXE will then get a nice menu where they can select what the want to boot. Even better, you can tell cobbler about a specific system in advance (by registering its MAC address for example) and then that system won't see a menu at all, it will just boot into whatever you specify.<br /></p><br /><small>giggity</small><br /><p>Right, let's look at how cobbler works</p><br /><br /><h3>Cobbler concepts</h3><br /><p><br />There are 3 concepts that pop up all the time and that I needed to understand. I will describe them here as I understand them, AT NO EXTRA COST. You can thank me later.<br /></p><br /><br /><dl><br /><dt>Distributions</dt><br /><dd>This is pretty much self explanatory. A distribution is a ... If I want to install a Centos 5 on a i386 somewhere, I need to make a "distribution" containing the Centos 5 DVD which I can name "Centos 5 i386"</dd><br /><dt>Profiles</dt><br /><dd>This is what you get when you pack a distribution together with a kickstart file. If I want to install a Centos 5 with an apache and SSH server on it, I make a kickstart file for it and glue it together with a "Centos 5" distribution and call that a "Centos 5 Webserver+SSH" profile.</dd><br /><dt>Systems</dt><br /><dd>Associating a certain physical system with a profile happens through a "System" specification. If I want to install my cute yellow 486 here under the table using the "Centos 5 Webserver+SSH" profile, I need to make a system specification by specifying the MAC-address, IP and hostname (tweety) I want for this server. Then I call this system "tweety"</dd><br /><dd><br /></dl><br /><br /><a href="http://data.singularity.be/images/full/undated/cobbler/cobbler.png"><img src="http://data.singularity.be/images/full/undated/cobbler/cobbler.png"></a><br /><br />Here's a little scheme to show how these things fit together. You can have several distributions (in pinkish red), each of which can have several profiles associated with it (green), each of which can have several systems to it (yellow).<br /><br /><h3>Lab setup</h3><br /><br /><p><br />On to the practical side of cobbler. I'm going to setup a cobbler server on Fedora 9 and use that to install another system using Fedora 9 aswell. All of this will be done in Virtualbox.<br /></p><br /><br /><a href="http://data.singularity.be/images/full/undated/cobbler/cobbler_lab_setup.png"><img src="http://data.singularity.be/images/full/undated/cobbler/cobbler_lab_setup.png"></a><br /><br /><p><br />The cobbler server will be named "vishnu" and it will have 2 networkcards: eth0 will be connected to an internet-connected network with DHCP on it. eth1 will be connected to a private network without any traffic on it (static IP). The private network has IP-range 172.16.1.0/24<br /></p><br /><br /><p><br />The machine to be installed using cobbler, has no name really. It has 1 networkcard connected to the private network and boots PXE.<br /></p><br /><br /><h3>Kickstarting the cobbler server: vishnu</h3><br /><p><br />Installing cobbler is fairly simple. Install the base operating system, then use yum to install cobbler, edit some configfiles and you're done. This doesn't include adding distributions or profiles though.<br /></p><br /><br /><p><br />But wait a minute. Do I really want to install vishnu manually ? Booting the CD and going through the installation process after which I have to login, install packages and edit configfiles ?<br />Of course not. This is exactly what kickstart was created for, so let's use it.<br /></p><br /><br /><p>This is the kickstart file I use for vishnu:</p><br /><pre style="background-color: #EEEEEE; border: black 1px dashed; line-height: 100%; padding: 10px;"><br />#version=F9<br />install<br />text<br />cdrom<br />lang en_US.UTF-8<br />keyboard us<br />timezone --utc Europe/Brussels<br /><br /><br /># network settings<br />network --device eth0 --bootproto dhcp --hostname vishnu<br />network --device eth1 --bootproto static --ip 172.16.1.1 --netmask 255.255.255.0<br /><br /># root account<br />authconfig --enableshadow --passalgo=sha512<br />rootpw  --iscrypted $1$6cEAJbnh$TdRTNKsAnwE/PYw3dk/o20<br /><br /># security<br />#firewall --enabled --ssh --dhcp --trust eth1<br />firewall --disabled<br />selinux --enforcing<br /><br /># partitioning and bootloader<br />clearpart --all<br />autopart <br />bootloader --location=mbr<br /><br /># reboot when done<br />reboot<br /><br />%packages --nobase<br />acl<br />acpid<br />anacron<br />attr<br />authconfig<br />bind-utils<br />cronie<br />cyrus-sasl-plain<br />dhclient<br />ed<br />efibootmgr<br />eject<br />file<br />gpm<br />grub<br />hdparm<br />kbd<br />kernel<br />man<br />nc<br />nss_db<br />openssh-clients<br />openssh-server<br />prelink<br />rng-utils<br />selinux-policy-targeted<br />sendmail<br />setserial<br />setuptool<br />symlinks<br />system-config-firewall-tui<br />tcpdump<br />time<br />traceroute<br />vim-minimal<br />wget<br />which<br />yum-utils<br />%end<br /><br />%post<br /><br /># disable selinux<br />fpath=/etc/selinux/config<br />cp $fpath $fpath.orig<br />cat $fpath.orig | sed 's/^SELINUX=.*/SELINUX=disabled/' > $fpath<br /><br /># enable networking, since we removed networkmanager<br />chkconfig network on<br /><br /># provide good ls colors for a dark background<br />ln -s /etc/DIR_COLORS /root/.dir_colors<br /><br /># now install some muchneeded packages<br />yum install -y bash-completion cobbler dhcp syslinux vim-enhanced<br /><br /># setting server and next_server in /etc/cobbler/settings<br />fpath=/etc/cobbler/settings<br />cp $fpath $fpath.orig<br />cat $fpath.orig | sed 's/127.0.0.1/172.16.1.1/g' | sed 's/manage_dhcp:.*/manage_dhcp: 1/' > $fpath<br /><br /># Must enable selinux boolean to enable Apache and web services components<br />setsebool -P httpd_can_network_connect true<br /><br /># enable tftp<br />fpath=/etc/xinetd.d/tftp<br />cp $fpath $fpath.orig<br />cat $fpath.orig | sed 's/disable.*=.*/disable                 = no/' > $fpath<br /><br /># start httpd at boot<br />chkconfig httpd on<br /><br /># change default password "cobbler" to "trial"<br />for f in /etc/cobbler/*.ks;<br />do<br />    cp $f $f.orig<br />    cat $f.orig | sed 's/rootpw --iscrypted.*/rootpw --iscrypted \\\$1\\\$MZmukub3\\\$SMFCloWQ\/d2jhTC3nZOEK0/' > $f<br />done<br /><br /># only do DHCP on eth1<br />fpath=/etc/sysconfig/dhcpd<br />cp $fpath $fpath.orig<br />cat $fpath.orig | sed 's/DHCPARGS=.*/DHCPARGS=eth1/' > $fpath<br /><br /># eth1 network is 172.16.1.0/24<br />fpath=/etc/cobbler/dhcp.template<br />cp $fpath $fpath.orig<br />cat $fpath.orig | sed 's/192.168.1/172.16.1/g' | grep -v "option routers" > $fpath<br /><br /># start dhcpd at boot<br />chkconfig dhcpd on<br /><br /># sync config<br />cobbler sync<br /><br />%end<br /></pre><br /><div style="padding: 2px; background-color: #f0f0f0;"><a href="http://data.singularity.be/rh/vishnu-20080718"><img style="vertical-align: middle; padding: 2px;" src="http://data.singularity.be/images/icon/download-icon.png">Download http://data.singularity.be/rh/vishnu-20080718</a></div><br /><br /><p>No need to fire up john to crack this crypted password, its "trial"</p><br /><br /><p>Note that I specified a list of packages to install (%packages section) and told kickstart not to install anything else, not even the base system. There is no real-life use for this. The only purpose I had for stripping down a bare Fedora 9 install to the bare minimum, was minimizing installation time.<br /></p><br /><br /><p>The other noteworthy part in this kickstart file is the %post section, which contains a script to be executed on the installed machine after installation completes. Here is what it does:<br /></p><br /><br /><dl><br /><dt>Disable selinux</dt><br /><dd>By default, Fedora 9 switches on SELinux which is a good thing. However, apache was having problems with SELinux when I mounted a DVD under its documentroot. Because I don't have extensive SELinux knowledge to fix this, I took the cheesy way out and just disabled it. Note that you can also just put "selinux --disabled" in the kickstart file, but this way I have an excuse to try and fix my setup later...</dd><br /><dt>Enable networking</dt><br /><dd>This one is pretty silly and I suspect it is a Fedora bug. Because I have stripped down Fedora to the bare minimum, NetworkManager was not installed. I would have expected that Fedora took a moment to think about that and then enable networking without NetworkManager. But it didn't so I have to enable it manually.</dd><br /><dt>Installing needed packages</dt><br /><dd>Install cobbler and friends. Also install bash-completion (I'm a huge fan of bash-completion and am thrilled to have learned that bash-completion scripts will be included in future versions of cobbler!) and vim-enhanced</dd><br /><dt>Fix some settings</dt><br /><dd>After installing cobbler, one would normally run "cobbler check" and fix everything cobbler complains about. Well, I did that in the script.</dd><br /><dt>only do DHCP on eth1</dt><br /><dd>I'm a network administrator and my kind has a serious disgust of rogue DHCP servers on our networks. (So much in fact that I have wirecutters in my desk to cut through UTP cable from offending users). Since this cobbler setup deploys a DHCP server, make sure it only runs on the private network where it belongs: eth1</dd><br /><dt>Modify the dhcp.template file</dt><br /><dd>The private network will use a DHCP range of 172.16.1.0/24</dd><br /><dt>switch on the dhcpd server</dt><br /><dd>.. so it will start at boot</dd><br /><dt>cobbler sync</dt><br /><dd>This command will generate configfiles for all cobbler components from templates and such.</dd><br /></dl><br /><br /><p>To use this kickstart file, boot a Fedora 9 DVD in a virtual machine with 2 networkcards of which eth0 is connected to a DHCP-enabled and internetconnected network. Then at the isolinux menu, press tab and add the following:</p><br /><br /><pre style="background-color: #EEEEEE; border: black 1px dashed; line-height: 100%; padding: 10px;"><br /> ks=http://data.singularity.be/rh/vishnu-20080718 ksdevice=eth0<br /></pre><br /><br /><a href="http://data.singularity.be/images/full/undated/cobbler/fedora-isolinux.png"><img src="http://data.singularity.be/images/full/undated/cobbler/fedora-isolinux.png"></a><br /><br /><p><br />In my lab, it takes only 9 minutes and 10 seconds after I press enter on the commandline above untill I get to vishnu's login prompt.<br /></p><br /><br /><a href="http://data.singularity.be/images/full/undated/cobbler/vishnu-login.png"><img src="http://data.singularity.be/images/full/undated/cobbler/vishnu-login.png"></a><br /><br /><h3>Vishnu's first offspring: localhost</h3><br /><br /><p><br />Before we can create cobbler offspring, we need to setup a distribution and such. Normally when importing a distribution, cobbler copies all necessary files to the local disk. But I think that's a bit overkill for a simple labsetup like this. So instead, I will mount the DVD and make it available over HTTP.<br /></p><br /><br /><p>Log in to vishnu and execute these commands:</p><br /><pre style="background-color: #EEEEEE; border: black 1px dashed; line-height: 100%; padding: 10px;"><br />mkdir /var/www/cobbler/mounted<br />mount /dev/cdrom /var/www/cobbler/mounted<br />cobbler import --name=F9 --mirror=/var/www/cobbler/mounted/ --available-as=http://172.16.1.1/cobbler/mounted/<br />cobbler distro edit --name=F9-i386 --ksmeta="tree=http://@@server@@/cobbler/mounted"<br />cobbler profile edit --name=F9-i386 --kickstart=/etc/cobbler/sample.ks<br />cobbler sync<br /></pre><br /><br /><p>Breaking it down with explanations</p><br /><pre style="background-color: #EEEEEE; border: black 1px dashed; line-height: 100%; padding: 10px;">mkdir /var/www/cobbler/mounted</pre><br /><p>... creates a mountpoint for the Fedora 9 DVD</p><br /><br /><pre style="background-color: #EEEEEE; border: black 1px dashed; line-height: 100%; padding: 10px;">mount /dev/cdrom /var/www/cobbler/mounted</pre><br /><p>... mount the DVD there</p><br /><br /><pre style="background-color: #EEEEEE; border: black 1px dashed; line-height: 100%; padding: 10px;">cobbler import --name=F9 --mirror=/var/www/cobbler/mounted/ --available-as=http://172.16.1.1/cobbler/mounted/</pre><br /><p>... import the distribution, but tell cobbler to not mirror it and instead send the client to the given URL. This URL is the reason why the DVD is mounted under the apache documentroot.</p><br /><br /><pre style="background-color: #EEEEEE; border: black 1px dashed; line-height: 100%; padding: 10px;">cobbler distro edit --name=F9-i386 --ksmeta="tree=http://@@server@@/cobbler/mounted"</pre><br /><p>... tell cobbler how to fill in the "$tree" variable for this distribution. Normally this is handled by "cobbler import", but this is not a normal setup so we need to fix it manually (for now)</p><br /><pre style="background-color: #EEEEEE; border: black 1px dashed; line-height: 100%; padding: 10px;">cobbler profile edit --name=F9-i386 --kickstart=/etc/cobbler/sample.ks</pre><br /><p>... for some reason, cobbler gives an error with the above import command and does not link a kickstart file to the F9-i386 profile. Fixing this manually as well, probably a bug, this is what the error looked like:</p><br /><br /><pre style="background-color: #EEEEEE; border: black 1px dashed; line-height: 100%; padding: 10px;"><br />[root@vishnu ~]# cobbler import --name=F9 --mirror=/var/www/cobbler/mounted/ --available-as=http://172.16.1.1/cobbler/mounted/<br />---------------- (adding distros)<br />- scanning /var/www/cobbler/mounted for architecture info<br />- kernel header found: kernel-headers-2.6.25-14.fc9.i386.rpm<br />- creating new distro: F9-i386<br />- creating new profile: F9-i386<br />- scanning /var/www/cobbler/mounted for architecture info<br />- kernel header found: kernel-headers-2.6.25-14.fc9.i386.rpm<br />- creating new distro: F9-xen-i386<br />- creating new profile: F9-xen-i386<br />---------------- (associating kickstarts)<br />- finding default kickstart template for fedora 9.0<br />/var/www/cobbler/mounted/, /var/www/cobbler/mounted, -1<br />Error: possible symlink traversal?: /var/www/cobbler/mounted<br />[root@vishnu ~]# <br /></pre><br /><br /><pre style="background-color: #EEEEEE; border: black 1px dashed; line-height: 100%; padding: 10px;">cobbler sync</pre><br /><p>... and sync cobbler configs</p><br /><br /><p>Now you're done !<br />Boot a fresh machine using PXE and you should get a nice menu like this:</p><br /><br /><a href="http://data.singularity.be/images/full/undated/cobbler/client-pxe-menu.png"><img src="http://data.singularity.be/images/full/undated/cobbler/client-pxe-menu.png"></a><br /><br /><p>Select F9-i386 and press enter. The installation process should take over and do everything automatically from there on.</p><br /><br /><p><br />PS: And what about hiring an army of monkeys with typewriters to generate the kickstart files ? There's a solution for that too. It's called puppet, but that's a story for a later time.<br /></p>
  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2008/07/18/vacuform-light-at-end-of-tunnel/">
        Vacuform: light at the end of the tunnel
      </a>
    </h1>

    <span class="post-date">18 Jul 2008</span>

    <!-- StevensBlogSpotFilterThing<br />I've finally been able to put some more work into the vacuform oven. I don't have all the lamps yet (and I'm missing a couple nuts and bolts too, the store was out) but the following proves that it can work ;)<br /><br />[IMG:2008-07-18/CIMG1601.JPG][IMG:2008-07-18/CIMG1602.JPG][IMG:2008-07-18/CIMG1603.JPG][IMG:2008-07-18/CIMG1604.JPG][IMG:2008-07-18/CIMG1605.JPG][IMG:2008-07-18/CIMG1606.JPG][IMG:2008-07-18/CIMG1607.JPG][IMG:2008-07-18/CIMG1608.JPG][IMG:2008-07-18/CIMG1609.JPG]<br /><br />StevensBlogSpotFilterThing --><br />I've finally been able to put some more work into the vacuform oven. I don't have all the lamps yet (and I'm missing a couple nuts and bolts too, the store was out) but the following proves that it can work ;)<br /><br /><a href="http://data.singularity.be/images/full/2008-07-18/CIMG1601.JPG"><img src="http://data.singularity.be/images/thumb/2008-07-18/CIMG1601.JPG.png"></a><a href="http://data.singularity.be/images/full/2008-07-18/CIMG1602.JPG"><img src="http://data.singularity.be/images/thumb/2008-07-18/CIMG1602.JPG.png"></a><a href="http://data.singularity.be/images/full/2008-07-18/CIMG1603.JPG"><img src="http://data.singularity.be/images/thumb/2008-07-18/CIMG1603.JPG.png"></a><a href="http://data.singularity.be/images/full/2008-07-18/CIMG1604.JPG"><img src="http://data.singularity.be/images/thumb/2008-07-18/CIMG1604.JPG.png"></a><a href="http://data.singularity.be/images/full/2008-07-18/CIMG1605.JPG"><img src="http://data.singularity.be/images/thumb/2008-07-18/CIMG1605.JPG.png"></a><a href="http://data.singularity.be/images/full/2008-07-18/CIMG1606.JPG"><img src="http://data.singularity.be/images/thumb/2008-07-18/CIMG1606.JPG.png"></a><a href="http://data.singularity.be/images/full/2008-07-18/CIMG1607.JPG"><img src="http://data.singularity.be/images/thumb/2008-07-18/CIMG1607.JPG.png"></a><a href="http://data.singularity.be/images/full/2008-07-18/CIMG1608.JPG"><img src="http://data.singularity.be/images/thumb/2008-07-18/CIMG1608.JPG.png"></a><a href="http://data.singularity.be/images/full/2008-07-18/CIMG1609.JPG"><img src="http://data.singularity.be/images/thumb/2008-07-18/CIMG1609.JPG.png"></a>
  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2008/07/17/playing-with-rpm-dependencies-pruning/">
        Playing with RPM dependencies: pruning the tree
      </a>
    </h1>

    <span class="post-date">17 Jul 2008</span>

    <!-- StevensBlogSpotFilterThing<br />I've set up a Fedora 9 and stripped everything I don't need out of it. Now I would like to make a kickstart profile out of it. But instead of telling kickstart to install the (mandatory) basesystem and then removing all the packages I list, I want to tell it to not install ANYTHING, except the packages I tell it to (ie. the basesystem minus some crap).<br /><br />So, I took the list of packages that I had installed, generated a dependency tree of it (using the graph generator from the previous post) and then threw out all packages in the list that were going to be installed anyway because the are dependencies of other packages.<br /><br />This is the script I used:<br /><br />[PRE]<br />#!/usr/bin/perl<br /><br />$AllPackages = {};<br />$Requires = {};<br />$RequiredBy = {};<br /><br />sub parseGeneratedDOTFile {<br />    my ($filename) = @_;<br /><br />    open IN, "$filename";<br />    while(my $line = &lt;IN&gt;) {<br />        if($line =~ /^"([^"]+)" -> "([^"]+)";$/) {<br />     $AllPackages->{$1} = 1;<br />     $AllPackages->{$2} = 1;<br />     $Requires->{$1}->{$2} = 1;<br />     $RequiredBy->{$2}->{$1} = 1;<br /> }<br />    }<br />    close IN;<br />}<br /><br /># requires(a,b) -> does a require b ?<br />sub requires {<br />    my ($a, $b) = @_;<br />    return $Requires->{$a}->{$b};<br />}<br /><br /># isRequiredBy(a,b) -> is a required by b ? (b requires a)<br />sub requires {<br />    my ($a, $b) = @_;<br />    return $RequiredBy->{$a}->{$b};<br />}<br /><br />sub getAllDependenciesRecursively {<br />    my (@list) = @_;<br /><br />    my $newlist = {};<br /><br />    foreach my $i (@list) {<br />        $newlist->{$i} = 1;<br /> foreach my $dep (keys %{$Requires->{$i}}) {<br />     $newlist->{$dep} = 1;<br /> }<br />    }<br /><br />    my @output = keys %$newlist;<br /><br />    if(scalar(@output) > scalar(@list)) {<br />        # something in the list changed, recurse more<br /> return getAllDependenciesRecursively(@output);<br />    } else {<br />        return @output;<br />    }<br />}<br /><br />sub getMinimalSetToInstall {<br />    my (@list) = @_;<br />    my %bla = map { $_ => 1 } @list;<br />    my $old = \%bla;<br />    my $new = {};<br /><br />    foreach my $pkg (@list) {<br />     my @revdeps = keys %{$RequiredBy->{$pkg}};<br />        if(scalar(@revdeps) != 0) {<br />     my $toBeAdded = 1;<br />     # this package is required by some packages<br />     # check if any of those packages is in the list we need to check<br />     foreach my $d (@revdeps) {<br />         if($old->{$d} == 1) {<br />      $toBeAdded = 0;<br />  }<br />     }<br /><br />     if($toBeAdded == 1) {<br />         $new->{$pkg} = 1;<br />     }<br /> } else {<br />     # This package isn't required by anything else, so just keep it in the list<br />     $new->{$pkg} = 1;<br /> }<br />    }<br /><br />    return keys %{$new}<br />}<br /><br />parseGeneratedDOTFile($ARGV[0]);<br /><br />@origlist = keys %{$AllPackages};<br />@smalllist = getMinimalSetToInstall(@origlist);<br />@generatedlist = getAllDependenciesRecursively((@smalllist));<br /><br />if(scalar(@origlist) == scalar(@generatedlist)) {<br />    print "Succesfully expanded minimal list into full list!\n\n";<br />    print "Original list (".scalar(@origlist)." packages):\n";<br />    print join " ", @origlist;<br />    print "\n\n";<br />    print "Condensed list (".scalar(@smalllist)." packages):\n";<br />    print join " ", @smalllist;<br />    print "\n";<br />}<br />[/PRE]<br /><br />This is the result so far (I haven't taken a detailed look at this output yet):<br /><br />[PRE]<br />Succesfully expanded minimal list into full list!<br /><br />Original list (196 packages):<br />glibc pciutils which iproute kudzu file rsyslog libattr libdhcp rpm less crontabs libsysfs nc sysvinit-tools dmraid hesiod checkpolicy system-config-firewall-tui findutils dbus-glib mkinitrd libidn tcpdump pth newt coreutils selinux-policy libpcap libselinux pygpgme grub libselinux-python time krb5-libs audit-libs newt-python pinentry kernel cyrus-sasl-plain gpgme anacron readline audit-libs-python iputils cracklib-dicts upstart hwdata man chkconfig initscripts gnupg2 glib2 procps file-libs gawk fedora-release-notes cyrus-sasl-lib psmisc nash mdadm libdhcp6client grep policycoreutils bash zlib bind-libs yum-metadata-parser setuptool ncurses-base libxml2 dbus dhcpv6-client zip slang hdparm shadow-utils pam tzdata tar kpartx python-urlgrabber db4 rpm-libs libvolume_id groff dhclient ncurses rpm-python bind-utils parted fedora-logos bc openssh-clients python-libs wireless-tools libcap pkgconfig make logrotate libsepol pcre dbus-python yum acpid bzip2 filesystem util-linux-ng dirmngr libsemanage tree unzip tcp_wrappers-libs cracklib openssl python-iniparse elfutils-libelf device-mapper libacl basesystem net-tools acl ncurses-libs isomd5sum openssh keyutils-libs wget usermode sudo libuser glibc-common udev selinux-policy-targeted symlinks libedit attr sed rhpl nss_db MAKEDEV iptables-ipv6 cyrus-sasl info python traceroute passwd libgcrypt setup system-config-network-tui popt eject ntfs-3g gdbm openssh-server diffutils vim-minimal device-mapper-libs libcurl gamin expat device-mapper-multipath rng-utils libstdc++ dbus-libs gzip procmail sendmail nspr mingetty iptables libnl libksba openldap libgcc linux-atm-libs lvm2 bzip2-libs kbd sqlite e2fsprogs libdhcp4client yum-utils at ethtool libusb ustr nss e2fsprogs-libs gpm authconfig cronie libgpg-error fedora-release module-init-tools ConsoleKit-libs cpio<br /><br />Condensed list (42 packages):<br />tree unzip which eject file ntfs-3g openssh-server device-mapper-multipath rng-utils nc sendmail acl system-config-firewall-tui setuptool tcpdump dhcpv6-client zip hdparm wget sudo kbd grub selinux-policy-targeted time dhclient symlinks attr bind-utils kernel nss_db at yum-utils cyrus-sasl-plain anacron bc openssh-clients gpm traceroute authconfig cronie man acpid<br />[/PRE]<br /><br /><br />StevensBlogSpotFilterThing --><br />I've set up a Fedora 9 and stripped everything I don't need out of it. Now I would like to make a kickstart profile out of it. But instead of telling kickstart to install the (mandatory) basesystem and then removing all the packages I list, I want to tell it to not install ANYTHING, except the packages I tell it to (ie. the basesystem minus some crap).<br /><br />So, I took the list of packages that I had installed, generated a dependency tree of it (using the graph generator from the previous post) and then threw out all packages in the list that were going to be installed anyway because the are dependencies of other packages.<br /><br />This is the script I used:<br /><br /><pre style="background-color: #EEEEEE; border: black 1px dashed; line-height: 100%; padding: 10px;"><br />#!/usr/bin/perl<br /><br />$AllPackages = {};<br />$Requires = {};<br />$RequiredBy = {};<br /><br />sub parseGeneratedDOTFile {<br />    my ($filename) = @_;<br /><br />    open IN, "$filename";<br />    while(my $line = &lt;IN&gt;) {<br />        if($line =~ /^"([^"]+)" -> "([^"]+)";$/) {<br />     $AllPackages->{$1} = 1;<br />     $AllPackages->{$2} = 1;<br />     $Requires->{$1}->{$2} = 1;<br />     $RequiredBy->{$2}->{$1} = 1;<br /> }<br />    }<br />    close IN;<br />}<br /><br /># requires(a,b) -> does a require b ?<br />sub requires {<br />    my ($a, $b) = @_;<br />    return $Requires->{$a}->{$b};<br />}<br /><br /># isRequiredBy(a,b) -> is a required by b ? (b requires a)<br />sub requires {<br />    my ($a, $b) = @_;<br />    return $RequiredBy->{$a}->{$b};<br />}<br /><br />sub getAllDependenciesRecursively {<br />    my (@list) = @_;<br /><br />    my $newlist = {};<br /><br />    foreach my $i (@list) {<br />        $newlist->{$i} = 1;<br /> foreach my $dep (keys %{$Requires->{$i}}) {<br />     $newlist->{$dep} = 1;<br /> }<br />    }<br /><br />    my @output = keys %$newlist;<br /><br />    if(scalar(@output) > scalar(@list)) {<br />        # something in the list changed, recurse more<br /> return getAllDependenciesRecursively(@output);<br />    } else {<br />        return @output;<br />    }<br />}<br /><br />sub getMinimalSetToInstall {<br />    my (@list) = @_;<br />    my %bla = map { $_ => 1 } @list;<br />    my $old = \%bla;<br />    my $new = {};<br /><br />    foreach my $pkg (@list) {<br />     my @revdeps = keys %{$RequiredBy->{$pkg}};<br />        if(scalar(@revdeps) != 0) {<br />     my $toBeAdded = 1;<br />     # this package is required by some packages<br />     # check if any of those packages is in the list we need to check<br />     foreach my $d (@revdeps) {<br />         if($old->{$d} == 1) {<br />      $toBeAdded = 0;<br />  }<br />     }<br /><br />     if($toBeAdded == 1) {<br />         $new->{$pkg} = 1;<br />     }<br /> } else {<br />     # This package isn't required by anything else, so just keep it in the list<br />     $new->{$pkg} = 1;<br /> }<br />    }<br /><br />    return keys %{$new}<br />}<br /><br />parseGeneratedDOTFile($ARGV[0]);<br /><br />@origlist = keys %{$AllPackages};<br />@smalllist = getMinimalSetToInstall(@origlist);<br />@generatedlist = getAllDependenciesRecursively((@smalllist));<br /><br />if(scalar(@origlist) == scalar(@generatedlist)) {<br />    print "Succesfully expanded minimal list into full list!\n\n";<br />    print "Original list (".scalar(@origlist)." packages):\n";<br />    print join " ", @origlist;<br />    print "\n\n";<br />    print "Condensed list (".scalar(@smalllist)." packages):\n";<br />    print join " ", @smalllist;<br />    print "\n";<br />}<br /></pre><br /><br />This is the result so far (I haven't taken a detailed look at this output yet):<br /><br /><pre style="background-color: #EEEEEE; border: black 1px dashed; line-height: 100%; padding: 10px;"><br />Succesfully expanded minimal list into full list!<br /><br />Original list (196 packages):<br />glibc pciutils which iproute kudzu file rsyslog libattr libdhcp rpm less crontabs libsysfs nc sysvinit-tools dmraid hesiod checkpolicy system-config-firewall-tui findutils dbus-glib mkinitrd libidn tcpdump pth newt coreutils selinux-policy libpcap libselinux pygpgme grub libselinux-python time krb5-libs audit-libs newt-python pinentry kernel cyrus-sasl-plain gpgme anacron readline audit-libs-python iputils cracklib-dicts upstart hwdata man chkconfig initscripts gnupg2 glib2 procps file-libs gawk fedora-release-notes cyrus-sasl-lib psmisc nash mdadm libdhcp6client grep policycoreutils bash zlib bind-libs yum-metadata-parser setuptool ncurses-base libxml2 dbus dhcpv6-client zip slang hdparm shadow-utils pam tzdata tar kpartx python-urlgrabber db4 rpm-libs libvolume_id groff dhclient ncurses rpm-python bind-utils parted fedora-logos bc openssh-clients python-libs wireless-tools libcap pkgconfig make logrotate libsepol pcre dbus-python yum acpid bzip2 filesystem util-linux-ng dirmngr libsemanage tree unzip tcp_wrappers-libs cracklib openssl python-iniparse elfutils-libelf device-mapper libacl basesystem net-tools acl ncurses-libs isomd5sum openssh keyutils-libs wget usermode sudo libuser glibc-common udev selinux-policy-targeted symlinks libedit attr sed rhpl nss_db MAKEDEV iptables-ipv6 cyrus-sasl info python traceroute passwd libgcrypt setup system-config-network-tui popt eject ntfs-3g gdbm openssh-server diffutils vim-minimal device-mapper-libs libcurl gamin expat device-mapper-multipath rng-utils libstdc++ dbus-libs gzip procmail sendmail nspr mingetty iptables libnl libksba openldap libgcc linux-atm-libs lvm2 bzip2-libs kbd sqlite e2fsprogs libdhcp4client yum-utils at ethtool libusb ustr nss e2fsprogs-libs gpm authconfig cronie libgpg-error fedora-release module-init-tools ConsoleKit-libs cpio<br /><br />Condensed list (42 packages):<br />tree unzip which eject file ntfs-3g openssh-server device-mapper-multipath rng-utils nc sendmail acl system-config-firewall-tui setuptool tcpdump dhcpv6-client zip hdparm wget sudo kbd grub selinux-policy-targeted time dhclient symlinks attr bind-utils kernel nss_db at yum-utils cyrus-sasl-plain anacron bc openssh-clients gpm traceroute authconfig cronie man acpid<br /></pre>
  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2008/07/17/making-dot-graphviz-graph-of-rpm/">
        making a .dot (graphviz) graph of RPM dependencies
      </a>
    </h1>

    <span class="post-date">17 Jul 2008</span>

    <!-- StevensBlogSpotFilterThing<br />I'm currently looking into Fedora/kickstart again and also cobbler.<br /><br />For reasons I won't go into right now I wanted to visualize the relationships between installed RPM packages. I've found a couple of tools that claim they can do this, including <a href="http://freshmeat.net/projects/rpmgraph/">rpmgraph</a>, <a href="http://rpmorphan.sourceforge.net/">rpmorphan</a> and <a href="http://lists.centos.org/pipermail/centos/2005-May/047091.html">references to some here</a>.<br /><br />But it seemed that I had to install some stuff to use it (if it worked at all). So instead of looking further, I hacked something together quickly that fits my needs. It's a bash script and it has almost no dependencies (uses only tools that can be found on any RPM-based system)<br /><br />[PRE]<br />#!/bin/bash<br /><br /># deps:<br />#    bash<br />#    rpm<br />#    sed<br />#    cut<br />#    uniq<br />#    sort<br /><br />installedrpms=$(rpm -qa --queryformat "%{NAME}\n")<br /><br /><br />function printdeps() {<br />    local package deps dep providedby out<br /><br />    package=$1<br />    out=""<br />    deps=$(rpm -qR $package | cut -d " " -f 1)<br /><br />    for dep in $deps;<br />    do<br />        providedby=$(rpm -q --queryformat "%{NAME}\n" --whatprovides "$dep")<br />        if [ $? -eq 0 ];<br />        then<br />            # packages should not depend on themselves<br />            if [ "$package" != "$providedby" ];<br />            then<br />                out="$out\"$package\" -> \"$providedby\";\n"<br />            fi<br />        fi<br />    done<br /><br />    echo $out<br />}<br /><br />alloutput=""<br /><br />for i in $installedrpms;<br />do<br />    output=$(printdeps $i)<br />    alloutput="$alloutput$output"<br />done<br /><br /><br />echo "digraph deptree {"<br />echo -e "$alloutput" | sort | uniq<br />echo "}"<br />[/PRE]<br /><br /><br /><br /><br />StevensBlogSpotFilterThing --><br />I'm currently looking into Fedora/kickstart again and also cobbler.<br /><br />For reasons I won't go into right now I wanted to visualize the relationships between installed RPM packages. I've found a couple of tools that claim they can do this, including <a href="http://freshmeat.net/projects/rpmgraph/">rpmgraph</a>, <a href="http://rpmorphan.sourceforge.net/">rpmorphan</a> and <a href="http://lists.centos.org/pipermail/centos/2005-May/047091.html">references to some here</a>.<br /><br />But it seemed that I had to install some stuff to use it (if it worked at all). So instead of looking further, I hacked something together quickly that fits my needs. It's a bash script and it has almost no dependencies (uses only tools that can be found on any RPM-based system)<br /><br /><pre style="background-color: #EEEEEE; border: black 1px dashed; line-height: 100%; padding: 10px;"><br />#!/bin/bash<br /><br /># deps:<br />#    bash<br />#    rpm<br />#    sed<br />#    cut<br />#    uniq<br />#    sort<br /><br />installedrpms=$(rpm -qa --queryformat "%{NAME}\n")<br /><br /><br />function printdeps() {<br />    local package deps dep providedby out<br /><br />    package=$1<br />    out=""<br />    deps=$(rpm -qR $package | cut -d " " -f 1)<br /><br />    for dep in $deps;<br />    do<br />        providedby=$(rpm -q --queryformat "%{NAME}\n" --whatprovides "$dep")<br />        if [ $? -eq 0 ];<br />        then<br />            # packages should not depend on themselves<br />            if [ "$package" != "$providedby" ];<br />            then<br />                out="$out\"$package\" -> \"$providedby\";\n"<br />            fi<br />        fi<br />    done<br /><br />    echo $out<br />}<br /><br />alloutput=""<br /><br />for i in $installedrpms;<br />do<br />    output=$(printdeps $i)<br />    alloutput="$alloutput$output"<br />done<br /><br /><br />echo "digraph deptree {"<br />echo -e "$alloutput" | sort | uniq<br />echo "}"<br /></pre>
  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2008/07/10/back-from-spain-tips-to-solve-annoying/">
        Back from spain: tips to solve annoying camping problems
      </a>
    </h1>

    <span class="post-date">10 Jul 2008</span>

    <!-- StevensBlogSpotFilterThing<br />I'm back from a 2 week vacation to Spain. It was awesome: the sun was shining, birds were singing, the sea was gulfing...<br /><br />To add to the amount of subjective top-X lists on the internet, here is my top-3 list of things I hate about campings, and a suggestion of what to do about it.<br /><br /><h3>3. Noisy people</h3><br /><br />When on vacation, noisy people are usually no real problem since I never have to get up early anyway. The one exception however is when I need to catch a plane at 8 in the morning, requiring me to be at the airport at 6 am. And since the airport is 150km away, I needed to get up at 3am.<br /><br />So when people are noisy from 10PM till 3AM, partying away, yelling laughing and screaming, it gets under my skin.<br /><br /><b>Lame solution to this problem</b><br />The correct procedure to this problem is to ask them to be quiet. If they don't cooperate, find the people responsible for the camping and call (or have them call) the police.<br /><br /><b>Kickass solution to this problem</b><br />Track down where these people sleep. Since you're awake anyway, you'll have something to do. Once you now where they sleep, wait an hour. During that hour, find a bucket and fill it with water and all kinds of crap. Walk up the the tent, open it up and dump the bucket over/in their sleeping bag.<br /><br /><h3>2. Smokers</h3><br />Campings are great. Waking up with first light, going to sleep when the sun goes down. The social contact, the friendly faces, the fresh air...<br />And then people start lighting up cigarettes one after the other, stinking up the place with their cancer-inducing sticks of death. I wouldn't really mind it if they were nowhere near me or my tent, but for some reason I seem to be attracting their smoke where-ever I sit. To add to the disgrace, most smokers put out their cigarettes all over the place, leaving behind a trail of cigarette butts for every 3-year old kid to burn their bare feet on (It's a camping, people walk around semi-naked!)<br /><br /><b>Lame solution to this problem</b><br />Ask nicely if they would be so kind to put out their cigarettes and smell the nice air that comes with nature at no extra cost. Tell them about how smoking increasing the chances of catching lungcancer even when its inhaled through passive smoking by innocent bystanders.<br />Maybe they would be willing to smoke while going for a walk, so they don't disturb people.<br /><br />Of course you could cave and go for a walk yourself when they light up...<br /><br /><b>Kickass solution to this problem</b><br />Who are we kidding ? Most smokers (if not all) are terrible jackasses who can't part from their filthy habits for more than a few minutes. Smoking is cool and social, so everybody should enjoy it. If you don't like the smell and decreased oxygenlevels, then you're an antisocial fascist controlfreak who is part of the problem, not the solution.<br /><br />So what to do ? Well, you could open up a bottle op propane gas and put it under the table. First one who lights up, wins ! But then passive smoking is probably safer.<br />Since they are counting on you to step away from the smoke to leave them alone in their stench, you should. But noone says you have to leave it at that. Get some old raw meat or fish and grind it up real nice. Then dump it all on the floor and walk away. The place will be infested with all kinds of vermin, especially flies. The stench will be horrible, but maybe the smoke from their cigarettes will mask it, who knows ?<br /><br /><h3>1. Flies</h3><br />There is 1 thing you will never run out of on campings. You might run out of water or sunlight, maybe even oxygen or BBQ coals.<br />But you can always count on horrific amounts of flies to swarm in and sit on every piece of exposed skin on your body. Flies aren't actually as bad a smokers or noisemakers, except that there are so many of them around and they always get in the wrong place at the wrong time (for you).<br /><br /><b>Lame solution to this problem</b><br />Find out what attracts the flies in the first place and remove it. If that fails, get some of that sticky fly-catching tape and hang it up. Or get flysquatters.<br /><br /><b>Lame solution to this problem</b><br />Nothing says "I am cool" better than a combination of a aerosol can and a lighter to convince flies and other flying insects to vacate the area. Plus it's fun too!<br />Hold the lighter between you and the insect, then spray over the lighter towards the insect.<br />You can also use this technique to put fire to almost anything, including the tent of noisemakers, or the cigarette-stash of snmokers. Use at your own risk<br /><br /><br />StevensBlogSpotFilterThing --><br />I'm back from a 2 week vacation to Spain. It was awesome: the sun was shining, birds were singing, the sea was gulfing...<br /><br />To add to the amount of subjective top-X lists on the internet, here is my top-3 list of things I hate about campings, and a suggestion of what to do about it.<br /><br /><h3>3. Noisy people</h3><br /><br />When on vacation, noisy people are usually no real problem since I never have to get up early anyway. The one exception however is when I need to catch a plane at 8 in the morning, requiring me to be at the airport at 6 am. And since the airport is 150km away, I needed to get up at 3am.<br /><br />So when people are noisy from 10PM till 3AM, partying away, yelling laughing and screaming, it gets under my skin.<br /><br /><b>Lame solution to this problem</b><br />The correct procedure to this problem is to ask them to be quiet. If they don't cooperate, find the people responsible for the camping and call (or have them call) the police.<br /><br /><b>Kickass solution to this problem</b><br />Track down where these people sleep. Since you're awake anyway, you'll have something to do. Once you now where they sleep, wait an hour. During that hour, find a bucket and fill it with water and all kinds of crap. Walk up the the tent, open it up and dump the bucket over/in their sleeping bag.<br /><br /><h3>2. Smokers</h3><br />Campings are great. Waking up with first light, going to sleep when the sun goes down. The social contact, the friendly faces, the fresh air...<br />And then people start lighting up cigarettes one after the other, stinking up the place with their cancer-inducing sticks of death. I wouldn't really mind it if they were nowhere near me or my tent, but for some reason I seem to be attracting their smoke where-ever I sit. To add to the disgrace, most smokers put out their cigarettes all over the place, leaving behind a trail of cigarette butts for every 3-year old kid to burn their bare feet on (It's a camping, people walk around semi-naked!)<br /><br /><b>Lame solution to this problem</b><br />Ask nicely if they would be so kind to put out their cigarettes and smell the nice air that comes with nature at no extra cost. Tell them about how smoking increasing the chances of catching lungcancer even when its inhaled through passive smoking by innocent bystanders.<br />Maybe they would be willing to smoke while going for a walk, so they don't disturb people.<br /><br />Of course you could cave and go for a walk yourself when they light up...<br /><br /><b>Kickass solution to this problem</b><br />Who are we kidding ? Most smokers (if not all) are terrible jackasses who can't part from their filthy habits for more than a few minutes. Smoking is cool and social, so everybody should enjoy it. If you don't like the smell and decreased oxygenlevels, then you're an antisocial fascist controlfreak who is part of the problem, not the solution.<br /><br />So what to do ? Well, you could open up a bottle op propane gas and put it under the table. First one who lights up, wins ! But then passive smoking is probably safer.<br />Since they are counting on you to step away from the smoke to leave them alone in their stench, you should. But noone says you have to leave it at that. Get some old raw meat or fish and grind it up real nice. Then dump it all on the floor and walk away. The place will be infested with all kinds of vermin, especially flies. The stench will be horrible, but maybe the smoke from their cigarettes will mask it, who knows ?<br /><br /><h3>1. Flies</h3><br />There is 1 thing you will never run out of on campings. You might run out of water or sunlight, maybe even oxygen or BBQ coals.<br />But you can always count on horrific amounts of flies to swarm in and sit on every piece of exposed skin on your body. Flies aren't actually as bad a smokers or noisemakers, except that there are so many of them around and they always get in the wrong place at the wrong time (for you).<br /><br /><b>Lame solution to this problem</b><br />Find out what attracts the flies in the first place and remove it. If that fails, get some of that sticky fly-catching tape and hang it up. Or get flysquatters.<br /><br /><b>Lame solution to this problem</b><br />Nothing says "I am cool" better than a combination of a aerosol can and a lighter to convince flies and other flying insects to vacate the area. Plus it's fun too!<br />Hold the lighter between you and the insect, then spray over the lighter towards the insect.<br />You can also use this technique to put fire to almost anything, including the tent of noisemakers, or the cigarette-stash of snmokers. Use at your own risk
  </div>
  
</div>

<div class="pagination">
  
    <a class="pagination-item older" href="/page17">Older</a>
  
  
    
      <a class="pagination-item newer" href="/page15">Newer</a>
    
  
</div>

    </div>

  </body>
</html>
