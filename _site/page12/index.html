<!DOCTYPE html>
<html lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      Singularity.be &middot; Flawed logic inspecting flawed logic
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/hyde.css">
  <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface">

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-144-precomposed.png">
                                 <link rel="shortcut icon" href="/public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>


  <body>

    <div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <h1>
        <a href="/">
          Singularity.be
        </a>
      </h1>
      <p class="lead">Steven Van Acker's blog</p>
    </div>

    <nav class="sidebar-nav">
      <a class="sidebar-nav-item" href="/">Home</a>

      

      
      
        
          
        
      
        
          
            <a class="sidebar-nav-item" href="/about/">About</a>
          
        
      
        
          
        
      
        
      
        
          
        
      
        
          
            <a class="sidebar-nav-item" href="/projects/">Projects</a>
          
        
      
        
          
            <a class="sidebar-nav-item" href="/publications/">Publications</a>
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
    </nav>

    <!-- <p>&copy; 2016. All rights reserved.</p> -->
  </div>
</div>


    <div class="content container">
      <div class="posts">
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2008/09/07/opera-is-getting-on-my-nerves/">
        Opera is getting on my nerves
      </a>
    </h1>

    <span class="post-date">07 Sep 2008</span>

    <!-- StevensBlogSpotFilterThing<br />Opera has been my browser of choice for ages. I originally chose it because it followed the standards pretty closely, has multiple tab support and remembered what was in each tab when it was shut down, it has a lovely wand feature to remember passwords and I love the bookmark system. It also used to have a very simple interface and easy keyboard shortcuts for everything I needed.<br /><br />In recent years, other browsers have begun to copy these features as well. Firefox and even MSIE now have tabs and can remember what they contained without additional plugins. Supportingn standards has improved aswell in other browsers.<br /><br />I still kept Opera because there is an unidentifiable quality about it that I can't find in firefox.<br />Since the last upgrade however, Opera has changed its look and feel tremendously. For some reason, they now use some crappy theme that I'm still now used to and doesn't seem to make things any more practical. They've also changed the handy shortcuts to be closer to Firefox's.<br />And the memory consumption is off the chart.<br /><br />I currently have 4 tabs open: XKCD, the blogspot edit form, a forum dealing with Fedora 9 and Planet Debian.<br />[PRE]<br />  PID USER      PR  NI  VIRT  RES  SHR S %CPU %MEM    TIME+  COMMAND<br />26395 deepstar  20   0 1142m 408m  21m S  0.7 20.2  76:45.72 opera<br />[/PRE]<br /><br />That's right! It's eating 1.1GB of virtual memory. Why ? I have no clue.<br /><br />Maybe I should be on the lookout for another browser...<br />StevensBlogSpotFilterThing --><br />Opera has been my browser of choice for ages. I originally chose it because it followed the standards pretty closely, has multiple tab support and remembered what was in each tab when it was shut down, it has a lovely wand feature to remember passwords and I love the bookmark system. It also used to have a very simple interface and easy keyboard shortcuts for everything I needed.<br /><br />In recent years, other browsers have begun to copy these features as well. Firefox and even MSIE now have tabs and can remember what they contained without additional plugins. Supportingn standards has improved aswell in other browsers.<br /><br />I still kept Opera because there is an unidentifiable quality about it that I can't find in firefox.<br />Since the last upgrade however, Opera has changed its look and feel tremendously. For some reason, they now use some crappy theme that I'm still now used to and doesn't seem to make things any more practical. They've also changed the handy shortcuts to be closer to Firefox's.<br />And the memory consumption is off the chart.<br /><br />I currently have 4 tabs open: XKCD, the blogspot edit form, a forum dealing with Fedora 9 and Planet Debian.<br /><pre style="background-color: #EEEEEE; border: black 1px dashed; line-height: 100%; padding: 10px;"><br />  PID USER      PR  NI  VIRT  RES  SHR S %CPU %MEM    TIME+  COMMAND<br />26395 deepstar  20   0 1142m 408m  21m S  0.7 20.2  76:45.72 opera<br /></pre><br /><br />That's right! It's eating 1.1GB of virtual memory. Why ? I have no clue.<br /><br />Maybe I should be on the lookout for another browser...
  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2008/09/05/more-pic-goodness-reading-from-serial/">
        More PIC goodness: reading from serial line
      </a>
    </h1>

    <span class="post-date">05 Sep 2008</span>

    <!-- StevensBlogSpotFilterThing<br />Now that I figured out serial communications, I can start to do more interesting things. One of those things is having the PIC read from the serial line and doing something with the data. I decided I would read in characters '0' through '9', and render them on a 7-segment led display.<br /><br />This is the code:<br />[PRE]<br />#include "p16f627a.inc"<br /><br />#define ARRAY   0x20                    ; allocate a var in free space at location 0x20<br />        __CONFIG _INTOSC_OSC_NOCLKOUT<br /><br />; a macro to easily load data into memory<br />putdata: MACRO idx, val<br />         MOVLW val<br />         MOVWF (ARRAY + idx)<br />         ENDM<br /><br />        ; 7 segment led display: <br />        ;       0<br />        ;     -----  <br />        ;   |       |<br />        ; 5 |       | 1<br />        ;   |   6   |<br />        ;     -----  <br />        ;   |       |<br />        ; 4 |       | 2<br />        ;   |       |<br />        ;     -----  <br />        ;       3<br /><br />        ; store all 10 digits, starting at address ARRAY<br />        putdata 0, 0x3F ;0011 1111<br />        putdata 1, 0x06 ;0000 0110<br />        putdata 2, 0x5B ;0101 1011<br />        putdata 3, 0x4F ;0100 1111<br />        putdata 4, 0x66 ;0110 0110<br />        putdata 5, 0x6D ;0110 1101<br />        putdata 6, 0x7D ;0111 1101<br />        putdata 7, 0x07 ;0000 0111<br />        putdata 8, 0x7F ;0111 1111<br />        putdata 9, 0x6F ;0110 1111<br /><br />        BSF STATUS, 5                   ;<br />        ; according to the datasheet, both the 1st and 2nd bit of TRISB need to be set to 1, which makes them both inputs<br />        BSF TRISB, 1                    ; set bit 1 on TRISB<br />        BSF TRISB, 2                    ; set bit 2 on TRISB<br />        CLRF TRISA                      ; PORTA is all output<br />        BCF STATUS, 5<br /><br />        ; set baudrate to 9600baud. For a 20MHz Fosc, this is value 32 == 0x20<br />        MOVLW 0x20<br />        BSF STATUS, 5<br />        MOVWF SPBRG<br />        BCF STATUS, 5<br /><br />        BSF STATUS, 5<br />        BCF TXSTA, SYNC                 ; clear SYNC<br />        BCF STATUS, 5<br />        BSF RCSTA, SPEN                 ; enable serial port<br />        BSF RCSTA, CREN                 ; set CREN<br /><br />wait:   BTFSS PIR1, RCIF                ; wait untill there is some input<br />        GOTO wait<br /><br />        MOVF RCREG, 0           ; read the data byte<br />        ADDLW 0xD0              ; index = data - 0x30 ('0') (ADDLW 0xD0 = DECLW 0x30)<br />        ADDLW ARRAY             ; pointer = ARRAY + index<br />        MOVWF FSR               ; set the pointer <br />        MOVF  INDF,0            ; w = *pointer<br />        MOVWF PORTA             ; porta = w -> lights up the 7seg leds<br /><br />        GOTO wait<br /><br />        END<br />[/PRE]<br /><br />compile with<br />[PRE]<br />gpasm -p 16f627a test.asm<br />[/PRE]<br /><br />And this is the gpsim startup commands file:<br />[PRE]<br /># load the gpsim modules library. For some reason I can't just load it from /usr/lib<br /># so to get this working, I had to issue a 'ln -s /usr/lib/libgpsim_modules.so.0 /tmp/libgpsim_modules.so'<br />module lib /tmp/libgpsim_modules.so<br /><br /># creating an usart and connecting its TX pin to the PICs RX pin, allowing keyboard input<br />module load usart U1<br />node nc<br />attach nc pin(portb1) U1.TXPIN<br />U1.console = true<br /><br /># creating a 7 segment led display and hooking it up to PORTA<br />module load led_7segments L7<br />node nl0 nl1 nl2 nl3 nl4 nl5 nl6<br />attach nl0 pin(porta0) L7.seg0<br />attach nl1 pin(porta1) L7.seg1<br />attach nl2 pin(porta2) L7.seg2<br />attach nl3 pin(porta3) L7.seg3<br />attach nl4 pin(porta4) L7.seg4<br />attach nl5 pin(porta5) L7.seg5<br />attach nl6 pin(porta6) L7.seg6<br /><br /># tell the builtin scope in gpsim to monitor portb2<br /># (in gpsim: Windows -> Scope)<br />#scope.ch0="portb1"<br />[/PRE]<br /><br />Start gpsim with this command:<br />[PRE]<br />gpsim -c env.conf -s test.cod<br />[/PRE]<br /><br />[FULLIMG:http://data.singularity.be/images/full/2008-09-05-pic16f627a-usart-gpsim/Screenshot-Breadboard.png]<br />StevensBlogSpotFilterThing --><br />Now that I figured out serial communications, I can start to do more interesting things. One of those things is having the PIC read from the serial line and doing something with the data. I decided I would read in characters '0' through '9', and render them on a 7-segment led display.<br /><br />This is the code:<br /><pre style="background-color: #EEEEEE; border: black 1px dashed; line-height: 100%; padding: 10px;"><br />#include "p16f627a.inc"<br /><br />#define ARRAY   0x20                    ; allocate a var in free space at location 0x20<br />        __CONFIG _INTOSC_OSC_NOCLKOUT<br /><br />; a macro to easily load data into memory<br />putdata: MACRO idx, val<br />         MOVLW val<br />         MOVWF (ARRAY + idx)<br />         ENDM<br /><br />        ; 7 segment led display: <br />        ;       0<br />        ;     -----  <br />        ;   |       |<br />        ; 5 |       | 1<br />        ;   |   6   |<br />        ;     -----  <br />        ;   |       |<br />        ; 4 |       | 2<br />        ;   |       |<br />        ;     -----  <br />        ;       3<br /><br />        ; store all 10 digits, starting at address ARRAY<br />        putdata 0, 0x3F ;0011 1111<br />        putdata 1, 0x06 ;0000 0110<br />        putdata 2, 0x5B ;0101 1011<br />        putdata 3, 0x4F ;0100 1111<br />        putdata 4, 0x66 ;0110 0110<br />        putdata 5, 0x6D ;0110 1101<br />        putdata 6, 0x7D ;0111 1101<br />        putdata 7, 0x07 ;0000 0111<br />        putdata 8, 0x7F ;0111 1111<br />        putdata 9, 0x6F ;0110 1111<br /><br />        BSF STATUS, 5                   ;<br />        ; according to the datasheet, both the 1st and 2nd bit of TRISB need to be set to 1, which makes them both inputs<br />        BSF TRISB, 1                    ; set bit 1 on TRISB<br />        BSF TRISB, 2                    ; set bit 2 on TRISB<br />        CLRF TRISA                      ; PORTA is all output<br />        BCF STATUS, 5<br /><br />        ; set baudrate to 9600baud. For a 20MHz Fosc, this is value 32 == 0x20<br />        MOVLW 0x20<br />        BSF STATUS, 5<br />        MOVWF SPBRG<br />        BCF STATUS, 5<br /><br />        BSF STATUS, 5<br />        BCF TXSTA, SYNC                 ; clear SYNC<br />        BCF STATUS, 5<br />        BSF RCSTA, SPEN                 ; enable serial port<br />        BSF RCSTA, CREN                 ; set CREN<br /><br />wait:   BTFSS PIR1, RCIF                ; wait untill there is some input<br />        GOTO wait<br /><br />        MOVF RCREG, 0           ; read the data byte<br />        ADDLW 0xD0              ; index = data - 0x30 ('0') (ADDLW 0xD0 = DECLW 0x30)<br />        ADDLW ARRAY             ; pointer = ARRAY + index<br />        MOVWF FSR               ; set the pointer <br />        MOVF  INDF,0            ; w = *pointer<br />        MOVWF PORTA             ; porta = w -> lights up the 7seg leds<br /><br />        GOTO wait<br /><br />        END<br /></pre><br /><br />compile with<br /><pre style="background-color: #EEEEEE; border: black 1px dashed; line-height: 100%; padding: 10px;"><br />gpasm -p 16f627a test.asm<br /></pre><br /><br />And this is the gpsim startup commands file:<br /><pre style="background-color: #EEEEEE; border: black 1px dashed; line-height: 100%; padding: 10px;"><br /># load the gpsim modules library. For some reason I can't just load it from /usr/lib<br /># so to get this working, I had to issue a 'ln -s /usr/lib/libgpsim_modules.so.0 /tmp/libgpsim_modules.so'<br />module lib /tmp/libgpsim_modules.so<br /><br /># creating an usart and connecting its TX pin to the PICs RX pin, allowing keyboard input<br />module load usart U1<br />node nc<br />attach nc pin(portb1) U1.TXPIN<br />U1.console = true<br /><br /># creating a 7 segment led display and hooking it up to PORTA<br />module load led_7segments L7<br />node nl0 nl1 nl2 nl3 nl4 nl5 nl6<br />attach nl0 pin(porta0) L7.seg0<br />attach nl1 pin(porta1) L7.seg1<br />attach nl2 pin(porta2) L7.seg2<br />attach nl3 pin(porta3) L7.seg3<br />attach nl4 pin(porta4) L7.seg4<br />attach nl5 pin(porta5) L7.seg5<br />attach nl6 pin(porta6) L7.seg6<br /><br /># tell the builtin scope in gpsim to monitor portb2<br /># (in gpsim: Windows -> Scope)<br />#scope.ch0="portb1"<br /></pre><br /><br />Start gpsim with this command:<br /><pre style="background-color: #EEEEEE; border: black 1px dashed; line-height: 100%; padding: 10px;"><br />gpsim -c env.conf -s test.cod<br /></pre><br /><br /><a href="http://data.singularity.be/images/full/2008-09-05-pic16f627a-usart-gpsim/Screenshot-Breadboard.png"><img src="http://data.singularity.be/images/full/2008-09-05-pic16f627a-usart-gpsim/Screenshot-Breadboard.png"></a>
  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2008/09/05/something-useful-with-pic-serial-line/">
        Something useful with a PIC: serial line communication with the outside
      </a>
    </h1>

    <span class="post-date">05 Sep 2008</span>

    <!-- StevensBlogSpotFilterThing<br />It's been a while since I've touched my k8048 PIC programmer board. This week I put it on my desk again and hooked it up. The plan was to play around with the builtin USART of my 16F627A.<br /><br />Because a PIC is difficult (if not impossible) to debug in hardware, I decided to experiment in software first using a simulator. On Ubuntu, the best simulator is gpsim. It can simulate the USART inside the PIC and allows you to hook up a virtual seriele console to it, to see if things work as expected. There is also a 7-segment led display, a scope and all kinds of other plugins you can use.<br /><br />I write all the programs in assembler and use gpasm (from gputils) to assemble it. The reason for this is that I like to be close to the hardware. After all, it's the hardware part I want to understand and experiment with, so no unnecessary layers of cruft in between!<br /><br />The program I wrote is very basic. It sets up the USART for asynchronous serial communication at 9600 baud (8N1) and then starts sending the alphabet over and over again.<br /><br />Output looks like this:<br />[PRE]<br />BCDEFGHIJKLMNOPQRSTUVWXYZABCDEFGHIJKLMNOPQRSTUVWXYZABCDEFGHIJKLMNOPQRSTUVWXYZABCDEFGHIJKLMNOPQRSTUVWXYZABCDEFGHIJKLMNOPQRSTUVWXYZABCDEFGHIJKLMNOPQRSTUVWXYZABCDEFGHIJKLMNOPQRSTUVWXYZABCDEFGHIJKL...<br />[/PRE]<br /><br />(Notice how it didn't start with 'A' ? Thats a bug... keep reading)<br /><br />Here's the code<br />[PRE]<br />#include "p16f627a.inc"<br /><br />#define COUNTER         0x20            ; allocate a var in free space at location 0x20<br />#define STARTCHAR       0x41            ; first character will be 0x41 which is 'A'<br />#define ENDCHAR         0x5A            ; last character will be 'Z'<br /><br />        ; according to the datasheet, both the 1st and 2nd bit of TRISB need to be set to 1, which makes them both inputs<br />        ; this doesn't work. the 2nd bit needs to be set to 0 because it is TX and needs to send bits out.<br />        BSF STATUS, 5                   ;<br />        BSF TRISB, 1                    ; set bit 1 on TRISB<br />        BCF TRISB, 2                    ; clear bit 2 on TRISB<br />        BCF STATUS, 5<br /><br />        ; set baudrate to 9600baud. For a 20MHz Fosc, this is value 32 == 0x20<br />        MOVLW 0x20<br />        BSF STATUS, 5<br />        MOVWF SPBRG<br />        BCF STATUS, 5<br /><br />        BSF STATUS, 5<br />        BCF TXSTA, SYNC                 ; clear SYNC<br />        BCF STATUS, 5<br />        BSF RCSTA, SPEN                 ; enable serial port<br /><br />        BSF STATUS, 5<br />        BSF TXSTA,  TXEN        ; set TXEN<br />        BCF STATUS, 5<br /><br />        ; now the real code begins.<br />        ; a variable COUNTER will contain values from 0 to ENDCHAR-STARTCHAR<br />        ; the register W will hold the actual byte to be sent over the serial line (W = COUNTER + STARTCHAR)<br />        ; if W was ENDCHAR, we reset the COUNTER to 0 and start the whole thing again.<br /><br />reset:  MOVLW 0x0               ; counter = 0<br />        MOVWF COUNTER<br /><br />start:  MOVF   COUNTER, 0       ; w = counter<br />        ADDLW  STARTCHAR        ; w+= startchar<br />        MOVWF  TXREG            ; write w over serial line<br /><br />        ; some hackery to check if W == ENDCHAR: W-ENDCHAR should be 0<br />        SUBLW  ENDCHAR          ; w -= endchar<br />        BTFSC  STATUS, Z        ; if w == 0<br />        GOTO reset              ; reset<br />        INCF COUNTER, 1         ; else, increment counter<br /><br />        ; this tight txloop makes sure that are clear to send the next byte.<br />        ; remember that sending bytes over serial line is slow and it is done in the background<br />        ; if we don't wait untill the first byte is sent, to send the second byte, then the transmission will be garbled<br />        BSF STATUS, 5<br />txloop: BTFSS TXSTA, TRMT<br />        GOTO txloop<br />        BCF STATUS, 5<br /><br />        GOTO start<br />        END<br />[/PRE]<br /><br />And I compiled it like this:<br />[PRE]<br />gpasm -p 16f627a test.asm<br />[/PRE]<br /><br />Which produces a "test.cod" file.<br /><br />I then used the following gpsim "startup command file" (named it env.conf):<br />[PRE]<br /># create a new node 'n'<br />node n<br /><br /># load the gpsim modules library. For some reason I can't just load it from /usr/lib<br /># so to get this working, I had to issue a 'ln -s /usr/lib/libgpsim_modules.so.0 /tmp/libgpsim_modules.so'<br />module lib /tmp/libgpsim_modules.so<br /><br /># create an USART called 'U1'<br />module load usart U1<br /><br /># attach both the TX bit of the PIC 'portb2' (RB2) and the RX pin of the U1 USART<br /># to the node n. This means: connect them together<br />attach n pin(portb2) U1.RXPIN<br /><br /># make the console from the U1 USART do something. In our case, it will display the characters submitted by the PIC<br />U1.console = true<br /><br /># tell the builtin scope in gpsim to monitor portb2 <br /># (in gpsim: Windows -> Scope)<br />scope.ch0="portb2"<br />[/PRE]<br /><br />And launched gpsim with:<br />[PRE]<br />gpsim -c env.conf -s test.cod<br />[/PRE]<br /><br />Screenshot of the scope in gpsim:<br />[FULLIMG:http://data.singularity.be/images/full/2008-09-05-pic16f627a-usart-gpsim/Screenshot-Scope.png]<br />And the usart console:<br />[FULLIMG:http://data.singularity.be/images/full/2008-09-05-pic16f627a-usart-gpsim/Screenshot-USART.png]<br /><br /><br />Careful readers will see that the alphabet sequence does not start with 'A'. I have been looking at the problem very closely and I can't find out why the 'A' is not showing up. All bytes transmitted start with a start-bit and end with a stop-bit, except for the first character transmitted. So you can step through the program and observe how 'A' gets transmitted by using the scope. But nothing arrived in the console. Then 'B' gets sent and everything goes as planned: the startbit, data and stopbits are transmitted and it shows up in the console.<br /><br />I haven't figured out yet why this happens. So dear lazyweb, in case you have any pointers as to why this is (not) happening, please let me know.<br /><br /><br />Some recent links I didn't read through yet completely:<br /><a href="http://zedshaw.com/rants/the_freehackers_union.html">http://zedshaw.com/rants/the_freehackers_union.html</a><br /><br /><a href="http://www.parallax.com/">http://www.parallax.com/</a><br /><br /><br />StevensBlogSpotFilterThing --><br />It's been a while since I've touched my k8048 PIC programmer board. This week I put it on my desk again and hooked it up. The plan was to play around with the builtin USART of my 16F627A.<br /><br />Because a PIC is difficult (if not impossible) to debug in hardware, I decided to experiment in software first using a simulator. On Ubuntu, the best simulator is gpsim. It can simulate the USART inside the PIC and allows you to hook up a virtual seriele console to it, to see if things work as expected. There is also a 7-segment led display, a scope and all kinds of other plugins you can use.<br /><br />I write all the programs in assembler and use gpasm (from gputils) to assemble it. The reason for this is that I like to be close to the hardware. After all, it's the hardware part I want to understand and experiment with, so no unnecessary layers of cruft in between!<br /><br />The program I wrote is very basic. It sets up the USART for asynchronous serial communication at 9600 baud (8N1) and then starts sending the alphabet over and over again.<br /><br />Output looks like this:<br /><pre style="background-color: #EEEEEE; border: black 1px dashed; line-height: 100%; padding: 10px;"><br />BCDEFGHIJKLMNOPQRSTUVWXYZABCDEFGHIJKLMNOPQRSTUVWXYZABCDEFGHIJKLMNOPQRSTUVWXYZABCDEFGHIJKLMNOPQRSTUVWXYZABCDEFGHIJKLMNOPQRSTUVWXYZABCDEFGHIJKLMNOPQRSTUVWXYZABCDEFGHIJKLMNOPQRSTUVWXYZABCDEFGHIJKL...<br /></pre><br /><br />(Notice how it didn't start with 'A' ? Thats a bug... keep reading)<br /><br />Here's the code<br /><pre style="background-color: #EEEEEE; border: black 1px dashed; line-height: 100%; padding: 10px;"><br />#include "p16f627a.inc"<br /><br />#define COUNTER         0x20            ; allocate a var in free space at location 0x20<br />#define STARTCHAR       0x41            ; first character will be 0x41 which is 'A'<br />#define ENDCHAR         0x5A            ; last character will be 'Z'<br /><br />        ; according to the datasheet, both the 1st and 2nd bit of TRISB need to be set to 1, which makes them both inputs<br />        ; this doesn't work. the 2nd bit needs to be set to 0 because it is TX and needs to send bits out.<br />        BSF STATUS, 5                   ;<br />        BSF TRISB, 1                    ; set bit 1 on TRISB<br />        BCF TRISB, 2                    ; clear bit 2 on TRISB<br />        BCF STATUS, 5<br /><br />        ; set baudrate to 9600baud. For a 20MHz Fosc, this is value 32 == 0x20<br />        MOVLW 0x20<br />        BSF STATUS, 5<br />        MOVWF SPBRG<br />        BCF STATUS, 5<br /><br />        BSF STATUS, 5<br />        BCF TXSTA, SYNC                 ; clear SYNC<br />        BCF STATUS, 5<br />        BSF RCSTA, SPEN                 ; enable serial port<br /><br />        BSF STATUS, 5<br />        BSF TXSTA,  TXEN        ; set TXEN<br />        BCF STATUS, 5<br /><br />        ; now the real code begins.<br />        ; a variable COUNTER will contain values from 0 to ENDCHAR-STARTCHAR<br />        ; the register W will hold the actual byte to be sent over the serial line (W = COUNTER + STARTCHAR)<br />        ; if W was ENDCHAR, we reset the COUNTER to 0 and start the whole thing again.<br /><br />reset:  MOVLW 0x0               ; counter = 0<br />        MOVWF COUNTER<br /><br />start:  MOVF   COUNTER, 0       ; w = counter<br />        ADDLW  STARTCHAR        ; w+= startchar<br />        MOVWF  TXREG            ; write w over serial line<br /><br />        ; some hackery to check if W == ENDCHAR: W-ENDCHAR should be 0<br />        SUBLW  ENDCHAR          ; w -= endchar<br />        BTFSC  STATUS, Z        ; if w == 0<br />        GOTO reset              ; reset<br />        INCF COUNTER, 1         ; else, increment counter<br /><br />        ; this tight txloop makes sure that are clear to send the next byte.<br />        ; remember that sending bytes over serial line is slow and it is done in the background<br />        ; if we don't wait untill the first byte is sent, to send the second byte, then the transmission will be garbled<br />        BSF STATUS, 5<br />txloop: BTFSS TXSTA, TRMT<br />        GOTO txloop<br />        BCF STATUS, 5<br /><br />        GOTO start<br />        END<br /></pre><br /><br />And I compiled it like this:<br /><pre style="background-color: #EEEEEE; border: black 1px dashed; line-height: 100%; padding: 10px;"><br />gpasm -p 16f627a test.asm<br /></pre><br /><br />Which produces a "test.cod" file.<br /><br />I then used the following gpsim "startup command file" (named it env.conf):<br /><pre style="background-color: #EEEEEE; border: black 1px dashed; line-height: 100%; padding: 10px;"><br /># create a new node 'n'<br />node n<br /><br /># load the gpsim modules library. For some reason I can't just load it from /usr/lib<br /># so to get this working, I had to issue a 'ln -s /usr/lib/libgpsim_modules.so.0 /tmp/libgpsim_modules.so'<br />module lib /tmp/libgpsim_modules.so<br /><br /># create an USART called 'U1'<br />module load usart U1<br /><br /># attach both the TX bit of the PIC 'portb2' (RB2) and the RX pin of the U1 USART<br /># to the node n. This means: connect them together<br />attach n pin(portb2) U1.RXPIN<br /><br /># make the console from the U1 USART do something. In our case, it will display the characters submitted by the PIC<br />U1.console = true<br /><br /># tell the builtin scope in gpsim to monitor portb2 <br /># (in gpsim: Windows -> Scope)<br />scope.ch0="portb2"<br /></pre><br /><br />And launched gpsim with:<br /><pre style="background-color: #EEEEEE; border: black 1px dashed; line-height: 100%; padding: 10px;"><br />gpsim -c env.conf -s test.cod<br /></pre><br /><br />Screenshot of the scope in gpsim:<br /><a href="http://data.singularity.be/images/full/2008-09-05-pic16f627a-usart-gpsim/Screenshot-Scope.png"><img src="http://data.singularity.be/images/full/2008-09-05-pic16f627a-usart-gpsim/Screenshot-Scope.png"></a><br />And the usart console:<br /><a href="http://data.singularity.be/images/full/2008-09-05-pic16f627a-usart-gpsim/Screenshot-USART.png"><img src="http://data.singularity.be/images/full/2008-09-05-pic16f627a-usart-gpsim/Screenshot-USART.png"></a><br /><br /><br />Careful readers will see that the alphabet sequence does not start with 'A'. I have been looking at the problem very closely and I can't find out why the 'A' is not showing up. All bytes transmitted start with a start-bit and end with a stop-bit, except for the first character transmitted. So you can step through the program and observe how 'A' gets transmitted by using the scope. But nothing arrived in the console. Then 'B' gets sent and everything goes as planned: the startbit, data and stopbits are transmitted and it shows up in the console.<br /><br />I haven't figured out yet why this happens. So dear lazyweb, in case you have any pointers as to why this is (not) happening, please let me know.<br /><br /><br />Some recent links I didn't read through yet completely:<br /><a href="http://zedshaw.com/rants/the_freehackers_union.html">http://zedshaw.com/rants/the_freehackers_union.html</a><br /><br /><a href="http://www.parallax.com/">http://www.parallax.com/</a>
  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2008/09/03/embedded-xp-faster-than-linux/">
        Embedded XP faster than linux ?
      </a>
    </h1>

    <span class="post-date">03 Sep 2008</span>

    <!-- StevensBlogSpotFilterThing<br />Straight from <a href="http://planet.debian.org">Planet Debian</a>:<br />[PRE]<br />no matter how optimized the software base and compiler options, no matter which build environment was used (Thin Station, Open Embedded, Gentoo, etc.), we couldn't get a performance that was remotely usable:<br /> * Boot time goes well over a minute, which is way too slow.<br /> * The graphic environment is sluggish, to say the least.<br /><br />...<br /><br />Then came the proposal from our team's lone Windows guy: XP Embedded. Booted in less than 10 seconds, has a graphical environment that is usable out of the box and integrating the customer's application was a breeze.<br />[/PRE]<br />(<a href="http://q-funk.blogspot.com/2008/09/another-tux-bites-dust.html">http://q-funk.blogspot.com/2008/09/another-tux-bites-dust.html</a>)<br /><br />This is very interesting. I always assumed that Windows software was clunky, but it appears to be very well optimized (in the embedded world)<br />Something new for the embedded linux people to shoot for: beating Windows XP Embedded<br /><br />StevensBlogSpotFilterThing --><br />Straight from <a href="http://planet.debian.org">Planet Debian</a>:<br /><pre style="background-color: #EEEEEE; border: black 1px dashed; line-height: 100%; padding: 10px;"><br />no matter how optimized the software base and compiler options, no matter which build environment was used (Thin Station, Open Embedded, Gentoo, etc.), we couldn't get a performance that was remotely usable:<br /> * Boot time goes well over a minute, which is way too slow.<br /> * The graphic environment is sluggish, to say the least.<br /><br />...<br /><br />Then came the proposal from our team's lone Windows guy: XP Embedded. Booted in less than 10 seconds, has a graphical environment that is usable out of the box and integrating the customer's application was a breeze.<br /></pre><br />(<a href="http://q-funk.blogspot.com/2008/09/another-tux-bites-dust.html">http://q-funk.blogspot.com/2008/09/another-tux-bites-dust.html</a>)<br /><br />This is very interesting. I always assumed that Windows software was clunky, but it appears to be very well optimized (in the embedded world)<br />Something new for the embedded linux people to shoot for: beating Windows XP Embedded
  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2008/08/29/god-has-plan/">
        God has a plan
      </a>
    </h1>

    <span class="post-date">29 Aug 2008</span>

    <!-- StevensBlogSpotFilterThing<br />The last time I prayed and believed it, was when I was 11. I sat down with my brother and we prayed all night long, hoping it would save one of my other brothers' life. It didn't. He died a couple of days later.<br /><br />I stopped believing in God right there and then and I've been very sceptic about it ever since. It is much more effective to be kind and be a light in the tunnel for those who need it, instead of believing that some superhuman creature will take care of you if you speak to it often enough.<br /><br />This week I had some time to fix the server and network of the American College in Leuven. I have been maintaining only the mail- and webserver for some years now and it was time for an upgrade and a make-over. After upgrading the server and setting a new secure password policy, I had a look at the wireless accesspoints and found out that it wasn't secure at all: for years, neighbours had been taking advantage of the open accesspoints to download all kinds of crap.<br />Well, I took care of that. All of those APs are now secure as well.<br /><br />The reason why I like helping out the ACL, is because the people there are so kind. All of the people there are religious, and some of them might actually be priests, I don't know. The reason I don't know is because they act like regular people. Unlike the priests (and religion teachers!) I had met previously, they were not constantly preaching about Jesus, God and all the magic anecdotes from the bible.<br /><br />Anyway, they are building some kind of podium in their chapel and I was interested in that. During one of my conversations, father Mahar mentionend that they had had a mass in the chapel that day for me, to thank God for bringing me into their lives.<br /><br />And I was overwhelmed by that. That's one of the nicest things anyone has ever done for me.<br />Maybe it was God's plan to guide me towards ACL, but I doubt he has to kill off my little brother to do that.<br /><br />So now I was wondering. If God has a plan, and we are all part of it, then why is it necessary to pray to God ? Why is it necessary to believe in him ? In fact, if God is so powerful, wouldn't he be able to bake this God-belief into people from birth, and make sure noone ever questions it ?<br />And if people start questioning it, maybe THAT is God's plan ? It could be argued that whatever you do in life, is actually a part of God's plan.<br /><br />I still don't believe in God, but I'm now more convinced that being nice pays off in the long run.<br /><br />StevensBlogSpotFilterThing --><br />The last time I prayed and believed it, was when I was 11. I sat down with my brother and we prayed all night long, hoping it would save one of my other brothers' life. It didn't. He died a couple of days later.<br /><br />I stopped believing in God right there and then and I've been very sceptic about it ever since. It is much more effective to be kind and be a light in the tunnel for those who need it, instead of believing that some superhuman creature will take care of you if you speak to it often enough.<br /><br />This week I had some time to fix the server and network of the American College in Leuven. I have been maintaining only the mail- and webserver for some years now and it was time for an upgrade and a make-over. After upgrading the server and setting a new secure password policy, I had a look at the wireless accesspoints and found out that it wasn't secure at all: for years, neighbours had been taking advantage of the open accesspoints to download all kinds of crap.<br />Well, I took care of that. All of those APs are now secure as well.<br /><br />The reason why I like helping out the ACL, is because the people there are so kind. All of the people there are religious, and some of them might actually be priests, I don't know. The reason I don't know is because they act like regular people. Unlike the priests (and religion teachers!) I had met previously, they were not constantly preaching about Jesus, God and all the magic anecdotes from the bible.<br /><br />Anyway, they are building some kind of podium in their chapel and I was interested in that. During one of my conversations, father Mahar mentionend that they had had a mass in the chapel that day for me, to thank God for bringing me into their lives.<br /><br />And I was overwhelmed by that. That's one of the nicest things anyone has ever done for me.<br />Maybe it was God's plan to guide me towards ACL, but I doubt he has to kill off my little brother to do that.<br /><br />So now I was wondering. If God has a plan, and we are all part of it, then why is it necessary to pray to God ? Why is it necessary to believe in him ? In fact, if God is so powerful, wouldn't he be able to bake this God-belief into people from birth, and make sure noone ever questions it ?<br />And if people start questioning it, maybe THAT is God's plan ? It could be argued that whatever you do in life, is actually a part of God's plan.<br /><br />I still don't believe in God, but I'm now more convinced that being nice pays off in the long run.
  </div>
  
</div>

<div class="pagination">
  
    <a class="pagination-item older" href="/page13">Older</a>
  
  
    
      <a class="pagination-item newer" href="/page11">Newer</a>
    
  
</div>

    </div>

  </body>
</html>
