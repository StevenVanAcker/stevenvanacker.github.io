<!DOCTYPE html>
<html lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      Singularity.be &middot; Flawed logic inspecting flawed logic
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/hyde.css">
  <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface">

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-144-precomposed.png">
                                 <link rel="shortcut icon" href="/public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>


  <body>

    <div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <h1>
        <a href="/">
          Singularity.be
        </a>
      </h1>
      <p class="lead">Steven Van Acker's blog</p>
    </div>

    <nav class="sidebar-nav">
      <a class="sidebar-nav-item" href="/">Home</a>

      

      
      
        
          
        
      
        
          
            <a class="sidebar-nav-item" href="/about/">About</a>
          
        
      
        
          
        
      
        
      
        
          
        
      
        
          
            <a class="sidebar-nav-item" href="/projects/">Projects</a>
          
        
      
        
          
            <a class="sidebar-nav-item" href="/publications/">Publications</a>
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
    </nav>

    <!-- <p>&copy; 2016. All rights reserved.</p> -->
  </div>
</div>


    <div class="content container">
      <div class="posts">
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2007/03/12/ranges-and-negations/">
        ranges and negations
      </a>
    </h1>

    <span class="post-date">12 Mar 2007</span>

    I've been playing with ugly algorithms the last couple days. I already had an infrastructure to add separate subnets to the tree and query for them. But I had no solution for negations ( ! 10.0.36.0/24) or ranges (1023-65535). That last item already reveals my plan. The tree I'm building is meant for 32-bit IP addresses, but it can be used for 16-bit port-numbers as well. While IP-ranges are not addressed in netfilter as far as I know, port ranges are. That's why I need such a thing.<br /><br />I now have the capability to specify ranges and negations in my tree. Well actually, a range just spawns a lot of other subnets (for 32-bit, the theoretical maximum would be 64 subnets) that are added to the tree. The negations are similar. Combined, they can lead to a lot of extra nodes...<br /><br />But anyway. In order to implement these, I introduced the Subnet and SubnetList structures in ALL of my code. In 1 go. Without testing. You probably know where this is leading... After I had replaced all unsigned long int code (for IP-addresses) with Subnet structures, the code broke. It took me a while to track down the bug, but I squashed it now. Things like this make me appreciate my coding-style, where I code and test incrementally.<br /><br />As a testcase, I negate a subnetlist with 1 subnet in it, and then negate that too. The last result should be the same as the first subnet.<br /><br /><pre><br />(deepstar/tachyon) ~/projects/hppc$ ./a.out 1.2.3.4 24<br />Subnetlist: 1.2.3.4/24 <br />Negated subnetlist: 0.0.0.0/8 1.0.0.0/15 1.2.0.0/23 1.2.2.0/24<br /> 1.2.4.0/22 1.2.8.0/21 1.2.16.0/20 1.2.32.0/19 1.2.64.0/18 <br />1.2.128.0/17 1.3.0.0/16 1.4.0.0/14 1.8.0.0/13 1.16.0.0/12 <br />1.32.0.0/11 1.64.0.0/10 1.128.0.0/9 2.0.0.0/7 4.0.0.0/6 <br />8.0.0.0/5 16.0.0.0/4 32.0.0.0/3 64.0.0.0/2 128.0.0.0/1 <br />Negated negated subnetlist: 1.2.3.0/24 <br />(deepstar/tachyon) ~/projects/hppc$ <br /></pre><br /><br />It works! :)
  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2007/03/10/auto-aangekomen-bloedserieus-en-start/">
        Auto aangekomen! Bloedserieus en Start To Run
      </a>
    </h1>

    <span class="post-date">10 Mar 2007</span>

    't is deze week enorm druk geweest op LUDIT. Zodanig druk zelfs dat ik nie eens tijd had om mijn blog aan te vullen :)<br /><br />Het plan was om woensdag mijn auto te gaan halen. Een telefoontje naar de garagist vertelt mij dat ik die 5250 euro in cash moet betalen (jawel cash). Ik bel dus naar mijn bank omdat ik weet dat Argenta maar een beperkt bedrag in de kluis heeft en daar zeggen ze mij dat ik moet wachten tot vrijdag, hmm...<br />Dus ik bel terug naar de garagist en zeg dat da pas tegen vrijdag lukt en of het met een bankcheque ook niet mag. Jawel! <br /><br />Donderdag namiddag dus samen met noot op de bus richting garage, met 3900 euro aan bankcheque en 1350 euro cash op zak. (In de meest gettho bus waar ik ooit opgezeten heb trouwens!)<br /><br />Ginder hebben ze er de platen opgevezen en heb ik ne halve boom papier meegekregen aan handleidingen en whatnot. En nu staat die auto hier achter! :)<br /><br />Donderdagavond was per toeval ook de laatste dag <a href='http://www.bloedserieus.be'>Bloedserieus</a> waar ik mij samen met lijntje en boskabout had voor ingeschreven. Die inschrijving had blijkbaar niet veel nut aangezien we daar toch nog lang hebben moeten aanschuiven...<br /><br />Nu goed, ik ben toch gewonnen met mijne dikke aders :P Lijntje had al ne voorsprong en moest maar 400ml buitenpompen, ik 470ml. En toch eerst klaar!<br />In tegenstelling tot vorige keer heb ik nu geen keigrote pijnlijke blauwe plek op mijn arm.<br /><br />Gisteren (vrijdag dus) ben ik samen met Deborah gaan lopen vanaf de Total door arenbergpark langs cite, de piste 1 keer rond en dan via de Spuye langs de ring terug tot de Total. Dat allemaal samen op de muziek van <a href='http://een.typepad.com/vlaanderensportland/de_start_to_runpodcast/index.html'>Start To Run met Evy Gruyaert</a>. Dat was best wel tof (ik heb ondertussen die link aan een hoop mensen doorgegeven die dat ook gaan doen). Zelfs noot is een rondje gaan lopen !!! proficiat noot! :)<br /><br />Ik had minder last van mijne knie dan ik dacht, maar toch nog teveel om goed te zijn. Misschien zou ik EINDELIJK is een afspraak moeten maken met ne dokter...<br />bloedserieus auto lopen<br />
  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2007/03/05/postpakket-van-maxell/">
        postpakket van Maxell
      </a>
    </h1>

    <span class="post-date">05 Mar 2007</span>

    "er ligt voor u een pakje klaar op het secretariaat"<br /><br />Dat was dus de mail die ik daarstraks ontvangen heb. Vreemd want ik had niks besteld.<br />Het pakje blijkt van Maxell te zijn en is opgestuurd vanuit de UK.<br /><br />Blijkbaar heb ik bij de premiere van "Mission Impossible III" ooit meegedaan aan een wedstrijd en raar maar waar, ik heb iets gewonnen !<br /><br />5 DVD-R schijfjes met doosjes en alles.<br /><br />Ik herinner mij compleet niet meer wanneer ik mij hiervoor ingeschreven heb, maar het is alleszins al heel lang geleden.<br /><br />Zo ziet ge maar, neem deel aan al wat ge kunt dan wint ge af en toe iets :)<br /><br />http://www.winwithmaxell.com
  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2007/03/04/cadeau-idee/">
        cadeau idee
      </a>
    </h1>

    <span class="post-date">04 Mar 2007</span>

    Ik was naar een of andere feature aant zoeken in vim (om stukken code te kunnen collapsen) en ik kwam uit op de <a href='http://www.cafepress.com/geekcheat.11507711'>Vi Reference Mug</a><br /><br />[Update]<br /><br />Dit is de link die ik zoek: http://www.dgp.toronto.edu/~mjmcguff/learn/vim/folding.txt
  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2007/03/03/querying-subnets/">
        querying subnets
      </a>
    </h1>

    <span class="post-date">03 Mar 2007</span>

    It's been a busy week, too busy to play around with HPPC code.<br />I've been reading and rereading the Feldmann paper that first proposes a FIS tree and trying to make sense of their space/time complexities. I got no further...<br /><br />Anyway, I might not have been able to play with code, but I had a couple of remarks and ideas about it.<br /><br />First, I use a list of numbers stored with each treenode: the rule id's of all rules that match the referenced node.<br />But there's a problem with it. Rules change and so do the numbers...<br />If I insert a rule at the top of a chain, it will be rule 1 and all other rules will shift 1 position. To keep the rules in sync with the tree, I'd have to update all numbers in that tree which would be enormously inefficient.<br /><br />So, instead of using numbers, I know use a list of void pointers. Maybe they will point to the original rule, or to another structure that contains the rule ID.<br /><br />Another idea I had originated from my job. I maintain a firewall with 9000 rules (all listed in a bash script... no my idea)<br />From time to time, a network administrator will ask to add or remove a rule, list all rules that apply to his network, or claim that the firewall blocks certain traffic.<br />Debugging a firewall that size is madness. Especially because the rules are not really structured and lots of filtering is done.<br /><br />I had the idea to create a tool that filters all rules for a certain subnet, from the ruleset. Listing all rules that apply to a certain subnet would not be a problem then. Debugging a network problem could be done in the same way by looking which rules apply to a certain packet traversing the firewall. And adding/removing rules... well I've wanted to restructure the entire firewall anyway. A tool to do structured queries would be a nice thing to have when doing that (verifying that the new firewall does the same filtering as the old)<br /><br />Querying a single IP address is easy when you have a segment tree. Just descend down the matching nodes of the tree and add all matching rule numbers to a list.<br /><br />Querying an entire subnet is less easy. Matching a /17 network for example would be the same as matching 32000 IP's. Of course it would be stupid to do it like this while we can abuse the treestructure.<br /><br />[G2:11061]<br />(The picture shows the dataset under test and the query was for 193.190.0.0/16)<br /><br />There are 2 cases to consider: the subnet we're looking for has an exact match in the tree, or it doesn't.<br /><br />If it has an exact match, then we can just descend the matching nodes of the tree and add the relevant rules untill we reach the subnet-node (just as we would do for an IP). And because everything under the subnet-node is by definition a part of the subnet we are looking for, we can add ALL rules under that subnet node.<br /><br />If there is no exact match (like in the picture, the queried subnet would be located where the red arrow points), we need to look for the subtree under the last matching node, attached to the correct branch. The treenode we find there will be a part of the subnet we are querying for and we can add all it's rule numbers.<br /><br />While implementing this I ran into a bug. In my dataset 127.0.0.0/8 and 10.0.0.0/8 were added to the tree under 0.0.0.0/0. This results in a redundant node 0.0.0.0/1 at which point both 127/8 (01111111) and 10/8 (00001010) can be added in different branches. My code added 127/8 under branch 0 and 10/8 under branch 1: the exact opposite of what it should have been.<br /><br />I tracked the bug down to a piece of the code looking like this:<br /><pre><br />branch_a = ...;<br />branch_a = ...;<br /></pre><br /><br />Just to show how much a typo can screw things up :)<br />
  </div>
  
</div>

<div class="pagination">
  
    <a class="pagination-item older" href="/page63">Older</a>
  
  
    
      <a class="pagination-item newer" href="/page61">Newer</a>
    
  
</div>

    </div>

  </body>
</html>
