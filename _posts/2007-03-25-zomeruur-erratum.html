---
layout: post
title: zomeruur erratum ?
date: '2007-03-25T09:37:00.000+02:00'
author: Steven Van Acker
tags: 
modified_time: '2008-01-21T09:38:09.580+01:00'
blogger_id: tag:blogger.com,1999:blog-5513234137363262204.post-2855182867974975688
blogger_orig_url: http://www.singularity.be/2007/03/zomeruur-erratum.html
---

Nu ik wat minder groggy ben dan deze nacht om 5u(zomertijd!), heb ik nog eens nagedacht over mijn script omdat ik niet zeker ben dat ik de zomertijd op de gepaste manier negeer.<br /><br />De data die ik gebruik heeft uren waarop het zomeruur is toegepast. Bij 24 maart 2007 komt de zon op om 6:38 en om 25 maart 2007 om 7:35. Dat is bijna een uur verschil.<br /><br />Stel nu dat ik samen met iemand elke morgen om 6u opsta en dat de zon opkomt om 7u (allebei reele tijd). Stel ook dat ik kies om zomertijd te negeren en die andere niet.<br /><br />Op zaterdag 24 maart staan we allebei op om 6u en zitten samen 1u in het donker. Op zondag 25 maart sta ik op om 6u reele tijd en de andere om 5u reele tijd (want die heeft zijn klok 1u vooruit gedraaid en verliest een uur slaap).<br /><br />Vanuit zijn perspectief sta ik 1u later op, dus om 7u zomertijd.<br /><br />Hoe kan ik dat nu corrigeren ? De datatabel is opgesteld in zomertijd, dus vanuit het perspectief van die andere. Ik zie er dus uit als een luie slaapkop die 1u te lang slaapt. M.a.w., als ik de zomertijd negeer sta ik 1u later op in zomertijd.<br /><br />Dit stukje code:<br /><pre><br />    if($ignore_summertime and $list->{$i}->{summertime}) {<br />        $realwakeup = $wakeup - 3600;<br />        $realsleep  = $sleep  - 3600;<br /></pre><br /><br />Moet dus worden:<br /><pre><br />    if($ignore_summertime and $list->{$i}->{summertime}) {<br />        $realwakeup = $wakeup + 3600;<br />        $realsleep  = $sleep  + 3600;<br /></pre><br /><br />En geeft dan volgende data:<br /><br /><pre><br />04:00 - 20:00:  extra verbruik met zomeruur = 5 day(s), 22 hour(s), 34 min(s), 0 sec(s)<br />04:15 - 20:15:  extra verbruik met zomeruur = 5 day(s), 6 hour(s), 13 min(s), 0 sec(s)<br />04:30 - 20:30:  extra verbruik met zomeruur = 4 day(s), 12 hour(s), 59 min(s), 0 sec(s)<br />04:45 - 20:45:  extra verbruik met zomeruur = 3 day(s), 9 hour(s), 32 min(s), 0 sec(s)<br />05:00 - 21:00:  extra verbruik met zomeruur = 1 day(s), 20 hour(s), 2 min(s), 0 sec(s)<br />05:15 - 21:15:  uitgespaard verbruik met zomeruur = 0 day(s), 2 hour(s), 43 min(s), 0 sec(s)<br />05:30 - 21:30:  uitgespaard verbruik met zomeruur = 2 day(s), 1 hour(s), 18 min(s), 0 sec(s)<br />05:45 - 21:45:  uitgespaard verbruik met zomeruur = 3 day(s), 13 hour(s), 49 min(s), 0 sec(s)<br />06:00 - 22:00:  uitgespaard verbruik met zomeruur = 4 day(s), 16 hour(s), 27 min(s), 0 sec(s)<br />06:15 - 22:15:  uitgespaard verbruik met zomeruur = 5 day(s), 9 hour(s), 48 min(s), 0 sec(s)<br />06:30 - 22:30:  uitgespaard verbruik met zomeruur = 6 day(s), 2 hour(s), 38 min(s), 0 sec(s)<br />06:45 - 22:45:  uitgespaard verbruik met zomeruur = 6 day(s), 19 hour(s), 4 min(s), 0 sec(s)<br />07:00 - 23:00:  uitgespaard verbruik met zomeruur = 7 day(s), 9 hour(s), 41 min(s), 0 sec(s)<br />07:15 - 23:15:  uitgespaard verbruik met zomeruur = 7 day(s), 22 hour(s), 26 min(s), 0 sec(s)<br />07:30 - 23:30:  uitgespaard verbruik met zomeruur = 8 day(s), 9 hour(s), 13 min(s), 0 sec(s)<br />07:45 - 23:45:  uitgespaard verbruik met zomeruur = 8 day(s), 16 hour(s), 44 min(s), 0 sec(s)<br />08:00 - 00:00:  uitgespaard verbruik met zomeruur = 8 day(s), 21 hour(s), 45 min(s), 0 sec(s)<br />08:15 - 00:15:  uitgespaard verbruik met zomeruur = 9 day(s), 0 hour(s), 27 min(s), 0 sec(s)<br />08:30 - 00:30:  uitgespaard verbruik met zomeruur = 9 day(s), 1 hour(s), 0 min(s), 0 sec(s)<br />08:45 - 00:45:  uitgespaard verbruik met zomeruur = 9 day(s), 1 hour(s), 0 min(s), 0 sec(s)<br />09:00 - 01:00:  uitgespaard verbruik met zomeruur = 9 day(s), 1 hour(s), 0 min(s), 0 sec(s)<br />09:15 - 01:15:  uitgespaard verbruik met zomeruur = 9 day(s), 1 hour(s), 0 min(s), 0 sec(s)<br />09:30 - 01:30:  uitgespaard verbruik met zomeruur = 9 day(s), 1 hour(s), 0 min(s), 0 sec(s)<br />09:45 - 01:45:  uitgespaard verbruik met zomeruur = 9 day(s), 1 hour(s), 0 min(s), 0 sec(s)<br />10:00 - 02:00:  uitgespaard verbruik met zomeruur = 9 day(s), 1 hour(s), 0 min(s), 0 sec(s)<br />10:15 - 02:15:  uitgespaard verbruik met zomeruur = 9 day(s), 1 hour(s), 0 min(s), 0 sec(s)<br />10:30 - 02:30:  uitgespaard verbruik met zomeruur = 9 day(s), 1 hour(s), 0 min(s), 0 sec(s)<br />10:45 - 02:45:  uitgespaard verbruik met zomeruur = 9 day(s), 1 hour(s), 0 min(s), 0 sec(s)<br />11:00 - 03:00:  uitgespaard verbruik met zomeruur = 9 day(s), 1 hour(s), 0 min(s), 0 sec(s)<br />11:15 - 03:15:  uitgespaard verbruik met zomeruur = 9 day(s), 1 hour(s), 0 min(s), 0 sec(s)<br />11:30 - 03:30:  uitgespaard verbruik met zomeruur = 9 day(s), 1 hour(s), 0 min(s), 0 sec(s)<br />11:45 - 03:45:  uitgespaard verbruik met zomeruur = 9 day(s), 1 hour(s), 0 min(s), 0 sec(s)<br />12:00 - 04:00:  uitgespaard verbruik met zomeruur = 9 day(s), 1 hour(s), 0 min(s), 0 sec(s)<br />12:15 - 04:15:  uitgespaard verbruik met zomeruur = 9 day(s), 1 hour(s), 0 min(s), 0 sec(s)<br />12:30 - 04:30:  uitgespaard verbruik met zomeruur = 9 day(s), 1 hour(s), 0 min(s), 0 sec(s)<br />12:45 - 04:45:  uitgespaard verbruik met zomeruur = 9 day(s), 1 hour(s), 0 min(s), 0 sec(s)<br /></pre><br /><br />Nieuwe code:<br /><pre><br />#!/usr/bin/perl<br /><br />use Data::Dumper;<br /><br />$ignore_summertime = $ARGV[0];<br />$opstatijd = $ARGV[1];<br />$slaaptijd = $ARGV[2];<br /><br />sub datestr_to_sec {<br />    my $str = shift;<br />    my $h, $m;<br />    <br />    if($str =~ /^(\d+):(\d+)$/) {<br />            $h = $1 + 0;<br />            $m = $2 + 0;<br />    }<br /><br />    return ($h * 3600) + ($m * 60);<br />}<br /><br />sub sec_to_read {<br />    my $sec = shift;<br />    my $d, $h, $m, $s;<br /><br />    $d = int($sec / 86400); $sec %= 86400;<br />    $h = int($sec / 3600);  $sec %= 3600;<br />    $m = int($sec / 60);    $sec %= 60;<br />    $s = $sec;<br /><br />    return "$d day(s), $h hour(s), $m min(s), $s sec(s)";<br />}<br />    <br />$list = {};<br />$counter = 0;<br />$prev = -1;<br />$currentsummertime = 0;<br /><br />$wakeup = datestr_to_sec($opstatijd);<br />$sleep  = datestr_to_sec($slaaptijd);<br /><br />while($line = <STDIN>) {<br /><br />    chomp $line;<br />    if($line =~ /<tr align="center" valign="bottom"><td>(\d+) (\d+) (\d+)&nbsp;<\/td><td>(\d\d:\d\d)&nbsp;<\/td><td>(\d\d:\d\d)&nbsp;<\/td><td> (\d\d)\.&nbsp;<\/td><td>(\d\d:\d\d)&nbsp;<\/td><td>(\d\d:\d\d)&nbsp;<\/td><\/tr>/) {<br />        my($day, $month, $year, $start, $end, $schem_duration, $schem_start, $schem_end) =<br />                ($1, $2, $3, $4, $5, $6, $7, $8);<br /><br />        $list->{$counter}->{day}                = $day;<br />        $list->{$counter}->{month}              = $day;<br />        $list->{$counter}->{year}               = $day;<br />        $list->{$counter}->{daytime}            = "$year$month$day";<br />        $list->{$counter}->{start_string}       = $start;<br />        $list->{$counter}->{start}              = datestr_to_sec($start);<br />        $list->{$counter}->{end_string}         = $end;<br />        $list->{$counter}->{end}                = datestr_to_sec($end);<br />        $list->{$counter}->{schem_duration}     = $schem_duration * 60;<br />        $list->{$counter}->{schem_start_string} = $schem_start;<br />        $list->{$counter}->{schem_start}        = datestr_to_sec($schem_start);<br />        $list->{$counter}->{schem_end_string}   = $schem_end;<br />        $list->{$counter}->{schem_end}          = datestr_to_sec($schem_end);<br /><br />        if($prev < 0) {<br />                # we start in januari, which is winter time<br />                $currentsummertime = 0;<br />        } elsif($list->{$counter}->{start} - $prev > 50*60) {<br />                # summer time<br />                #print "Switched to summertime on $list->{$counter}->{daytime}\n";<br />                $currentsummertime = 1;<br /><br />        } elsif($prev - $list->{$counter}->{start} > 50*60) {<br />                # winter time<br />                #print "Switched to wintertime on $list->{$counter}->{daytime}\n";<br />                $currentsummertime = 0;<br />        } else {<br /><br />        }<br />        $list->{$counter}->{summertime} = $currentsummertime;<br />        $prev = $list->{$counter}->{start};<br />        $counter++;<br />    }<br />}<br /><br />#print Dumper($list);<br /><br /># night<br />$blacksecs = 0;<br /># dawn<br />$greysecs = 0;<br /><br />$realwakeup = $wakeup;<br />$realsleep  = $sleep;<br /><br />for($i = 0; $i < $counter; $i++) {<br />    #print "$i $list->{$i}->{schem_start} sec $list->{$i}->{start} sec $list->{$i}->{end} sec $list->{$i}->{schem_end} sec drawday\n";<br /><br />    # simulate that summertime doesn't exist<br />    if($ignore_summertime and $list->{$i}->{summertime}) {<br />        $realwakeup = $wakeup + 3600;<br />        $realsleep  = $sleep  + 3600;<br />    } else {<br />        $realwakeup = $wakeup;<br />        $realsleep  = $sleep;<br />    }<br /><br />    # we wake up before dawn<br />    if($realwakeup < $list->{$i}->{schem_start}) {<br />        $blacksecs += ($list->{$i}->{schem_start} - $realwakeup);<br />    }<br /><br />    # we wake up before sunlight<br />    if($realwakeup < $list->{$i}->{start}) {<br />        # are we awake before dawn ?<br />        if($realwakeup < $list->{$i}->{schem_start}) {<br />                $greysecs += $list->{$i}->{schem_duration};<br />        } else {<br />                # we woke up during dawn<br />                $greysecs += $list->{$i}->{start} - $realwakeup;<br />        }<br />    }<br /><br />    # we go to realsleep when it's dark<br />    if($realsleep > $list->{$i}->{schem_end}) {<br />        $blacksecs += ($realsleep - $list->{$i}->{schem_end});<br />    }<br /><br />    # we go to realsleep when the sun sets<br />    if($realsleep > $list->{$i}->{end}) {<br />        if($realsleep > $list->{$i}->{schem_end}) {<br />                $greysecs += $list->{$i}->{schem_duration};<br />        } else {<br />                $greysecs += $realsleep - $list->{$i}->{end};<br />        }<br />    }<br />}<br /><br />print "Seconds in grey: $greysecs ".sec_to_read($greysecs)."\n";<br />print "Seconds in black: $blacksecs ".sec_to_read($blacksecs)."\n";<br /></pre><br /><br />En script om de bovenstaande output te genereren:<br /><pre><br />#!/bin/bash<br /><br />for h in `seq 4 12`; do<br />    for m in 0 15 30 45; do<br />        startt=`printf "%02d:%02d" $h $m`<br />        endt=`printf "%02d:%02d" $(($h+16)) $m`<br /><br />        greywith=`./zomeruur.pl 0 $startt $endt < zon_2007.html | grep grey | awk '{print $4}'`<br />        greywithout=`./zomeruur.pl 1 $startt $endt < zon_2007.html | grep grey | awk '{print $4}'`<br />        blackwith=`./zomeruur.pl 0 $startt $endt < zon_2007.html | grep black | awk '{print $4}'`<br />        blackwithout=`./zomeruur.pl 1 $startt $endt < zon_2007.html | grep black | awk '{print $4}'`<br />        # d = extra verbruik MET zomeruur<br />        d=$((greywith + blackwith - greywithout - blackwithout))<br /><br />        echo -n "$startt - $endt: "<br />        if [ $d -gt 0 ];<br />        then<br />                x=`./sec_to_read.pl $d`<br />                echo " extra verbruik met zomeruur = $x";<br />        else<br />                d=$((-$d))<br />                x=`./sec_to_read.pl $d`<br />                echo " uitgespaard verbruik met zomeruur = $x";<br />        fi<br />    done<br />done<br /></pre><br /><br />sec_to_read.pl script (om seconden naar iets leesbaar om te zetten):<br /><pre><br />#!/usr/bin/perl<br /><br />sub sec_to_read {<br />    my $sec = shift;<br />    my $d, $h, $m, $s;<br /><br />    $d = int($sec / 86400); $sec %= 86400;<br />    $h = int($sec / 3600);  $sec %= 3600;<br />    $m = int($sec / 60);    $sec %= 60;<br />    $s = $sec;<br /><br />    return "$d day(s), $h hour(s), $m min(s), $s sec(s)";<br />}<br />    <br />print sec_to_read($ARGV[0])."\n";<br /></pre>