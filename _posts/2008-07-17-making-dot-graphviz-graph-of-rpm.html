---
layout: post
title: making a .dot (graphviz) graph of RPM dependencies
date: '2008-07-17T13:49:00.004+02:00'
author: Steven Van Acker
tags:
- English
- Fedora
- RPM
modified_time: '2008-07-24T14:47:04.935+02:00'
blogger_id: tag:blogger.com,1999:blog-5513234137363262204.post-2917215182836708997
blogger_orig_url: http://www.singularity.be/2008/07/making-dot-graphviz-graph-of-rpm.html
---

<!-- StevensBlogSpotFilterThing<br />I'm currently looking into Fedora/kickstart again and also cobbler.<br /><br />For reasons I won't go into right now I wanted to visualize the relationships between installed RPM packages. I've found a couple of tools that claim they can do this, including <a href="http://freshmeat.net/projects/rpmgraph/">rpmgraph</a>, <a href="http://rpmorphan.sourceforge.net/">rpmorphan</a> and <a href="http://lists.centos.org/pipermail/centos/2005-May/047091.html">references to some here</a>.<br /><br />But it seemed that I had to install some stuff to use it (if it worked at all). So instead of looking further, I hacked something together quickly that fits my needs. It's a bash script and it has almost no dependencies (uses only tools that can be found on any RPM-based system)<br /><br />[PRE]<br />#!/bin/bash<br /><br /># deps:<br />#    bash<br />#    rpm<br />#    sed<br />#    cut<br />#    uniq<br />#    sort<br /><br />installedrpms=$(rpm -qa --queryformat "%{NAME}\n")<br /><br /><br />function printdeps() {<br />    local package deps dep providedby out<br /><br />    package=$1<br />    out=""<br />    deps=$(rpm -qR $package | cut -d " " -f 1)<br /><br />    for dep in $deps;<br />    do<br />        providedby=$(rpm -q --queryformat "%{NAME}\n" --whatprovides "$dep")<br />        if [ $? -eq 0 ];<br />        then<br />            # packages should not depend on themselves<br />            if [ "$package" != "$providedby" ];<br />            then<br />                out="$out\"$package\" -> \"$providedby\";\n"<br />            fi<br />        fi<br />    done<br /><br />    echo $out<br />}<br /><br />alloutput=""<br /><br />for i in $installedrpms;<br />do<br />    output=$(printdeps $i)<br />    alloutput="$alloutput$output"<br />done<br /><br /><br />echo "digraph deptree {"<br />echo -e "$alloutput" | sort | uniq<br />echo "}"<br />[/PRE]<br /><br /><br /><br /><br />StevensBlogSpotFilterThing --><br />I'm currently looking into Fedora/kickstart again and also cobbler.<br /><br />For reasons I won't go into right now I wanted to visualize the relationships between installed RPM packages. I've found a couple of tools that claim they can do this, including <a href="http://freshmeat.net/projects/rpmgraph/">rpmgraph</a>, <a href="http://rpmorphan.sourceforge.net/">rpmorphan</a> and <a href="http://lists.centos.org/pipermail/centos/2005-May/047091.html">references to some here</a>.<br /><br />But it seemed that I had to install some stuff to use it (if it worked at all). So instead of looking further, I hacked something together quickly that fits my needs. It's a bash script and it has almost no dependencies (uses only tools that can be found on any RPM-based system)<br /><br /><pre style="background-color: #EEEEEE; border: black 1px dashed; line-height: 100%; padding: 10px;"><br />#!/bin/bash<br /><br /># deps:<br />#    bash<br />#    rpm<br />#    sed<br />#    cut<br />#    uniq<br />#    sort<br /><br />installedrpms=$(rpm -qa --queryformat "%{NAME}\n")<br /><br /><br />function printdeps() {<br />    local package deps dep providedby out<br /><br />    package=$1<br />    out=""<br />    deps=$(rpm -qR $package | cut -d " " -f 1)<br /><br />    for dep in $deps;<br />    do<br />        providedby=$(rpm -q --queryformat "%{NAME}\n" --whatprovides "$dep")<br />        if [ $? -eq 0 ];<br />        then<br />            # packages should not depend on themselves<br />            if [ "$package" != "$providedby" ];<br />            then<br />                out="$out\"$package\" -> \"$providedby\";\n"<br />            fi<br />        fi<br />    done<br /><br />    echo $out<br />}<br /><br />alloutput=""<br /><br />for i in $installedrpms;<br />do<br />    output=$(printdeps $i)<br />    alloutput="$alloutput$output"<br />done<br /><br /><br />echo "digraph deptree {"<br />echo -e "$alloutput" | sort | uniq<br />echo "}"<br /></pre>