---
layout: post
title: Back to virtualbox
date: '2008-02-27T15:02:00.005+01:00'
author: Steven Van Acker
tags:
- English
- Ubuntu
modified_time: '2008-02-27T15:29:47.823+01:00'
blogger_id: tag:blogger.com,1999:blog-5513234137363262204.post-486679507821814986
blogger_orig_url: http://www.singularity.be/2008/02/back-to-virtualbox.html
---

I've decided to use VirtualBox again as my primary virtualisation solution on the desktop, mainly because I was unable to install Fedora in a QEMU VM.<br /><br />Last time I played with VirtualBox, it had an annoying bug that has since been fixed. I also managed to screw up my Ubuntu installation by doing things in NetworkManager that I shouldn't have done.<br /><br />So how did I fix it this time ?<br /><br /><b>Step 1: Installing Virtualbox</b><br />More information about this can be found on the <a href="http://www.virtualbox.org/wiki/Downloads">VirtualBox wiki</a><br /><br />Added this line to /etc/apt/sources.list<br /><pre><br />deb http://www.virtualbox.org/debian gutsy non-free<br /></pre><br /><br />Executed <br /><pre><br />wget -q http://www.virtualbox.org/debian/innotek.asc -O- | sudo apt-key add -<br /></pre><br /><br />and finally:<br /><pre><br />apt-get update<br />apt-get install virtualbox<br /></pre><br /><br /><b>Step 2: Fixing networking</b><br />I have no 802.1q trunk on my laptop as I do on many other computers, but I still want to be able to interface my virtual machines with real networks. The answer: tap-devices and bridging<br /><br />My main network interface is eth0, my userid is 1000 (this is the first created user on Ubuntu, so it should work for everyone). To avoid that NetworkManager gets in the way, you need to list eth0 in /etc/network/interfaces. In my case, I have to shut down NetworkManager completely because it started configuring my wireless interface.<br /><br />Anyway, I configured /etc/network/interfaces by replacing is with this:<br /><pre><br />auto tap0<br />iface tap0 inet manual<br />    pre-up tunctl -t tap0 -u 1000<br />    pre-up ifconfig tap0 up<br />    post-down tunctl -d tap0<br /><br />auto br0 <br />iface br0 inet dhcp<br />    bridge_ports eth0 tap0<br />    bridge_fd 9 <br />    bridge_hello 2 <br />    bridge_maxage 12 <br />    bridge_stp off<br /><br />auto eth0<br />iface eth0 inet manual<br /></pre><br /><br /><b>Step 3: Configuring udev to automatically set ownership of /dev/net/tun</b><br />By default, the permissions on /dev/net/tun are wrong (is this a bug ?!)<br />To set them correctly, we can modify the udev configuration.<br />Edit /etc/udev/rules.d/20-names.rules and change the following line:<br /><pre><br />KERNEL=="tun", NAME="net/%k"<br /></pre><br />To<br /><pre><br />KERNEL=="tun", NAME="net/%k", GROUP="vboxusers", MODE="0660"<br /></pre><br /><br />This assumes that your user belongs to the group "vboxusers". If it doesn't, fix it with:<br /><pre><br />adduser &lt;username&gt; group<br /></pre><br /><br />That's it. I can now use tap0 as a Host interface in VirtualBox.<br /><br />I will probably make a singularity package for this because after all, who wants to do all of this manually these days ?