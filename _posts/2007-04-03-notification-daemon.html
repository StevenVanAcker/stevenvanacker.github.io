---
layout: post
title: notification-daemon
date: '2007-04-03T09:38:00.000+02:00'
author: Steven Van Acker
tags: 
modified_time: '2008-01-21T09:39:00.848+01:00'
blogger_id: tag:blogger.com,1999:blog-5513234137363262204.post-826686675803488218
blogger_orig_url: http://www.singularity.be/2007/04/notification-daemon.html
---

I was wrong.<br /><br />After looking around some more, I found that there is a notification-daemon package that uses <a href="http://www.freedesktop.org/wiki/Software/dbus">D-BUS</a>.<br /><br />"D-Bus is a message bus system, a simple way for applications to talk to one another."<br /><br />There is libnotify, which is a library to send notifications through D-BUS, and there is libnotify-bin, which contains a tool "notify-send" to send single notifications.<br /><br />There are also Python bindings in python-notify, which can be used to post notifications to D-BUS, through libnotify. Too complicated ? Not really.<br /><br />I was so fixed on creating a "file watching daemon" that would constantly query a file, read new lines and post those as notifications.<br />I decided to create such a daemon using the python bindings, and it actually works nicely.<br /><br /><pre><br />#!/usr/bin/python<br />import time<br />import string<br />import gtk, pynotify<br /><br />pynotify.init("test")<br /><br />TypeImages = { <br />                'info': "icon.png",<br />                'alert': "/usr/share/app-install/icons/blam.png"<br />             }<br />TypeTitles = { <br />                'info': "Informational", <br />                'alert': "Alert"<br />             }<br /><br /><br />fp=open('/tmp/workfile', 'r')<br /><br />lastdate = int(time.time())<br />while 1:<br />    line = fp.readline()<br />    while line:<br />        line = line.rstrip()<br />        parts = line.split(" ", 2)<br />        i = line.find(" ") # let's assume this is not -1<br />        ts = line[0:i]<br />        line = line[i+1:]<br /><br />        i = line.find(" ") # let's assume this is not -1<br />        tag = line[0:i]<br />        rest = line[i+1:]<br /><br />        if lastdate <= int(ts):<br />            #print "[" + ts + "][" + rest + "]"<br />            if TypeTitles.has_key(tag):<br />                n = pynotify.Notification(TypeTitles[tag], rest)<br />                p = gtk.gdk.pixbuf_new_from_file(TypeImages[tag])<br />                n.set_icon_from_pixbuf(p)<br />            else:<br />                n = pynotify.Notification("Unknown", rest)<br />            <br />            n.show()<br /><br />        line = fp.readline()<br /><br />    lastdate = int(time.time())<br />    time.sleep(1)<br /><br />fp.close()<br /></pre><br /><br />This program works nicely, but there is no advantage over calling notify-send manually. Well, not a lot anyway.<br /><br />So instead of creating a new package with this daemon in it, I'll just use notify-send everywhere (or maybe write a wrapper around it)<br /><br />For example:<br /><pre><br />notify-send -i /usr/share/app-install/icons/kalarm.png "Test"<br /></pre>