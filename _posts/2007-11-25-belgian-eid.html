---
layout: post
title: Belgian EID
date: '2007-11-25T10:39:00.003+01:00'
author: Steven Van Acker
tags: 
modified_time: '2008-09-05T09:39:47.102+02:00'
blogger_id: tag:blogger.com,1999:blog-5513234137363262204.post-5839412316737480633
blogger_orig_url: http://www.singularity.be/2007/11/belgian-eid.html
---

<!-- StevensBlogSpotFilterThing<br />More than a month has passed since I requested my home-address to be changed to Leuven. This week, I finally received my new identitycard, and electronic one (EID).<br /><br />Nosey as I am, I tried to read everything on that card with the only smartcard reader I have: "Texas Instruments PCI6515 SmartCard Controller" built into my Dell Latitude D610. Unfortunately, there is currentnly no linux-driver for this device yet and I wasn't prepared to write on just for this experiment. So, I borrowed one of the BEID smartcard readers that the Belgian government is apparently giving away.<br /><br />This is what I installed on Ubuntu Feisty 7.04:<br />[PRE]<br />apt-get install beidgui libacr38u libacr38ucontrol0 beid-tools pcscd libpcsclite-dev libengine-pkcs11-openssl libbeid2-dev<br />ln -s /usr/lib/libbeidpkcs11.so.2 /usr/lib/libbeidpkcs11.so<br />ldconfig<br />/etc/init.d/pcscd start<br />[/PRE]<br /><br />I started beidgui and it worked!<br /><br />Of course, not every organisation has the ability to read EID cards, and not everyone in Belgium has them. That's why I received a paper with a printout of the data on my EID, with my EID. It's not hard to lose or damage a piece of paper, and I'm sure it will happen to me sooner or later. That's why I scanned in the document and keep it on my laptop.<br /><br />But, this is totally unnecessary. The beidgui can print out this information aswell, in the exact same layout as the official paper. So, if you've lost this piece of paper, or if it became so trashed that you'd be ashamed to show it to any official instance, you can just print it out yourself.<br /><br />I wasn't happy yet. The smartcard contains a picture of my face and I wasn't able to retrieve it through the beidgui program. I had a look at the libbeid2 library and discovered that the development files come with an example program. I cleaned it up so it only reads the picture and dumps it to a file and here it is:<br /><br />[PRE]<br />#include &lt;stdio.h&gt;<br />#include &lt;stdlib.h&gt;<br />#include &lt;string.h&gt;<br />#include "eidlib.h"<br /><br />int main(int argc, char* argv[])<br />{<br />    // Alround test buffer<br />    BYTE buffer[4096] = {0};<br />    BEID_Bytes tBytes = {0};<br />    tBytes.length = 4096;<br />    tBytes.data = buffer;<br /><br />    BEID_Status tStatus = {0};<br />    BEID_Certif_Check tCheck = {0};<br /><br />    long lHandle = 0;<br />    tStatus = BEID_Init(""/*"VIRTUAL"*/, 0, 0, &lHandle);<br /><br />    // Read Picture Data<br />    tStatus = BEID_GetPicture(&tBytes, &tCheck);<br />    if(BEID_OK == tStatus.general)<br />    {<br />        FILE *pf = fopen("photo.jpg", "w+b");<br />        if(pf != NULL)<br />        {<br />            fwrite(tBytes.data, sizeof(unsigned char), tBytes.length, pf);<br />            fclose(pf);<br />        }<br />        printf("Picture written in \"photo.jpg\". Launching picture file ...\n");<br />    } else {<br />        printf("can't read card\n");<br />    }<br /><br />    BEID_Exit();<br />    return 0;<br />}<br />[/PRE]<br /><br />Copypaste this code into "readpicture.cpp" (or download <a href="/Trashcan/BEID/readpicture.cpp">here</a>) and compile it like this:<br /><br />[PRE]<br />g++ -I /usr/include/beid/ -lbeid -o readpicture readpicture.cpp<br />[/PRE]<br /><br />And execute the "readpicture" program like this:<br /><br />[PRE]<br />./readpicture<br />[/PRE]<br /><br />The only thing that still bugs me now, is that the smartcard reader in my laptop doesn't work under linux yet.<br />It seems there was a driver for it in an older kernel version, but support has stopped. 02Micro released a GPL driver for this card somewhere. I found a reference to it here:<br />http://skaya.enix.org/wiki/DellLatitudeD610<br /><br />and some more information here:<br /><br />http://osdir.com/ml/encryption.opensc.user/2006-05/msg00025.html<br /><br />Maybe I should look into this driver and see if I can get it working again.<br />StevensBlogSpotFilterThing --><br />More than a month has passed since I requested my home-address to be changed to Leuven. This week, I finally received my new identitycard, and electronic one (EID).<br /><br />Nosey as I am, I tried to read everything on that card with the only smartcard reader I have: "Texas Instruments PCI6515 SmartCard Controller" built into my Dell Latitude D610. Unfortunately, there is currentnly no linux-driver for this device yet and I wasn't prepared to write on just for this experiment. So, I borrowed one of the BEID smartcard readers that the Belgian government is apparently giving away.<br /><br />This is what I installed on Ubuntu Feisty 7.04:<br /><pre style="background-color: #EEEEEE; border: black 1px dashed; line-height: 100%; padding: 10px;"><br />apt-get install beidgui libacr38u libacr38ucontrol0 beid-tools pcscd libpcsclite-dev libengine-pkcs11-openssl libbeid2-dev<br />ln -s /usr/lib/libbeidpkcs11.so.2 /usr/lib/libbeidpkcs11.so<br />ldconfig<br />/etc/init.d/pcscd start<br /></pre><br /><br />I started beidgui and it worked!<br /><br />Of course, not every organisation has the ability to read EID cards, and not everyone in Belgium has them. That's why I received a paper with a printout of the data on my EID, with my EID. It's not hard to lose or damage a piece of paper, and I'm sure it will happen to me sooner or later. That's why I scanned in the document and keep it on my laptop.<br /><br />But, this is totally unnecessary. The beidgui can print out this information aswell, in the exact same layout as the official paper. So, if you've lost this piece of paper, or if it became so trashed that you'd be ashamed to show it to any official instance, you can just print it out yourself.<br /><br />I wasn't happy yet. The smartcard contains a picture of my face and I wasn't able to retrieve it through the beidgui program. I had a look at the libbeid2 library and discovered that the development files come with an example program. I cleaned it up so it only reads the picture and dumps it to a file and here it is:<br /><br /><pre style="background-color: #EEEEEE; border: black 1px dashed; line-height: 100%; padding: 10px;"><br />#include &lt;stdio.h&gt;<br />#include &lt;stdlib.h&gt;<br />#include &lt;string.h&gt;<br />#include "eidlib.h"<br /><br />int main(int argc, char* argv[])<br />{<br />    // Alround test buffer<br />    BYTE buffer[4096] = {0};<br />    BEID_Bytes tBytes = {0};<br />    tBytes.length = 4096;<br />    tBytes.data = buffer;<br /><br />    BEID_Status tStatus = {0};<br />    BEID_Certif_Check tCheck = {0};<br /><br />    long lHandle = 0;<br />    tStatus = BEID_Init(""/*"VIRTUAL"*/, 0, 0, &lHandle);<br /><br />    // Read Picture Data<br />    tStatus = BEID_GetPicture(&tBytes, &tCheck);<br />    if(BEID_OK == tStatus.general)<br />    {<br />        FILE *pf = fopen("photo.jpg", "w+b");<br />        if(pf != NULL)<br />        {<br />            fwrite(tBytes.data, sizeof(unsigned char), tBytes.length, pf);<br />            fclose(pf);<br />        }<br />        printf("Picture written in \"photo.jpg\". Launching picture file ...\n");<br />    } else {<br />        printf("can't read card\n");<br />    }<br /><br />    BEID_Exit();<br />    return 0;<br />}<br /></pre><br /><br />Copypaste this code into "readpicture.cpp" (or download <a href="/Trashcan/BEID/readpicture.cpp">here</a>) and compile it like this:<br /><br /><pre style="background-color: #EEEEEE; border: black 1px dashed; line-height: 100%; padding: 10px;"><br />g++ -I /usr/include/beid/ -lbeid -o readpicture readpicture.cpp<br /></pre><br /><br />And execute the "readpicture" program like this:<br /><br /><pre style="background-color: #EEEEEE; border: black 1px dashed; line-height: 100%; padding: 10px;"><br />./readpicture<br /></pre><br /><br />The only thing that still bugs me now, is that the smartcard reader in my laptop doesn't work under linux yet.<br />It seems there was a driver for it in an older kernel version, but support has stopped. 02Micro released a GPL driver for this card somewhere. I found a reference to it here:<br />http://skaya.enix.org/wiki/DellLatitudeD610<br /><br />and some more information here:<br /><br />http://osdir.com/ml/encryption.opensc.user/2006-05/msg00025.html<br /><br />Maybe I should look into this driver and see if I can get it working again.