---
layout: post
title: 'Side project: generating clickmaps as meta-data for screenshots'
date: '2012-01-01T23:29:00.001+01:00'
author: Steven Van Acker
tags: 
modified_time: '2012-01-01T23:34:16.243+01:00'
thumbnail: http://2.bp.blogspot.com/-WtLVTf3Xyd4/TwDdrY62OEI/AAAAAAAAAMc/8eWon25xOTo/s72-c/Screenshot-14.png
blogger_id: tag:blogger.com,1999:blog-5513234137363262204.post-5158923024660370961
blogger_orig_url: http://www.singularity.be/2012/01/side-project-generting-clickmaps-as.html
---

<p>A long time ago, my mom persuaded me into playing Farmville so she could have more Farmville neighbors and gain some reward from that. Since Farmville was pretty repetitive, I created an automated Farmville player in a VM that would play the game 24/7, much to the dissatisfaction of my mother and other people, because the autoplayer blasted away their puny highscores in less than a week. </p><p>For a paper I submitted not long ago, there was also the need for this kind of automation. After submission, I realized that my automation could be improved if I could somehow determine which locations on screen were hotspots for an application with regard to clicking. For example, a menu bar obviously has special meaning to any application, and so does a textfield. On the other hand, the title bar or plain blank space does not react to clicks at all. </p><p>The main idea behind this "clickmap" discovery, is to observe the shape of the mousepointer as it moves along the screen. The X11 protocol defines a set of standard shapes that should be implemented by any pointer "theme", collectively called the "X11 cursor font" (XCursorFont). Each mouse pointer (cursor) shape is then a glyph from that font. Each of those shapes is represented by a unique color in the output "clickmap" image. </p><p>There are some problems with this setup: the current shape of the mouse pointer is determined by the top-most application over which the mousepointer hovers. That means that the application is responsible for changing  the mouse pointer shape and if the application is slow, there is a delay between the time the cursor is positioned  and the time the cursor shape is updated. Another problem is that for each pixel on the screen, a X11 protocol message must be sent to position the cursor, and then another message to query the  cursor shape, followed by receiving a message containing the cursor shape ID. All of this makes that imaging the clickmap is very slow... </p><p>A final problem is that the X11 protocol itself does not provide a way to query the current cursor shape. Luckily, there is an extension to the X11 protocol, called the Xfixes extension, which allows the retrieval of the current mouse pointer shape (for applications that take screenshots, or remote desktop software). </p><p>All in all, creating a "clickmap" of the current screen is not very practical because it is very slow. If the clickable hotspots on screen change (e.g. animated menus or whatever) while the clickmap is being imaged, the output image is trash. </p><p>Nevertheless, I present you with the code in case you want to play around with it, as well as a screenshot from a portion of my screen with its accompanying clickmap (both sized 1024x768). Successive pixels were queried with a delay of 50 microseconds. The entire imaging took 3m43s... </p><p><a href="http://data.singularity.be/clickmaps/getimage.c">http://data.singularity.be/clickmaps/getimage.c</a></p><p><div class="separator" style="clear: both; text-align: center;"><a href="http://2.bp.blogspot.com/-WtLVTf3Xyd4/TwDdrY62OEI/AAAAAAAAAMc/8eWon25xOTo/s1600/Screenshot-14.png" imageanchor="1" style="clear:left; float:left;margin-right:1em; margin-bottom:1em"><img border="0" height="240" width="320" src="http://2.bp.blogspot.com/-WtLVTf3Xyd4/TwDdrY62OEI/AAAAAAAAAMc/8eWon25xOTo/s320/Screenshot-14.png" /></a></div><div class="separator" style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/-XRNJv4n2Q0E/TwDdy7a2xuI/AAAAAAAAAMo/ZhG5Cz652Iw/s1600/Screenshot-14-meta-3m43s.png" imageanchor="1" style="clear:left; float:left;margin-right:1em; margin-bottom:1em"><img border="0" height="240" width="320" src="http://4.bp.blogspot.com/-XRNJv4n2Q0E/TwDdy7a2xuI/AAAAAAAAAMo/ZhG5Cz652Iw/s320/Screenshot-14-meta-3m43s.png" /></a></div></p>