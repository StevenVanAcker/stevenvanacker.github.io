---
layout: post
title: automated installations (7)
date: '2006-02-20T10:15:00.000+01:00'
author: Steven Van Acker
tags: 
modified_time: '2008-01-16T09:27:10.158+01:00'
blogger_id: tag:blogger.com,1999:blog-5513234137363262204.post-3739316201139183893
blogger_orig_url: http://www.singularity.be/2006/02/automated-installations-7.html
---

Welcome to a brand new week.<br /><br />The plan this week (at least till wednesday when I will be handling shit of week) is to program my own netcfg package. Before I can do that, I have to know what exactly this package is being used for.<br /><br />This is a list of files (probably) generated by netcfg (I found them in netcfg.h):<br /><pre><br />#define INTERFACES_FILE "/etc/network/interfaces"<br />#define HOSTS_FILE      "/etc/hosts"<br />#define HOSTNAME_FILE   "/etc/hostname"<br />#define NETWORKS_FILE   "/etc/networks"<br />#define RESOLV_FILE     "/etc/resolv.conf"<br />#define DHCLIENT_CONF   "/etc/dhclient.conf"<br />#define DHCLIENT3_CONF  "/etc/dhcp3/dhclient.conf"<br />#define DOMAIN_FILE     "/tmp/domain_name"<br /><br />#define DEVNAMES        "/etc/network/devnames"<br />#define DEVHOTPLUG      "/etc/network/devhotplug"<br />#define STAB            "/var/run/stab"<br /></pre><br /><br />Next to that, this is what is in the netcfg package (besides the control section)<br /><pre><br />/<br />/usr/<br />/usr/lib/<br />/usr/lib/base-installer.d/<br />/usr/lib/base-installer.d/40netcfg<br />/etc/<br />/etc/network/<br />/etc/dhcp/<br />/etc/dhcp3/<br />/etc/dhcp3/dhclient-script<br />/etc/dhclient-script<br />/bin/<br />/bin/netcfg<br />/bin/killall.sh<br />/bin/ptom<br />/var/<br />/var/dhcp/<br /></pre><br /><br />The files here have the following purpose:<br /><dl><br /><dt>/usr/lib/base-installer.d/40netcfg</dt><br /><dd>Copy the generated files to /target</dd><br /><dt>/etc/dhcp3/dhclient-script</dt><br /><dt>/etc/dhclient-script</dt><br /><dd>These scripts are the same. It's a miniature dhclient that uses netcfg (the binary)</dd><br /><dt>/bin/netcfg</dt><br /><dd>The binary</dd><br /><dt>/bin/killall.sh</dt><br /><dd>A script to kill all running DHCP clients</dd><br /><dt>/bin/ptom</dt><br /><dd>A symlink to the netcfg binary</dd><br /></dl><br /><br />Instead of replacing the code in the netcfg package, I decided I would make a new kulnet-netcfg package with all the new code. I would then remove the "installer-menu-item: 18" from netcfg and glue it behind the kulnet-netcfg package.<br />After doing all that, to my surprise, debian installer still loaded the first netcfg and skipped the kulnet-netcfg.<br /><br />So, I've cleaned out netcfg and started making my own script.<br />The current problem is that there is nothing decent inside the initrd to test a connection.<br />I'm using netcat with a program that kills all netcats after 3 seconds in the background.<br /><br />